<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Lzh正在写代码</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="千里之行始于足下">
<meta property="og:type" content="website">
<meta property="og:title" content="Lzh正在写代码">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="Lzh正在写代码">
<meta property="og:description" content="千里之行始于足下">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Lzh">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Lzh正在写代码" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Lzh正在写代码</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-Springboot-创建菜单和游戏界面" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/01/23/Springboot-%E5%88%9B%E5%BB%BA%E8%8F%9C%E5%8D%95%E5%92%8C%E6%B8%B8%E6%88%8F%E7%95%8C%E9%9D%A2/" class="article-date">
  <time class="dt-published" datetime="2025-01-23T07:32:26.000Z" itemprop="datePublished">2025-01-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web/">Web</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/01/23/Springboot-%E5%88%9B%E5%BB%BA%E8%8F%9C%E5%8D%95%E5%92%8C%E6%B8%B8%E6%88%8F%E7%95%8C%E9%9D%A2/">Springboot-创建菜单和游戏界面</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="导航栏"><a href="#导航栏" class="headerlink" title="导航栏"></a>导航栏</h2><p>安装插件</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed8d891e2.png" alt="springboot2-1.png"></p>
<p>新建<code>NavBar.vue</code>组件，使用<code>vueinit</code>自动提示命令初始化一个vue页面。scoped的意思是在当前组件中的样式是独立的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Bootstrap使用"><a href="#Bootstrap使用" class="headerlink" title="Bootstrap使用"></a>Bootstrap使用</h3><p><a target="_blank" rel="noopener" href="https://v5.bootcss.com/">https://v5.bootcss.com/</a></p>
<p>快速入门<a target="_blank" rel="noopener" href="https://v5.bootcss.com/docs/getting-started/introduction/">https://v5.bootcss.com/docs/getting-started/introduction/</a></p>
<p>寻找合适的导航栏</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed8dd0a61.png" alt="springboot2-2.png"></p>
<h3 id="创建NavBar"><a href="#创建NavBar" class="headerlink" title="创建NavBar"></a>创建NavBar</h3><p>通常把关于具体页面的组件，创建在<code>src\views</code>文件夹下，把涉及到的公共组件，放入<code>src\components</code>中</p>
<p>对于导航栏，创建<code>src\components\NavBar.vue</code></p>
<p>将Bootstrap找到的代码粘贴到<code>&lt;template&gt;</code>中，</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">&quot;navbar navbar-expand-lg navbar-dark bg-dark&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">class</span>=<span class="string">&quot;navbar-brand&quot;</span> <span class="attr">:to</span>=<span class="string">&quot;&#123; name: &#x27;home&#x27; &#125;&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span>King of Bot&lt;/router-link</span><br><span class="line">      &gt;</span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;collapse navbar-collapse&quot;</span> <span class="attr">id</span>=<span class="string">&quot;navbarText&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;navbar-nav me-auto mb-2 mb-lg-0&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">router-link</span></span></span><br><span class="line"><span class="tag">              <span class="attr">:class</span>=<span class="string">&quot;route_name == &#x27;pk_index&#x27; ? &#x27;nav-link active&#x27; : &#x27;nav-link&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">:to</span>=<span class="string">&quot;&#123; name: &#x27;pk_index&#x27; &#125;&quot;</span></span></span><br><span class="line"><span class="tag">              &gt;</span>对战&lt;/router-link</span><br><span class="line">            &gt;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">router-link</span></span></span><br><span class="line"><span class="tag">              <span class="attr">:class</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">                route_name == &#x27;record_index&#x27; ? &#x27;nav-link active&#x27; : &#x27;nav-link&#x27;</span></span></span><br><span class="line"><span class="string"><span class="tag">              &quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">:to</span>=<span class="string">&quot;&#123; name: &#x27;record_index&#x27; &#125;&quot;</span></span></span><br><span class="line"><span class="tag">              &gt;</span>对局记录&lt;/router-link</span><br><span class="line">            &gt;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">router-link</span></span></span><br><span class="line"><span class="tag">              <span class="attr">:class</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">                route_name == &#x27;ranklist_index&#x27; ? &#x27;nav-link active&#x27; : &#x27;nav-link&#x27;</span></span></span><br><span class="line"><span class="string"><span class="tag">              &quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">:to</span>=<span class="string">&quot;&#123; name: &#x27;ranklist_index&#x27; &#125;&quot;</span></span></span><br><span class="line"><span class="tag">              &gt;</span>排行榜&lt;/router-link</span><br><span class="line">            &gt;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;navbar-nav&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item dropdown&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span></span></span><br><span class="line"><span class="tag">              <span class="attr">class</span>=<span class="string">&quot;nav-link dropdown-toggle&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">href</span>=<span class="string">&quot;#&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">id</span>=<span class="string">&quot;navbarDropdown&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">role</span>=<span class="string">&quot;button&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">data-bs-toggle</span>=<span class="string">&quot;dropdown&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">aria-expanded</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">            &gt;</span></span><br><span class="line">              个人中心</span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;dropdown-menu&quot;</span> <span class="attr">aria-labelledby</span>=<span class="string">&quot;navbarDropdown&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">router-link</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">class</span>=<span class="string">&quot;dropdown-item&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">:to</span>=<span class="string">&quot;&#123; name: &#x27;user_bot_index&#x27; &#125;&quot;</span></span></span><br><span class="line"><span class="tag">                  &gt;</span>我的Bot&lt;/router-link</span><br><span class="line">                &gt;</span><br><span class="line">              <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">hr</span> <span class="attr">class</span>=<span class="string">&quot;dropdown-divider&quot;</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;dropdown-item&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>退出<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123; useRoute &#125; <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123; computed &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> route = <span class="title function_">useRoute</span>();</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> route_name = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> route.<span class="property">name</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      route_name,</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="导入NavBar"><a href="#导入NavBar" class="headerlink" title="导入NavBar"></a>导入NavBar</h3><p>现在还只是在<code>src\components</code>创建的一个公共组件，想要在页面中展示，必须在<code>src\App.vue</code>中引入</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">NavBar</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 导入组件</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">NavBar</span> <span class="keyword">from</span> <span class="string">&#x27;./components/NavBar.vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 导入bootstrap</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="string">&quot;bootstrap/dist/css/bootstrap.min.css&quot;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="string">&quot;bootstrap/dist/js/bootstrap&quot;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">NavBar</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">body</span>&#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&quot;./assets/images/background.jpg&quot;</span>);</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-size</span>: cover;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed8f2f4a4.png" alt="springboot2-3.png"></p>
<p>效果如下：</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed8dbe783.png" alt="springboot2-4.png"></p>
<h3 id="路由配置"><a href="#路由配置" class="headerlink" title="路由配置"></a>路由配置</h3><p>如果将输入的网页，与对应的页面相一一对应，需要在<code>src\router\index.js</code>中配置路由</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PkIndexView</span> <span class="keyword">from</span> <span class="string">&quot;../views/pk/PkIndexView&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">RecordIndexView</span> <span class="keyword">from</span> <span class="string">&quot;../views/record/RecordIndexView&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">RanklistIndexView</span> <span class="keyword">from</span> <span class="string">&quot;../views/ranklist/RanklistIndexView&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">UserBotIndexView</span> <span class="keyword">from</span> <span class="string">&quot;../views/user/bot/UserBotIndexView&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">NotFound</span> <span class="keyword">from</span> <span class="string">&quot;../views/error/NotFound&quot;</span></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>:<span class="string">&quot;/&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>:<span class="string">&quot;home&quot;</span>,</span><br><span class="line">    <span class="attr">redirect</span>:<span class="string">&quot;/pk/&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>:<span class="string">&quot;/pk/&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>:<span class="string">&quot;pk_index&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>:<span class="title class_">PkIndexView</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>:<span class="string">&quot;/record/&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>:<span class="string">&quot;record_index&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>:<span class="title class_">RecordIndexView</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>:<span class="string">&quot;/ranklist/&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>:<span class="string">&quot;ranklist_index&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>:<span class="title class_">RanklistIndexView</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>:<span class="string">&quot;/user/bot/&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>:<span class="string">&quot;user_bot_index&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>:<span class="title class_">UserBotIndexView</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>:<span class="string">&quot;/404/&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>:<span class="string">&quot;404&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>:<span class="title class_">NotFound</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>:<span class="string">&quot;/:catchAll(.*)&quot;</span>,</span><br><span class="line">    <span class="attr">redirect</span>:<span class="string">&quot;/404/&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  <span class="attr">history</span>: <span class="title function_">createWebHistory</span>(),</span><br><span class="line">  routes</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其中的<code>path</code>就是浏览器的<code>url</code>，其中的<code>component</code>就是需要设置<code>src\views</code>下实现的基本页面。</p>
<p><code>src\views\pk\PkIndexView.vue</code>代表对战页面</p>
<p><code>src\views\ranklist\RanklistIndexView.vue</code>代表排行榜页面</p>
<p><code>src\views\record\RecordIndexView.vue</code>代表对局记录页面</p>
<p><code>src\views\user\bot\UserBotIndexView.vue</code>代表我的Bot页面</p>
<p><code>src\views\error\NotFound.vue</code>代表404页面</p>
<p>这样就能实现输入url就能展示对应的页面</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed8e0e6b2.png" alt="springboot2-5.png"></p>
<p>那如何实现点击页面的按钮元素，也能实现跳转页面呢，例如点击<code>对局记录</code>，也能跳转到当前页面</p>
<p>将按钮关联到路由名称</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed8dda887.png" alt="springboot2-6.png"></p>
<p>例如，点击<code>排行榜</code></p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed9190184.png" alt="springboot2-7.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed91e5ddb.png" alt="springboot2-8.png"></p>
<h2 id="游戏页面"><a href="#游戏页面" class="headerlink" title="游戏页面"></a>游戏页面</h2><h3 id="地图与障碍物"><a href="#地图与障碍物" class="headerlink" title="地图与障碍物"></a>地图与障碍物</h3><p>首先实现地图功能</p>
<p>生成一个合法地图：</p>
<ul>
<li>有边界</li>
<li>有随机、对称出现的障碍物</li>
<li>中心对称</li>
<li>初始时 两个Game Object分别在左下角和右上角</li>
<li>左下角和右上角是连通的（障碍物的布置有一定限制）</li>
</ul>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed92722bb.png" alt="springboot2-9.png"></p>
<p>游戏中的每一个组件都是一个类，本次我们需要实现两个类，地图类和樯类，分别对应绿色部分和棕色部分。</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed918465a.png" alt="springboot2-10.png"></p>
<p>对于所有类，我们还要实现一个基类。</p>
<h3 id="基类GameObject"><a href="#基类GameObject" class="headerlink" title="基类GameObject"></a>基类GameObject</h3><p>屏幕每秒钟刷新60次（也可以调整次数） 每次渲染出的画面称为帧 也就是一秒钟有60帧画面</p>
<p>那如何实现让物体的移动呢 需要依次计算出物体在每一帧下的位置 （每到下一帧 就要把上一帧画面全部覆盖重新画）最后渲染出的整体画面有产生了运动的效果。</p>
<p>在实现的过程中，关于运动这一点，需要抽象出一个基本的工具类，实现公共功能（凡是需要动的Object，每秒钟都要刷新60次即重画60次，都需要用到这样一个功能）</p>
<p>所有的Object都会用到这样一个工具类，我们就将其作为基类。</p>
<p>通常，工具类都放在<code>src\assets\scripts</code>中，用于存放常用脚本</p>
<p>创建<code>GameObject.js</code></p>
<p>如何实现每秒钟所有的游戏对象都被刷新60次（一般浏览器的默认设置），借助<code>requestAnimationFrame</code>函数，传入一个回调函数<code>step</code>，那么这个回调函数就会在下一帧之内，也就是下一帧浏览器渲染之前执行一遍。</p>
<p>如何让<code>step</code>函数每一帧都执行，将其写成递归形式。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">step</span> = (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(step)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">requestAnimationFrame</span>(step)</span><br></pre></td></tr></table></figure>

<p>这样，当我们开始调用<code>requestAnimationFrame(step)</code>，会在下一帧执行<code>step</code>，在下一帧执行<code>step</code>时，执行完到最后再次触发<code>requestAnimationFrame(step)</code>，会在下下帧执行<code>step</code></p>
<p>就像下面这样，最终的结果就是每一帧都执行一次该<code>step</code>函数</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed91df420.png" alt="springboot2-11.png"></p>
<p>此外，我们需要实现三个函数，分别是<code>start</code>，<code>update</code>，<code>destroy</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">start</span>(<span class="params"></span>)&#123; <span class="comment">//只执行一次</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"><span class="title function_">upadate</span>(<span class="params"></span>)&#123;<span class="comment">//每一帧执行一次 除了第一帧之外</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">on_destroy</span>(<span class="params"></span>)&#123;<span class="comment">//删除之前执行</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">destroy</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">on_destroy</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i <span class="keyword">in</span> <span class="variable constant_">GAME_OBJECTS</span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> obj = <span class="variable constant_">GAME_OBJECTS</span>[i];</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="variable language_">this</span>)&#123;</span><br><span class="line">            <span class="variable constant_">GAME_OBJECTS</span>.<span class="title function_">splice</span>(i);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>最终的结果是，所有<code>GameObject</code>对象的<code>start</code>函数在第一帧执行了一次（假设<code>step</code>函数开始执行的那一帧称为第一帧），后面的每一帧都执行<code>upadate</code>函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">GAME_OBJECTS</span> = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GameObject</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable constant_">GAME_OBJECTS</span>.<span class="title function_">push</span>(<span class="variable language_">this</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">timedelta</span> = <span class="number">0</span>;<span class="comment">//两帧之间的执行的时间间隔</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">has_called_start</span> = <span class="literal">false</span>;<span class="comment">//记录start()是否有被执行过</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>)&#123; <span class="comment">//只执行一次</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">upadate</span>(<span class="params"></span>)&#123;<span class="comment">//每一帧执行一次 除了第一帧之外</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">on_destroy</span>(<span class="params"></span>)&#123;<span class="comment">//删除之前执行</span></span><br><span class="line"></span><br><span class="line">    &#125; </span><br><span class="line">    <span class="title function_">destroy</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">on_destroy</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i <span class="keyword">in</span> <span class="variable constant_">GAME_OBJECTS</span>)&#123;</span><br><span class="line">            <span class="keyword">const</span> obj = <span class="variable constant_">GAME_OBJECTS</span>[i];</span><br><span class="line">            <span class="keyword">if</span> (obj == <span class="variable language_">this</span>)&#123;</span><br><span class="line">                <span class="variable constant_">GAME_OBJECTS</span>.<span class="title function_">splice</span>(i);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> last_timestemp;<span class="comment">//上一次执行的时刻</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">step</span> = timestemp =&gt;&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> obj <span class="keyword">of</span> <span class="title class_">GameObjects</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!obj.<span class="property">has_called_start</span>)&#123;</span><br><span class="line">            obj.<span class="property">has_called_start</span> = <span class="literal">true</span>;</span><br><span class="line">            obj.<span class="title function_">start</span>();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            obj.<span class="property">timedelta</span> = timestemp - last_timestemp;</span><br><span class="line">            obj.<span class="title function_">upadate</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    last_timestemp = timestemp;</span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(step)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">requestAnimationFrame</span>(step)</span><br></pre></td></tr></table></figure>

<h3 id="地图类GameMap"><a href="#地图类GameMap" class="headerlink" title="地图类GameMap"></a>地图类GameMap</h3><p>用于实现地图</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed95ab4c0.png" alt="springboot2-12.png"></p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/">https://developer.mozilla.org/zh-CN/</a></p>
<p>需要用到Canvas API</p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API">https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API</a></p>
<h3 id="障碍物类Wall"><a href="#障碍物类Wall" class="headerlink" title="障碍物类Wall"></a>障碍物类Wall</h3><p>在<code>src\assets\scripts\Wall.js</code>中定义障碍物类<code>Wall</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//障碍物类</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">GameObject</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./GameObject&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Wall</span> <span class="keyword">extends</span> <span class="title class_ inherited__">GameObject</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">r, c, gamemap</span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>();<span class="comment">//若继承基类，则必须要有这句</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">r</span> = r;<span class="comment">//障碍物横坐标</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">c</span> = c;<span class="comment">//障碍物纵坐标</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gamemap</span> = gamemap;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">color</span> = <span class="string">&quot;#b47226&quot;</span>;<span class="comment">//障碍物颜色</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">render</span>();<span class="comment">//每帧渲染一次</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> L = <span class="variable language_">this</span>.<span class="property">gamemap</span>.<span class="property">L</span>;<span class="comment">//取出一个単位格的边长 动态取 因为L会动态变化</span></span><br><span class="line">        <span class="keyword">const</span> ctx = <span class="variable language_">this</span>.<span class="property">gamemap</span>.<span class="property">ctx</span>;<span class="comment">//取出canvas的引用</span></span><br><span class="line">        ctx.<span class="property">fillStyle</span> = <span class="variable language_">this</span>.<span class="property">color</span>;</span><br><span class="line">        ctx.<span class="property">fillRect</span> (<span class="variable language_">this</span>.<span class="property">c</span> * L, <span class="variable language_">this</span>.<span class="property">r</span> * L, L, L);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>在<code>src\assets\scripts\GameMap.js</code>中创建，例如<code>new Wall(0,0,this)</code>表示在<code>(0,0)</code>这个格子处渲染出一个障碍物来</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">GameObject</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./GameObject&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Wall</span>&#125; <span class="keyword">from</span> <span class="string">&quot;./Wall&quot;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GameMap</span> <span class="keyword">extends</span> <span class="title class_ inherited__">GameObject</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">ctx, parent</span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span> = ctx;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">parent</span> = parent;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">L</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">rows</span> = <span class="number">13</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cols</span> = <span class="number">13</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">walls</span> = [];<span class="comment">//用于保存障碍物</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//创建障碍物</span></span><br><span class="line">    <span class="title function_">create_walls</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Wall</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">create_walls</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed967f575.png" alt="springboot2-13.png"></p>
<p> 如果改为给两侧全部加上障碍物，则<code>create_walls()</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">create_walls</span>(<span class="params"></span>)&#123;</span><br><span class="line">       <span class="keyword">const</span> g = [];<span class="comment">//用bool数组来保存是否存在障碍物 初始置位false</span></span><br><span class="line">       <span class="keyword">for</span>(<span class="keyword">let</span> r = <span class="number">0</span>; r &lt; <span class="variable language_">this</span>.<span class="property">rows</span>; r++)&#123;</span><br><span class="line">           g[r] = [];</span><br><span class="line">           <span class="keyword">for</span>(<span class="keyword">let</span> c = <span class="number">0</span>; c &lt; <span class="variable language_">this</span>.<span class="property">cols</span>; c++)&#123;</span><br><span class="line">               g[r][c] = <span class="literal">false</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//给四周加上障碍物</span></span><br><span class="line">       <span class="keyword">for</span>(<span class="keyword">let</span> r = <span class="number">0</span>; r &lt; <span class="variable language_">this</span>.<span class="property">rows</span>; r++)&#123;<span class="comment">//给左右两侧设置为true</span></span><br><span class="line">           g[r][<span class="number">0</span>]=<span class="literal">true</span>;</span><br><span class="line">           g[r][<span class="variable language_">this</span>.<span class="property">cols</span>-<span class="number">1</span>]=<span class="literal">true</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">for</span>(<span class="keyword">let</span> c = <span class="number">0</span>; c &lt; <span class="variable language_">this</span>.<span class="property">cols</span>; c++)&#123;<span class="comment">//给上下两侧设置为true</span></span><br><span class="line">           g[<span class="number">0</span>][c] = g[<span class="variable language_">this</span>.<span class="property">rows</span>-<span class="number">1</span>][c] = <span class="literal">true</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="variable language_">console</span>.<span class="title function_">log</span>(g);</span><br><span class="line">       <span class="keyword">for</span>(<span class="keyword">let</span> r = <span class="number">0</span>; r &lt; <span class="variable language_">this</span>.<span class="property">rows</span>; r++)&#123;</span><br><span class="line">           <span class="keyword">for</span>(<span class="keyword">let</span> c = <span class="number">0</span>; c &lt; <span class="variable language_">this</span>.<span class="property">cols</span>; c++)&#123;</span><br><span class="line">               <span class="keyword">if</span>(g[r][c])&#123;</span><br><span class="line">                   <span class="variable language_">this</span>.<span class="property">walls</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Wall</span> (r,c,<span class="variable language_">this</span>));</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed948e69d.png" alt="springboot2-14.png"></p>
<p>为什么障碍物的颜色会覆盖地图的颜色呢？是因为后创建的对象会将前面的对象覆盖掉。</p>
<p>在内部设置障碍物：</p>
<ul>
<li>对称</li>
<li>左上角和右下角不能有障碍物</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在内部设置inner_walls_count个对称的障碍物4</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">inner_walls_count</span> / <span class="number">2</span>; i++)&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="number">1000</span>; j++) &#123;</span><br><span class="line">        <span class="keyword">let</span> r = <span class="built_in">parseInt</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="variable language_">this</span>.<span class="property">rows</span>);</span><br><span class="line">        <span class="keyword">let</span> c = <span class="built_in">parseInt</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="variable language_">this</span>.<span class="property">cols</span>);</span><br><span class="line">        <span class="keyword">if</span>(g[r][c] || g[c][r]) <span class="keyword">continue</span>;<span class="comment">//直接进入下一轮循环 j++</span></span><br><span class="line">        <span class="keyword">if</span>(r == <span class="variable language_">this</span>.<span class="property">rows</span> - <span class="number">2</span> &amp;&amp; c == <span class="number">1</span> || r == <span class="number">1</span> &amp;&amp; c == <span class="variable language_">this</span>.<span class="property">cols</span>-<span class="number">2</span>)</span><br><span class="line">            <span class="keyword">continue</span>;<span class="comment">//保证左上角和右下角不能有障碍物</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//成功设置一个障碍物后 直接退出当前for i++</span></span><br><span class="line">        g[r][c] = g[c][r] = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed94a7be5.png" alt="springboot2-15.png"></p>
<p>如何保证连通性呢，也就是如何让找到一条从左下角到右上角的，没有障碍物的路。</p>
<p>通过加入一个<code>check_connectivity</code>函数，来判断当前地图状态是否具有连通性</p>
<p>最终代码：</p>
<p><code>src\assets\scripts\GameMap.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">GameObject</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./GameObject&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Wall</span>&#125; <span class="keyword">from</span> <span class="string">&quot;./Wall&quot;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GameMap</span> <span class="keyword">extends</span> <span class="title class_ inherited__">GameObject</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">ctx, parent</span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span> = ctx;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">parent</span> = parent;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">L</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">rows</span> = <span class="number">13</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cols</span> = <span class="number">13</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">inner_walls_count</span> = <span class="number">20</span>;<span class="comment">//定义内部障碍物数量</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">walls</span> = [];<span class="comment">//用于保存障碍物,属于对象数组</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断连通性</span></span><br><span class="line">    <span class="comment">//参考题目:蛇形矩阵</span></span><br><span class="line">    <span class="title function_">check_connectivity</span>(<span class="params">g, sx, sy, tx, ty</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (sx == tx &amp;&amp; sy == ty) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        g[sx][sy] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> dx = [-<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>];</span><br><span class="line">        <span class="keyword">let</span> dy = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">let</span> x = sx + dx[i];</span><br><span class="line">            <span class="keyword">let</span> y = sy + dy[i];</span><br><span class="line">            <span class="keyword">if</span>(!g[x][y] &amp;&amp; <span class="variable language_">this</span>.<span class="title function_">check_connectivity</span>(g, x, y, tx, ty))</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//创建障碍物</span></span><br><span class="line">    <span class="title function_">create_walls</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> g = [];<span class="comment">//用bool数组来保存是否存在障碍物 初始置位false</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> r = <span class="number">0</span>; r &lt; <span class="variable language_">this</span>.<span class="property">rows</span>; r++)&#123;</span><br><span class="line">            g[r] = [];</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">let</span> c = <span class="number">0</span>; c &lt; <span class="variable language_">this</span>.<span class="property">cols</span>; c++)&#123;</span><br><span class="line">                g[r][c] = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//给四周加上障碍物</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> r = <span class="number">0</span>; r &lt; <span class="variable language_">this</span>.<span class="property">rows</span>; r++)&#123;<span class="comment">//给左右两侧设置为true</span></span><br><span class="line">            g[r][<span class="number">0</span>]=<span class="literal">true</span>;</span><br><span class="line">            g[r][<span class="variable language_">this</span>.<span class="property">cols</span>-<span class="number">1</span>]=<span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> c = <span class="number">0</span>; c &lt; <span class="variable language_">this</span>.<span class="property">cols</span>; c++)&#123;<span class="comment">//给上下两侧设置为true</span></span><br><span class="line">            g[<span class="number">0</span>][c] = g[<span class="variable language_">this</span>.<span class="property">rows</span>-<span class="number">1</span>][c] = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//在内部设置inner_walls_count个对称的障碍物</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">inner_walls_count</span> / <span class="number">2</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="number">1000</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">let</span> r = <span class="built_in">parseInt</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="variable language_">this</span>.<span class="property">rows</span>);</span><br><span class="line">                <span class="keyword">let</span> c = <span class="built_in">parseInt</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="variable language_">this</span>.<span class="property">cols</span>);</span><br><span class="line">                <span class="keyword">if</span>(g[r][c] || g[c][r]) <span class="keyword">continue</span>;<span class="comment">//直接进入下一轮循环 j++</span></span><br><span class="line">                <span class="keyword">if</span>(r == <span class="variable language_">this</span>.<span class="property">rows</span> - <span class="number">2</span> &amp;&amp; c == <span class="number">1</span> || r == <span class="number">1</span> &amp;&amp; c == <span class="variable language_">this</span>.<span class="property">cols</span>-<span class="number">2</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;<span class="comment">//保证左上角和右下角不能有障碍物</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment">//成功设置一个障碍物后 直接退出当前for i++</span></span><br><span class="line">                g[r][c] = g[c][r] = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//需要将状态g的副本传入check_connectivity</span></span><br><span class="line">        <span class="comment">//深度拷贝一个对象:先转换成json再将json解析出来 就一定是一个新的东西</span></span><br><span class="line">        <span class="keyword">const</span> copy_g = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(g));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果地图不连通</span></span><br><span class="line">        <span class="comment">//传入g以及起点和终点的横纵坐标</span></span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable language_">this</span>.<span class="title function_">check_connectivity</span>(copy_g,<span class="variable language_">this</span>.<span class="property">rows</span>-<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="variable language_">this</span>.<span class="property">cols</span>-<span class="number">2</span>)) </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建障碍物对象 并添加到this.walls数组</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> r = <span class="number">0</span>; r &lt; <span class="variable language_">this</span>.<span class="property">rows</span>; r++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">let</span> c = <span class="number">0</span>; c &lt; <span class="variable language_">this</span>.<span class="property">cols</span>; c++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(g[r][c])&#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">walls</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Wall</span> (r,c,<span class="variable language_">this</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;<span class="comment">//如果连通  </span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="title function_">create_walls</span>())</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">update_size</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">L</span> = <span class="built_in">parseInt</span>(<span class="title class_">Math</span>.<span class="title function_">min</span>(<span class="variable language_">this</span>.<span class="property">parent</span>.<span class="property">clientWidth</span> / <span class="variable language_">this</span>.<span class="property">cols</span>, <span class="variable language_">this</span>.<span class="property">parent</span>.<span class="property">clientHeight</span> / <span class="variable language_">this</span>.<span class="property">rows</span>));</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">canvas</span>.<span class="property">width</span> = <span class="variable language_">this</span>.<span class="property">L</span> * <span class="variable language_">this</span>.<span class="property">cols</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">canvas</span>.<span class="property">height</span> = <span class="variable language_">this</span>.<span class="property">L</span> * <span class="variable language_">this</span>.<span class="property">rows</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">update</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="comment">// 正方形的大小 自适应变化</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">update_size</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">render</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;<span class="comment">//渲染    </span></span><br><span class="line">        <span class="keyword">const</span> color_even = <span class="string">&#x27;#AAD751&#x27;</span><span class="comment">//偶数颜色</span></span><br><span class="line">        <span class="keyword">const</span> color_odd = <span class="string">&#x27;#A2D149&#x27;</span><span class="comment">//奇数颜色</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> r = <span class="number">0</span> ; r &lt; <span class="variable language_">this</span>.<span class="property">rows</span>; r++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">let</span> c = <span class="number">0</span>; c &lt; <span class="variable language_">this</span>.<span class="property">cols</span>; c++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(( r + c ) % <span class="number">2</span> == <span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">fillStyle</span> = color_even;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">fillStyle</span> = color_odd;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">fillRect</span>(c* <span class="variable language_">this</span>.<span class="property">L</span>, r* <span class="variable language_">this</span>.<span class="property">L</span>, <span class="variable language_">this</span>.<span class="property">L</span>, <span class="variable language_">this</span>.<span class="property">L</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="蛇的运动"><a href="#蛇的运动" class="headerlink" title="蛇的运动"></a>蛇的运动</h2><p>先来解决之前存在的一个问题，在13*13的地图环境下：</p>
<p>两条蛇的初始坐标为（11,1）和（1,11）</p>
<p>（11,1）起点，横纵坐标相加为偶数，随着运动，奇数，偶数，…</p>
<p>（1,11）起点，横纵坐标相加为偶数，随着运动，奇数，偶数，…</p>
<p>由于同一时刻，奇偶性相同，因此，有可能走到同一个格子中。</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed94ed9c0.png" alt="springboot2-16.png"></p>
<p>修改，对应的起点（11,1）和（1,12）所以两条蛇一定不会走到同一个格子里。</p>
<p>相应的，对称的布局应该为中心对称</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed95d2188.png" alt="springboot2-17.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed96c57da.png" alt="springboot2-18.png"></p>
<h3 id="创建单元类Cell"><a href="#创建单元类Cell" class="headerlink" title="创建单元类Cell"></a>创建单元类Cell</h3><p>在构造器中，传入行(r)和列(c)信息，并将其转换为坐标信息</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed97ba11e.png" alt="springboot2-19.png"></p>
<p><code>src\assets\scripts\Cell.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Cell</span>&#123;</span><br><span class="line">    <span class="comment">//r表示行 c表示列</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">r,c</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">r</span> = r;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">c</span> = c;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">x</span> = c + <span class="number">0.5</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">y</span> = r + <span class="number">0.5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建蛇类Snack"><a href="#创建蛇类Snack" class="headerlink" title="创建蛇类Snack"></a>创建蛇类Snack</h3><p><code>src\assets\scripts\Snack.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">GameObject</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./GameObject&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Cell</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./Cell&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Snake</span> <span class="keyword">extends</span> <span class="title class_ inherited__">GameObject</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">info, gamemap</span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">id</span> = info.<span class="property">id</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">color</span> = info.<span class="property">color</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gamemap</span> = gamemap;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cells</span> = [<span class="keyword">new</span> <span class="title class_">Cell</span>(info.<span class="property">r</span>, info.<span class="property">c</span>)]; <span class="comment">//存放蛇的身体 cells[0]存放蛇头</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">render</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实例化蛇类"><a href="#实例化蛇类" class="headerlink" title="实例化蛇类"></a>实例化蛇类</h3><p>在<code>src\assets\scripts\GameMap.js</code>中，将两条蛇创建出来（也就是实例化两个Snack类的对象）</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed98dced2.png" alt="springboot2-20.png"></p>
<h3 id="将蛇画出来"><a href="#将蛇画出来" class="headerlink" title="将蛇画出来"></a>将蛇画出来</h3><p><code>src\assets\scripts\Snack.js</code></p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed99482b9.png" alt="springboot2-21.png"></p>
<p>效果如下：</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed98955e1.png" alt="springboot2-22.png"></p>
<h3 id="蛇的运动-1"><a href="#蛇的运动-1" class="headerlink" title="蛇的运动"></a>蛇的运动</h3><h4 id="怎么动"><a href="#怎么动" class="headerlink" title="怎么动"></a>怎么动</h4><p>1）如果只有一个单元</p>
<p>定义一个速度变量<code>speed</code>，并且在每一帧的刷新函数中，计算蛇的坐标</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed9a8fb76.png" alt="springboot2-23.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed9a87ae6.png" alt="springboot2-24.png"></p>
<p>2）如果多个单元</p>
<p>例如下面的场景向右移动一格</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed9a8b4ca.png" alt="springboot2-25.png"></p>
<p>但魔鬼都在细节之中，正常移动的过程会产生不连贯的现象</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed9b2a5a4.png" alt="springboot2-26.png"></p>
<p>那如何更好的移动的呢：</p>
<p>创建一个虚拟头结点，只让虚拟头结点和尾结点移动，其余结点保持不变。这样在拐角处一直保持连贯性。</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed9b90764.png" alt="springboot2-27.png"></p>
<h4 id="什么时候动"><a href="#什么时候动" class="headerlink" title="什么时候动"></a>什么时候动</h4><p>由于我们设计的是回合制游戏，所以需要当判断出两条蛇都有下一步指令的时候，才应该按照指令，分别动一步。</p>
<p>首先在<code>src\assets\scripts\Snack.js</code>记录当前蛇收到的指令，以及蛇的状态</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed9b87704.png" alt="springboot2-28.png"></p>
<p>其次，还要有裁判来判断蛇是否能动（不能由蛇自己判断 运动员本身不能当裁判）</p>
<p>我们将裁判的逻辑放在<code>src\assets\scripts\GameMap.js</code>中</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed9fbf47a.png" alt="springboot2-29.png"></p>
<p>如果准备好了下一回合，就让蛇走下一步：</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed9e88e8e.png" alt="springboot2-30.png"></p>
<p><code>src\assets\scripts\Snack.js</code>中，蛇走下一步函数的定义如下：</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed9d87c62.png" alt="springboot2-31.png"></p>
<h4 id="获取用户操作"><a href="#获取用户操作" class="headerlink" title="获取用户操作"></a>获取用户操作</h4><p>在<code>src\components\GameMap.vue</code>中给<code>canvas</code>新增属性<code>tabindex=&quot;0&quot;</code>，可以获取用户操作</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed9e02931.png" alt="springboot2-32.png"></p>
<p>在<code>src\assets\scripts\GameMap.js</code>中为<code>canvas</code>绑定一个获取用户输入信息的事件</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791eda19cff9.png" alt="springboot2-33.png"></p>
<h4 id="控制蛇的移动"><a href="#控制蛇的移动" class="headerlink" title="控制蛇的移动"></a>控制蛇的移动</h4><p>对于蛇的移动来说</p>
<p>先考虑除了头元素之外的其他元素</p>
<p>蛇的前进是新增头元素（有时砍掉尾元素的过程 后面会讲到）</p>
<p> 而新增头元素，剩余其他的下标顺序都要往后移动</p>
<p>在<code>src\assets\scripts\Snack.js</code>中 </p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ed9f4e2e1.png" alt="springboot2-34.png"></p>
<p>此时<code>cell[0]</code>的位置就腾出来了，然后需要将<code>cell[0]</code>指向<code>next_vell</code>的位置</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791eda0517a4.png" alt="springboot2-35.png"></p>
<p>先看下如何移动蛇头元素：</p>
<h5 id="蛇头移动"><a href="#蛇头移动" class="headerlink" title="蛇头移动"></a>蛇头移动</h5><p> 需要根据与目标元素（也就是<code>next_cell</code>）的的位置和蛇头当前的位置（<code>this.cells[0]</code>）来决定<code>this.cells[0]</code>的<code>x</code>和<code>y</code>坐标接下来的变化。</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791eda1748da.png" alt="springboot2-36.png"></p>
<p>此时已经可以达到移动效果：</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791eda1b0788.png" alt="springboot2-37.png"></p>
<p>此时实现了蛇头的移动，但是还没有实现蛇尾移动。</p>
<h5 id="蛇尾移动"><a href="#蛇尾移动" class="headerlink" title="蛇尾移动"></a>蛇尾移动</h5><p>首先在<code>src\assets\scripts\Snack.js</code>增加判断蛇的长度是否增加的函数</p>
<p>我们规定，前10回合，蛇的长度每回合+1，后面的回合，每3回合+1，也就是第13,16,19…</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791eda241173.png" alt="springboot2-38.png"></p>
<p>如果需要变长，那么蛇尾不动即可；如果不变长，那么蛇尾就要跟着蛇头移动（并且移动完，要将蛇尾砍掉，从对象数组中移走）于是在<code>update_move()</code>中更新如下</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791eda34c941.png" alt="springboot2-39.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791eda3dd453.png" alt="springboot2-40.png"></p>
<h5 id="美化"><a href="#美化" class="headerlink" title="美化"></a>美化</h5><p>1）让蛇形体更连贯</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791eda499580.png" alt="springboot2-41.png"></p>
<p>2）让蛇更瘦</p>
<p>更新<code>render()</code></p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791eda453572.png" alt="springboot2-42.png"></p>
<h4 id="合法性判断"><a href="#合法性判断" class="headerlink" title="合法性判断"></a>合法性判断</h4><p>我们还要在<code>src\assets\scripts\GameMap.js</code>中加入合法性判断，用于检测目标位置是否合法</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791eda505a6d.png" alt="springboot2-43.png"></p>
<p>在<code>src\assets\scripts\Snack.js</code>中的<code>next_step()</code>，要针对这种判断做出反应</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791eda5ee93f.png" alt="springboot2-44.png"></p>
<p>并在<code>render()</code>中加入绘图逻辑，当蛇over的时候，颜色变白</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791eda5e58c2.png" alt="springboot2-45.png"></p>
<p>结果展示：</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791eda644673.png" alt="springboot2-46.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791eda77414f.png" alt="springboot2-47.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791eda7d33cd.png" alt="springboot2-48.png"></p>
<p>往回走也是不行，因为相当于自己和之前的cell装机</p>
<p>注意，两条蛇的合法性判断是独立的。当两条蛇的蛇头位置都不合法时，平局</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791eda801e0e.png" alt="springboot2-49.png"></p>
<h3 id="蛇的美化"><a href="#蛇的美化" class="headerlink" title="蛇的美化"></a>蛇的美化</h3><p>为蛇头添加眼睛</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791eda86559c.png" alt="springboot2-50.png"></p>
<p>初始化<code>Snack</code>类时候，初始化一个<code>eye_direction</code>变量表示蛇的眼睛方向</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791edaa1abb3.png" alt="springboot2-51.png"></p>
<p>然后在每次执行<code>next_step()</code>函数时，更新<code>eye_direction</code>变量</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791eda8d35a5.png" alt="springboot2-52.png"></p>
<p>计算蛇眼睛在不同方向上的偏移量</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ee040222f.png" alt="springboot2-53.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ee0399bb2.png" alt="springboot2-54.png"></p>
<p>最后在<code>render()</code>函数中画蛇眼睛</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ee048c79d.png" alt="springboot2-55.png"></p>
<p>然后保存代码：</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ee053684c.png" alt="springboot2-56.png"></p>
<p>查看历史记录</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791ee044c3f5.png" alt="springboot2-57.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/01/23/Springboot-%E5%88%9B%E5%BB%BA%E8%8F%9C%E5%8D%95%E5%92%8C%E6%B8%B8%E6%88%8F%E7%95%8C%E9%9D%A2/" data-id="cm8sja97e001l8ktbcohacded" data-title="Springboot-创建菜单和游戏界面" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Springboot/" rel="tag">Springboot</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Vue实现个人空间-下" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/01/23/Vue%E5%AE%9E%E7%8E%B0%E4%B8%AA%E4%BA%BA%E7%A9%BA%E9%97%B4-%E4%B8%8B/" class="article-date">
  <time class="dt-published" datetime="2025-01-23T06:30:15.000Z" itemprop="datePublished">2025-01-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web/">Web</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/01/23/Vue%E5%AE%9E%E7%8E%B0%E4%B8%AA%E4%BA%BA%E7%A9%BA%E9%97%B4-%E4%B8%8B/">Vue实现个人空间-下</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="10-用户列表页面实现"><a href="#10-用户列表页面实现" class="headerlink" title="10. 用户列表页面实现"></a>10. 用户列表页面实现</h3><p>从云端将用户列表读进来</p>
<ol>
<li>安装 <code>npm i jquery</code> 使用ajax</li>
<li>页面中<code>import $ from &#39;jquery&#39;;</code></li>
</ol>
<p>从云端动态获取用户（使用AJAX）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;contentElem&gt;用户列表&lt;/contentElem&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import contentElem from &quot;../components/contentElem.vue&quot;;</span><br><span class="line">import $ from &#x27;jquery&#x27;;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;UserList&#x27;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    contentElem,</span><br><span class="line">  &#125;,</span><br><span class="line">  setup()&#123;</span><br><span class="line">    let users= ref([]);</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        url:&quot;https://app165.acapp.acwing.com.cn/myspace/userlist/&quot;,</span><br><span class="line">        type:&quot;get&quot;,</span><br><span class="line">        success(resp)&#123;</span><br><span class="line">          console.log(resp);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">      users</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>使用bootstrap的 Grid system进行布局：<br><img src="https://www.helloimg.com/i/2025/01/26/6795f53af2ffc.png" alt="vue17.png"><br>微调样式，<br><img src="https://www.helloimg.com/i/2025/01/26/6795f53b808d7.png" alt="vue18.png"><br>访问不存在的页面，则跳转到404：<br><img src="https://www.helloimg.com/i/2025/01/26/6795f53c0c416.png" alt="vue19.png"></p>
<p>给链接加上id<br><img src="https://www.helloimg.com/i/2025/01/26/6795f53d106c8.png" alt="vue20.png"><br>路由中需要添加参数，用<code>:</code><br><img src="https://www.helloimg.com/i/2025/01/26/6795f53ab24d6.png" alt="vue21.png"><br>对应的UserProfileView中，使用提供的useRoute接口，即可获取这个参数<br><img src="https://www.helloimg.com/i/2025/01/26/6795f53c04f8c.png" alt="vue22.png"><br><img src="https://www.helloimg.com/i/2025/01/26/6795f53dd1ad4.png" alt="vue23.png"></p>
<h3 id="11-实现登录页面"><a href="#11-实现登录页面" class="headerlink" title="11. 实现登录页面"></a>11. 实现登录页面</h3><p>需要双向绑定两个变量username，password<br><img src="https://www.helloimg.com/i/2025/01/26/6795f54c48004.png" alt="vue24.png"><br><img src="https://www.helloimg.com/i/2025/01/26/6795f540d0405.png" alt="vue25.png"><br><img src="https://www.helloimg.com/i/2025/01/26/6795f53f29cbb.png" alt="vue26.png"><br><img src="https://www.helloimg.com/i/2025/01/26/6795f5403b45c.png" alt="vue27.png"><br><img src="https://www.helloimg.com/i/2025/01/26/6795f54236759.png" alt="vue28.png"><br><img src="https://www.helloimg.com/i/2025/01/26/6795f5440db49.png" alt="vue29.png"><br>ref中的值需要.value访问<br><img src="https://www.helloimg.com/i/2025/01/26/6795f5440db49.png" alt="vue29.png"><br>阻止默认行为<br><img src="https://www.helloimg.com/i/2025/01/26/6795f54236759.png" alt="vue28.png"></p>
<h4 id="11-1-vuex"><a href="#11-1-vuex" class="headerlink" title="11.1 vuex"></a>11.1 vuex</h4><p>因为很多前端行为需要获得用户信息，所以要将登录的用户信息存到全局变量中——此时需要vuex<br>交互：<br><img src="https://www.helloimg.com/i/2025/01/26/6795f5420cc12.png" alt="vue30.png"><br>vuex创建的全局唯一对象：<br>&#x2F;store&#x2F;index.js<br><img src="https://www.helloimg.com/i/2025/01/26/6795f543a0251.png" alt="vue31.png"><br><img src="https://www.helloimg.com/i/2025/01/26/6795f545d2d68.png" alt="vue32.png"><br><img src="https://www.helloimg.com/i/2025/01/26/6795f547ab940.png" alt="vue33.png"><br>访问：</p>
<p><img src="https://www.helloimg.com/i/2025/01/26/6795f548ecb70.png" alt="vue34.png"></p>
<h5 id="11-1-1-传统登录方式"><a href="#11-1-1-传统登录方式" class="headerlink" title="11.1.1 传统登录方式"></a>11.1.1 传统登录方式</h5><p><img src="https://www.helloimg.com/i/2025/01/26/6795f5468f48c.png" alt="vue35.png"><br>存到cookie中，跨域时难处理。</p>
<h5 id="11-1-2-JWT方式"><a href="#11-1-2-JWT方式" class="headerlink" title="11.1.2 JWT方式"></a>11.1.2 JWT方式</h5><p>json web token<br><img src="https://www.helloimg.com/i/2025/01/26/6795f54a3ee63.png" alt="vue36.png"></p>
<h4 id="11-2-实现登录"><a href="#11-2-实现登录" class="headerlink" title="11.2 实现登录"></a>11.2 实现登录</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vuex：存储全局状态，全局唯一。</span><br><span class="line">	state: 存储所有数据，可以用modules属性划分成若干模块</span><br><span class="line">	getters：根据state中的值计算新的值</span><br><span class="line">	mutations：所有对state的修改操作都需要定义在这里，不支持异步，可以通过$store.commit()触发</span><br><span class="line">	actions：定义对state的复杂修改操作，支持异步，可以通过$store.dispatch()触发。注意不能直接修改state，只能通过mutations修改state。</span><br><span class="line">	modules：定义state的子模块</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>dispatch调用store中的事件<br><img src="https://www.helloimg.com/i/2025/01/26/6795f55100138.png" alt="vue37.png"><br>附注：使用ajax需要<code>import $ from &#39;jquery&#39;;</code>\</p>
<p><img src="https://www.helloimg.com/i/2025/01/26/6795f549a2567.png" alt="vue38.png"><br>从获得的access字符串中解码出用户信息，需要安装一个解码包<br><img src="https://www.helloimg.com/i/2025/01/26/6795f54d203b8.png" alt="vue39.png"><br>然后在user.js中引入<br><code>import jwt_decode from &#39;jwt-decode&#39;;</code></p>
<p>使用：<br><code>const access_obj=jwt_decode(access);</code></p>
<p>纯背过：用于授权<br><img src="https://www.helloimg.com/i/2025/01/26/6795f54b9a955.png" alt="vue40.png"><br><img src="https://www.helloimg.com/i/2025/01/26/6795f54d26b84.png" alt="vue41.png"><br>可以成功获得现在登录的用户信息：<br><img src="https://www.helloimg.com/i/2025/01/26/6795f54d47be4.png" alt="vue42.png"><br>有了这些信息后，要将这些信息存到state里面：<br>但是action里面是不能直接更新的，要通过mutations</p>
<p><img src="https://www.helloimg.com/i/2025/01/26/6795f54f59908.png" alt="vue43.png"><br>完整版user.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">import $ from &#x27;jquery&#x27;;</span><br><span class="line">import jwt_decode from &#x27;jwt-decode&#x27;;</span><br><span class="line">const ModuleUser=&#123;</span><br><span class="line">    state: &#123;</span><br><span class="line">        id:&quot;&quot;,</span><br><span class="line">        username:&quot;&quot;,</span><br><span class="line">        photo:&quot;&quot;,</span><br><span class="line">        followerCount:&quot;&quot;,</span><br><span class="line">        access:&quot;&quot;,</span><br><span class="line">        refresh:&quot;&quot;,</span><br><span class="line">        is_login:false,</span><br><span class="line">    &#125;,</span><br><span class="line">    getters: &#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    mutations: &#123;</span><br><span class="line">        updateUser(state,user)&#123;//第一个参数是state，第二个参数是自己定义的</span><br><span class="line">            state.id=user.id;</span><br><span class="line">            state.username=user.username;</span><br><span class="line">            state.photo=user.photo;</span><br><span class="line">            state.followerCount=user.followerCount;</span><br><span class="line">            state.access=user.access;</span><br><span class="line">            state.refresh=user.refresh;</span><br><span class="line">            state.is_login=user.is_login;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    actions: &#123;</span><br><span class="line">        login(context,data)&#123; //context 传api，data传一些信息(dispatch的参数)</span><br><span class="line">            $.ajax(&#123;</span><br><span class="line">                url:&quot;https://app165.acapp.acwing.com.cn/api/token/&quot;,</span><br><span class="line">                type: &quot;POST&quot;,</span><br><span class="line">                data:&#123;</span><br><span class="line">                    username: data.username,</span><br><span class="line">                    password: data.password,</span><br><span class="line">                &#125;,</span><br><span class="line">                success(resp)&#123;</span><br><span class="line">                   // console.log(resp);</span><br><span class="line">                //    const access=resp.access;</span><br><span class="line">                //    const refresh=resp.refresh;</span><br><span class="line">                   const &#123;access,refresh&#125;=resp; //ES6语法</span><br><span class="line">                   const access_obj=jwt_decode(access);</span><br><span class="line">                 //  console.log(access_obj,refresh);</span><br><span class="line">                 //然后可以根据其中的user_id和我们的api去获取信息</span><br><span class="line">                 $.ajax(&#123;</span><br><span class="line">                    url:&quot;https://app165.acapp.acwing.com.cn/myspace/getinfo/&quot;,</span><br><span class="line">                    type:&quot;GET&quot;,</span><br><span class="line">                    data:&#123;</span><br><span class="line">                        user_id:access_obj.user_id,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    headers:&#123;</span><br><span class="line">                        &#x27;Authorization&#x27;:&quot;Bearer &quot;+access,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    success(resp)&#123;</span><br><span class="line">                        context.commit(&quot;updateUser&quot;,&#123;</span><br><span class="line">                            ...resp,</span><br><span class="line">                            access:access,</span><br><span class="line">                            refresh:refresh,</span><br><span class="line">                            is_login:true,</span><br><span class="line">                        &#125;);</span><br><span class="line">                        data.success();</span><br><span class="line">                    &#125;,</span><br><span class="line">                    error()&#123;</span><br><span class="line">                        data.error();</span><br><span class="line">                    &#125;</span><br><span class="line">                 &#125;)</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    modules: &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default ModuleUser;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>LoginView.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;contentElem&gt;</span><br><span class="line">      &lt;div class=&quot;row justify-content-md-center&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;col-3&quot;&gt;</span><br><span class="line">              &lt;form @click.prevent=&quot;login&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;mb-3&quot;&gt;</span><br><span class="line">                  &lt;label for=&quot;username&quot; class=&quot;form-label&quot;&gt;用户名&lt;/label&gt;</span><br><span class="line">                  &lt;input v-model=&quot;username&quot; type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;username&quot;&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;mb-3&quot;&gt;</span><br><span class="line">                  &lt;label for=&quot;password&quot; class=&quot;form-label&quot;&gt;密码&lt;/label&gt;</span><br><span class="line">                  &lt;input v-model=&quot;password&quot; type=&quot;password&quot; class=&quot;form-control&quot; id=&quot;password&quot;&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;error-message&quot;&gt;&#123;&#123;error_message&#125;&#125;&lt;/div&gt;</span><br><span class="line">                &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;登录&lt;/button&gt;</span><br><span class="line">              &lt;/form&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/contentElem&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import contentElem from &quot;../components/contentElem.vue&quot;;</span><br><span class="line">import &#123; ref &#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; useStore &#125; from &quot;vuex&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;UserList&#x27;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    contentElem,</span><br><span class="line">&#125;,</span><br><span class="line">setup()&#123;</span><br><span class="line">  let username=ref(&#x27;&#x27;);</span><br><span class="line">  let password=ref(&#x27;&#x27;);</span><br><span class="line">  let error_message=ref(&#x27;&#x27;);</span><br><span class="line">  const store=useStore();</span><br><span class="line">  const login=()=&gt;&#123;</span><br><span class="line">    // console.log(username.value);</span><br><span class="line">    // console.log(password.value);</span><br><span class="line">    //如果想调用外面action中的一个api，用dispatch</span><br><span class="line">    store.dispatch(&quot;login&quot;,&#123;</span><br><span class="line">      username:username.value,</span><br><span class="line">      password:password.value,</span><br><span class="line">      success()&#123;</span><br><span class="line">        console.log(&quot;success&quot;);</span><br><span class="line">      &#125;,</span><br><span class="line">      error()&#123;</span><br><span class="line">        console.log(&quot;fail&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return &#123;</span><br><span class="line">    username,</span><br><span class="line">    password,</span><br><span class="line">    error_message,</span><br><span class="line">    login</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.error-message&#123;</span><br><span class="line">  color: red;</span><br><span class="line">&#125;</span><br><span class="line">button&#123;</span><br><span class="line">  float: right;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="11-3-使用refresh刷新access"><a href="#11-3-使用refresh刷新access" class="headerlink" title="11.3 使用refresh刷新access"></a>11.3 使用refresh刷新access</h4><p>因为5分钟access会过期，所以需要用到refresh进行刷新。</p>
<p>方法1. 访问的时候发现access过期了，此时去获取一个新的access<br>方法2. 每隔五分钟获取一次access，调用刷线access的接口，每五分钟一次</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">setInterval(()=&gt;&#123;</span><br><span class="line">   $.ajax(&#123;</span><br><span class="line">       url:&quot;https://app165.acapp.acwing.com.cn/api/token/refresh/&quot;,</span><br><span class="line">       type:&quot;POST&quot;,</span><br><span class="line">       data:&#123;</span><br><span class="line">           refresh:access_obj.refresh,</span><br><span class="line">       &#125;,</span><br><span class="line">       success(resp)&#123;</span><br><span class="line">           context.commit(&quot;updateAccess&quot;,resp.access);</span><br><span class="line"></span><br><span class="line">       &#125;,</span><br><span class="line">       error()&#123;</span><br><span class="line">           data.error();</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">   &#125;);</span><br><span class="line"></span><br><span class="line">&#125;,4.5*60*1000);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="12-登录后跳转到用户列表页面"><a href="#12-登录后跳转到用户列表页面" class="headerlink" title="12. 登录后跳转到用户列表页面"></a>12. 登录后跳转到用户列表页面</h3><ol>
<li><p>引入router<br><img src="https://www.helloimg.com/i/2025/01/26/6795f5500a7e5.png" alt="vue44.png"></p>
</li>
<li><p>使用api<br><img src="https://www.helloimg.com/i/2025/01/26/6795f5512a46b.png" alt="vue45.png"></p>
</li>
</ol>
<h3 id="13-登录后修改展示页面"><a href="#13-登录后修改展示页面" class="headerlink" title="13. 登录后修改展示页面"></a>13. 登录后修改展示页面</h3><p>NavBar修改一下。让这些页面都符合逻辑<br>想要获取store中的全局变量，可以使用<code>$ xxx</code><br><img src="https://www.helloimg.com/i/2025/01/26/6795f55093ccc.png" alt="vue46.png"><br><img src="https://www.helloimg.com/i/2025/01/26/6795f55732aac.png" alt="vue47.png"></p>
<h3 id="14-实现退出"><a href="#14-实现退出" class="headerlink" title="14. 实现退出"></a>14. 实现退出</h3><p>只需要写一个事件即可。<br><img src="https://www.helloimg.com/i/2025/01/26/6795f55670a10.png" alt="vue48.png"><br>凡是要修改全局state，要把事件写到action&#x2F;mutations里面 （需要store）<br><img src="https://www.helloimg.com/i/2025/01/26/6795f5544e095.png" alt="vue49.png"></p>
<h3 id="15-未登录时的跳转"><a href="#15-未登录时的跳转" class="headerlink" title="15. 未登录时的跳转"></a>15. 未登录时的跳转</h3><p>userList.vue<br><img src="https://www.helloimg.com/i/2025/01/26/6795f55550460.png" alt="vue50.png"><br>点击时触发函数：<br><img src="https://www.helloimg.com/i/2025/01/26/6795f5553158b.png" alt="vue51.png"></p>
<h3 id="16-用户动态从云端获取"><a href="#16-用户动态从云端获取" class="headerlink" title="16. 用户动态从云端获取"></a>16. 用户动态从云端获取</h3><p>用户动态页面根据userId的改变而改变。<br>还是ajax！<br><img src="https://www.helloimg.com/i/2025/01/26/6795f557ea893.png" alt="vue52.png"></p>
<h3 id="17-判断发帖子模块是否需要"><a href="#17-判断发帖子模块是否需要" class="headerlink" title="17. 判断发帖子模块是否需要"></a>17. 判断发帖子模块是否需要</h3><p>只有在自己的页面才能发帖子。<br><img src="https://www.helloimg.com/i/2025/01/26/6795f556c8acf.png" alt="vue53.png"></p>
<h3 id="18-用完整链接判断页面是否相同"><a href="#18-用完整链接判断页面是否相同" class="headerlink" title="18. 用完整链接判断页面是否相同"></a>18. 用完整链接判断页面是否相同</h3><p>App.vue<br><img src="https://www.helloimg.com/i/2025/01/26/6795f557c5bed.png" alt="vue54.png"><br>默认是用页面的name判断的，都叫userprofile，所以到别人页面，再点击自己的，就会出现不刷新不跳转的情况。</p>
<h3 id="19-从前端删除到真的删除"><a href="#19-从前端删除到真的删除" class="headerlink" title="19. 从前端删除到真的删除"></a>19. 从前端删除到真的删除</h3><p><img src="https://www.helloimg.com/i/2025/01/26/6795f558ef810.png" alt="vue55.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/26/6795f55a290b1.png" alt="vue56.png"></p>
<h3 id="20-部署"><a href="#20-部署" class="headerlink" title="20. 部署"></a>20. 部署</h3><ol>
<li>build 打包成可以发布的版本</li>
</ol>
<p><img src="https://www.helloimg.com/i/2025/01/26/6795f55a413ac.png" alt="vue57.png"><br>2. 打包<br><img src="https://www.helloimg.com/i/2025/01/26/6795f55d268b3.png" alt="vue58.png"><br>3. 传到服务器上</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/01/23/Vue%E5%AE%9E%E7%8E%B0%E4%B8%AA%E4%BA%BA%E7%A9%BA%E9%97%B4-%E4%B8%8B/" data-id="cm8sja97u003x8ktb5sg3bve5" data-title="Vue实现个人空间-下" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vue/" rel="tag">Vue</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Vue实现个人空间-上" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/01/23/Vue%E5%AE%9E%E7%8E%B0%E4%B8%AA%E4%BA%BA%E7%A9%BA%E9%97%B4-%E4%B8%8A/" class="article-date">
  <time class="dt-published" datetime="2025-01-23T06:29:10.000Z" itemprop="datePublished">2025-01-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web/">Web</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/01/23/Vue%E5%AE%9E%E7%8E%B0%E4%B8%AA%E4%BA%BA%E7%A9%BA%E9%97%B4-%E4%B8%8A/">Vue实现个人空间-上</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Vue实现个人空间"><a href="#Vue实现个人空间" class="headerlink" title="Vue实现个人空间"></a>Vue实现个人空间</h1><h2 id="Vue3——网站整体布局、用户动态页面"><a href="#Vue3——网站整体布局、用户动态页面" class="headerlink" title="Vue3——网站整体布局、用户动态页面"></a>Vue3——网站整体布局、用户动态页面</h2><h3 id="1-前端渲染逻辑"><a href="#1-前端渲染逻辑" class="headerlink" title="1. 前端渲染逻辑"></a>1. 前端渲染逻辑</h3><p>前端渲染：只有第一次打开页面的时候，向服务器发送请求，服务器返回所有js， 之后再打开页面，前端用返回的js文件将页面渲染出来。</p>
<h3 id="2-vue文件"><a href="#2-vue文件" class="headerlink" title="2. vue文件"></a>2. vue文件</h3><p>一个vue文件由三部分组成，html，js，css<br>css部分标签 ，加上<strong>scoped</strong>，不同组件之间的css选择器就不会相互影响到了。</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791df8546a3e.png" alt="vue1.png"></p>
<h3 id="3-组件化的框架"><a href="#3-组件化的框架" class="headerlink" title="3.组件化的框架"></a>3.组件化的框架</h3><ul>
<li>可以拆分实现</li>
</ul>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791df8512fd2.png" alt="vue2.png"></p>
<ul>
<li>引入组件的方式（根组件App.vue）</li>
</ul>
<p>项目初始化自带一个HelloWorld组件，引入方式如下</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791df84e4902.png" alt="vue3.png"></p>
<h3 id="4-项目结构"><a href="#4-项目结构" class="headerlink" title="4.项目结构"></a>4.项目结构</h3><p>网页分为导航栏NavBar和内容Content。总共要实现六个页面，每个页面都可以用一个组件来实现</p>
<ul>
<li>NavBar</li>
<li>Content<ul>
<li>首页</li>
<li>好友列表</li>
<li>好友动态</li>
<li>登录</li>
<li>注册</li>
<li>404</li>
</ul>
</li>
</ul>
<h3 id="5-准备工作"><a href="#5-准备工作" class="headerlink" title="5.准备工作"></a>5.准备工作</h3><p>引入bootstrap，在根组件app.vue中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  import &#x27;bootstrap/dist/css/bootstrap.css&#x27;;</span><br><span class="line">  import &#x27;bootstrap/dist/js/bootstrap&#x27;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>引入后提示需要再装一个模块</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791df84d6841.png" alt="vue4.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791df8501d30.png" alt="vue5.png"></p>
<h3 id="6-实现导航栏"><a href="#6-实现导航栏" class="headerlink" title="6.实现导航栏"></a>6.实现导航栏</h3><ol>
<li>实现导航栏组件——直接使用<a target="_blank" rel="noopener" href="https://getbootstrap.com/docs/5.3/getting-started/introduction/">bootstrap</a>选取需要的元素，将组件export出去</li>
</ol>
<p>NavBar.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 导航栏开始 --&gt;</span><br><span class="line">  &lt;nav class=&quot;navbar navbar-expand-lg bg-body-tertiary&quot;&gt;</span><br><span class="line">    &lt;!-- 容器，用于包裹导航栏内容 --&gt;</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">      &lt;!-- 品牌/logo --&gt;</span><br><span class="line">      &lt;a class=&quot;navbar-brand&quot; href=&quot;#&quot;&gt;Myspace&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 响应式导航栏的切换按钮 --&gt;</span><br><span class="line">      &lt;button</span><br><span class="line">        class=&quot;navbar-toggler&quot;</span><br><span class="line">        type=&quot;button&quot;</span><br><span class="line">        data-bs-toggle=&quot;collapse&quot;</span><br><span class="line">        data-bs-target=&quot;#navbarText&quot;</span><br><span class="line">        aria-controls=&quot;navbarText&quot;</span><br><span class="line">        aria-expanded=&quot;false&quot;</span><br><span class="line">        aria-label=&quot;Toggle navigation&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;!-- 切换按钮的图标 --&gt;</span><br><span class="line">        &lt;span class=&quot;navbar-toggler-icon&quot;&gt;&lt;/span&gt;</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 导航栏内容，支持折叠 --&gt;</span><br><span class="line">      &lt;div class=&quot;collapse navbar-collapse&quot; id=&quot;navbarText&quot;&gt;</span><br><span class="line">        &lt;!-- 导航栏左侧的链接 --&gt;</span><br><span class="line">        &lt;ul class=&quot;navbar-nav me-auto mb-2 mb-lg-0&quot;&gt;</span><br><span class="line">          &lt;!-- 首页链接 --&gt;</span><br><span class="line">          &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">            &lt;a class=&quot;nav-link active&quot; aria-current=&quot;page&quot; href=&quot;#&quot;&gt;首页&lt;/a&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">          &lt;!-- 好友列表链接 --&gt;</span><br><span class="line">          &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">            &lt;a class=&quot;nav-link&quot; href=&quot;#&quot;&gt;好友列表&lt;/a&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">          &lt;!-- 用户动态链接 --&gt;</span><br><span class="line">          &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">            &lt;a class=&quot;nav-link&quot; href=&quot;#&quot;&gt;用户动态&lt;/a&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 导航栏右侧的链接 --&gt;</span><br><span class="line">        &lt;ul class=&quot;navbar-nav&quot;&gt;</span><br><span class="line">          &lt;!-- 登录链接 --&gt;</span><br><span class="line">          &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">            &lt;a class=&quot;nav-link&quot; href=&quot;#&quot;&gt;登录&lt;/a&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">          &lt;!-- 注册链接 --&gt;</span><br><span class="line">          &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">            &lt;a class=&quot;nav-link&quot; href=&quot;#&quot;&gt;注册&lt;/a&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/nav&gt;</span><br><span class="line">  &lt;!-- 导航栏结束 --&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">// 导出组件</span><br><span class="line">export default &#123;</span><br><span class="line">  // 组件名称</span><br><span class="line">  name: &#x27;NavBar&#x27;,</span><br><span class="line">  // 注册子组件（当前没有子组件，所以为空）</span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">/* 这里可以定义组件的样式 */</span><br><span class="line">/* scoped 表示样式仅作用于当前组件 */</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在根组件(app.vue)将实现的NavBar引入——引入路径，在components对象中添加组件名，同时在template中引入组件</li>
</ol>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791df85a52d1.png" alt="vue6.png"></p>
<h3 id="7-写内容里的六个小组件"><a href="#7-写内容里的六个小组件" class="headerlink" title="7.写内容里的六个小组件"></a>7.写内容里的六个小组件</h3><p>对于一个比较大的组件，可以拆分为多个组件<br><strong>首页组件(HomeView.vue)</strong><br>可以在<a target="_blank" rel="noopener" href="https://getbootstrap.com/docs/5.3/getting-started/introduction/">bootstrap</a>中找个card组件，然后用container包起来，container是用来动态调位置的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;home&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;card&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;card-body&quot;&gt;</span><br><span class="line">          首页</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">// @ is an alias to /src</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;HomeView&#x27;,</span><br><span class="line">  components: &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.container &#123;</span><br><span class="line">  margin-top: 20px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>发现这一部分的html和css其实每个页面都一样，要将这块公共部分提取出来作为单独的组件，方便后期整体修改。</p>
<p>可以将内容渲染到 slot标签中(slot可以用来获取子元素)：</p>
<p>写一个组件ContentBase.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 外层容器，用于包裹整个内容区域 --&gt;</span><br><span class="line">  &lt;div class=&quot;home&quot;&gt;</span><br><span class="line">    &lt;!-- Bootstrap 的容器，用于居中内容并添加响应式布局 --&gt;</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">      &lt;!-- 卡片组件，用于展示内容 --&gt;</span><br><span class="line">      &lt;div class=&quot;card&quot;&gt;</span><br><span class="line">        &lt;!-- 卡片的主体部分 --&gt;</span><br><span class="line">        &lt;div class=&quot;card-body&quot;&gt;</span><br><span class="line">          &lt;!-- 插槽，用于接收父组件传递的内容 --&gt;</span><br><span class="line">          &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">// 导出组件</span><br><span class="line">export default &#123;</span><br><span class="line">  // 组件名称</span><br><span class="line">  name: &#x27;ContentBase&#x27;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">/* 自定义样式 */</span><br><span class="line">.container &#123;</span><br><span class="line">  /* 设置容器的上边距 */</span><br><span class="line">  margin-top: 20px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>然后修改HomeView.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;ContentBase&gt;</span><br><span class="line">        首页</span><br><span class="line">    &lt;/ContentBase&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">  </span><br><span class="line">&lt;script&gt;</span><br><span class="line">import ContentBase from &#x27;@/components/ContentBase.vue&#x27;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">    name: &#x27;HomeView&#x27;,</span><br><span class="line">    components: &#123;</span><br><span class="line">        ContentBase,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">  </span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>实现剩下的好友列表、好友动态、登录、注册、404，这里以好友列表为例，其他的都一样</p>
<p>UserList.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;ContentBase&gt;</span><br><span class="line">        好友列表</span><br><span class="line">    &lt;/ContentBase&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">  </span><br><span class="line">&lt;script&gt;</span><br><span class="line">import ContentBase from &#x27;@/components/ContentBase.vue&#x27;;</span><br><span class="line">  </span><br><span class="line">export default &#123;</span><br><span class="line">    name: &#x27;UserList&#x27;,</span><br><span class="line">    components: &#123;</span><br><span class="line">        ContentBase,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">  </span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="8-添加路由"><a href="#8-添加路由" class="headerlink" title="8.添加路由"></a>8.添加路由</h3><p>router&#x2F;index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">HomeView</span> <span class="keyword">from</span> <span class="string">&#x27;../views/HomeView.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">UserList</span> <span class="keyword">from</span> <span class="string">&#x27;../views/UserList.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">UserProfile</span> <span class="keyword">from</span> <span class="string">&#x27;../views/UserProfile.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">LoginView</span> <span class="keyword">from</span> <span class="string">&#x27;@/views/LoginView.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">RegisterView</span> <span class="keyword">from</span> <span class="string">&#x27;@/views/RegisterView.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">NotFoundView</span> <span class="keyword">from</span> <span class="string">&#x27;@/views/NotFoundView.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">HomeView</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/userlist&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;userlist&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">UserList</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/userprofile&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;userprofile&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">UserProfile</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;login&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">LoginView</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/register&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;register&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">RegisterView</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/notfound&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;notfound&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">NotFoundView</span></span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  <span class="attr">history</span>: <span class="title function_">createWebHistory</span>(),</span><br><span class="line">  routes</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure>

<h3 id="9-实现前端渲染的属性"><a href="#9-实现前端渲染的属性" class="headerlink" title="9.实现前端渲染的属性"></a>9.实现前端渲染的属性</h3><p>想要实现前端渲染，将原本的a标签换成<strong>router-link</strong>标签，有特殊的属性 <code>: to</code> ，注意在vue中绑定属性需要用冒号<code>:</code> 传入name。name就是在路由里面定义的name</p>
<p>例如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;router-link class=&quot;navbar-brand&quot; :to=&quot;&#123;name: &#x27;home&#x27;&#125;&quot;&gt;Myspace&lt;/router-link&gt;</span><br></pre></td></tr></table></figure>

<p>点击 <code>&lt;router-link&gt;</code> 时，Vue Router 会动态更新页面内容，而不会重新加载整个页面。此时点击就会跳转到home对应的路径</p>
<p>如果是下面的代码浏览器会重新加载整个页面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a class=&quot;navbar-brand&quot; href=&quot;/&quot;&gt;Myspace&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p>现在将NavBar.vue全部用router-link</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;nav class=&quot;navbar navbar-expand-lg bg-body-tertiary&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">        &lt;router-link class=&quot;navbar-brand&quot; :to=&quot;&#123;name: &#x27;home&#x27;&#125;&quot;&gt;Myspace&lt;/router-link&gt;</span><br><span class="line">        &lt;button class=&quot;navbar-toggler&quot; type=&quot;button&quot; data-bs-toggle=&quot;collapse&quot; data-bs-target=&quot;#navbarText&quot; aria-controls=&quot;navbarText&quot; aria-expanded=&quot;false&quot; aria-label=&quot;Toggle navigation&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;navbar-toggler-icon&quot;&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">        &lt;div class=&quot;collapse navbar-collapse&quot; id=&quot;navbarText&quot;&gt;</span><br><span class="line">        &lt;ul class=&quot;navbar-nav me-auto mb-2 mb-lg-0&quot;&gt;</span><br><span class="line">            &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">            &lt;router-link class=&quot;nav-link active&quot; aria-current=&quot;page&quot; :to=&quot;&#123;name: &#x27;home&#x27;&#125;&quot;&gt;首页&lt;/router-link&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">            &lt;router-link class=&quot;nav-link&quot; :to=&quot;&#123;name: &#x27;userlist&#x27;&#125;&quot;&gt;好友列表&lt;/router-link&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">            &lt;router-link class=&quot;nav-link&quot; :to=&quot;&#123;name: &#x27;userprofile&#x27;&#125;&quot;&gt;用户动态&lt;/router-link&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">        &lt;ul class=&quot;navbar-nav&quot;&gt;</span><br><span class="line">            &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">            &lt;router-link class=&quot;nav-link&quot; :to=&quot;&#123;name: &#x27;login&#x27;&#125;&quot;&gt;登录&lt;/router-link&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">            &lt;router-link class=&quot;nav-link&quot; :to=&quot;&#123;name: &#x27;register&#x27;&#125;&quot;&gt;注册&lt;/router-link&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;/nav&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">    name: &#x27;NavBar&#x27;,</span><br><span class="line">    components: &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="10-用户动态页面的实现（三个组件）"><a href="#10-用户动态页面的实现（三个组件）" class="headerlink" title="10. 用户动态页面的实现（三个组件）"></a>10. 用户动态页面的实现（三个组件）</h3><p><img src="https://www.helloimg.com/i/2025/01/23/6791df878d766.png" alt="vue7.png"></p>
<p>新建三个组件UserProfileInfo.vue、UserProfilePosts.vue和UserProfileWrite.vue</p>
<p>可以用bootstrap的grid来布局</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;ContentBase&gt;</span><br><span class="line">    &lt;div class=&quot;row&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;col-3&quot;&gt;</span><br><span class="line">            用户信息</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;col-9&quot;&gt;</span><br><span class="line">            帖子列表</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;/ContentBase&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p>现在来实现UserProfileInfo</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;card&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;card-body&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;row&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;col-3&quot;&gt;</span><br><span class="line">                    &lt;img class=&quot;img-fluid&quot; src=&quot;https://cdn.acwing.com/media/user/profile/photo/487342_lg_9a864c18d9.jpg&quot; alt=&quot;&quot;&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;col-9&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;username&quot;&gt;Lzh is coding&lt;/div&gt;</span><br><span class="line">                    &lt;div class=&quot;fans&quot;&gt;fans: 999&lt;/div&gt;</span><br><span class="line">                    &lt;button type=&quot;button&quot; class=&quot;btn btn-secondary btn-sm&quot;&gt;follow&lt;/button&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default&#123;</span><br><span class="line">    name: &#x27;UserProfileInfo&#x27;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">img &#123;</span><br><span class="line">    border-radius: 50%;</span><br><span class="line">&#125;</span><br><span class="line">.username &#123;</span><br><span class="line">    font-weight: bold;</span><br><span class="line">&#125;</span><br><span class="line">.fans &#123;</span><br><span class="line">    font-size: 12px;</span><br><span class="line">    color: #666;</span><br><span class="line">&#125;</span><br><span class="line">button&#123;</span><br><span class="line">    padding: 2px,4px;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>对于展示的个人信息、帖子列表都需要参数，这三个模块是相互交互的，对于这样的情况，需要将数据存到上层组件中。</p>
<p>上层组件UserProfileView.vue：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">setup: function()&#123;</span><br><span class="line">    const user = reactive(&#123;</span><br><span class="line">        id: 1,</span><br><span class="line">        username: &#x27;LiuZihao&#x27;,</span><br><span class="line">        lastName: &#x27;Liu&#x27;,</span><br><span class="line">        firstName: &#x27;Zihao&#x27;,</span><br><span class="line">        followers: 0,</span><br><span class="line">        is_followed: false,</span><br><span class="line">    &#125;);</span><br><span class="line">    return&#123;</span><br><span class="line">        user,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用方式</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791df87eb321.png" alt="vue8.png"></p>
<p>父组件传递</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791df884e433.png" alt="vue9.png"></p>
<p>子组件接受</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791df889919c.png" alt="vue10.png"></p>
<p>使用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;col-9&quot;&gt;</span><br><span class="line">     &lt;div class=&quot;username&quot;&gt;&#123;&#123;fullName&#125;&#125;&lt;/div&gt;</span><br><span class="line">     &lt;div class=&quot;fans&quot;&gt;&#123;&#123;user.followers&#125;&#125;&lt;/div&gt;</span><br><span class="line">     &lt;button type=&quot;button&quot; class=&quot;btn btn-secondary btn-sm&quot;&gt;follow&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>实现关注按钮</p>
<p>逻辑： 如果没有关注，则显示 “关注”；如果已经关注，则显示 “取消关注”字样<br>实现： 使用template的v-if</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;button v-if=&quot;!user.is_followed&quot; type=&quot;button&quot; class=&quot;btn btn-secondary btn-sm&quot;&gt;follow me&lt;/button&gt;</span><br><span class="line">&lt;button v-if=&quot;user.is_followed&quot; type=&quot;button&quot; class=&quot;btn btn-secondary btn-sm&quot;&gt;unfollow me&lt;/button&gt;</span><br></pre></td></tr></table></figure>

<p>关注完以后，还需要更新user状态，此时需要定义事件处理函数。</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791df8a7bab3.png" alt="vue11.png"></p>
<p>将这两个函数绑定起来：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;button v-on:click=&quot;follow&quot; v-if=&quot;!user.is_followed&quot; type=&quot;button&quot; class=&quot;btn btn-secondary btn-sm&quot;&gt;follow me&lt;/button&gt;</span><br><span class="line">&lt;button v-on:click=&quot;unfollow&quot; v-if=&quot;user.is_followed&quot; type=&quot;button&quot; class=&quot;btn btn-secondary btn-sm&quot;&gt;unfollow me&lt;/button&gt;</span><br></pre></td></tr></table></figure>

<p>子组件要向父组件传递消息：<br>父组件：</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791df88775c9.png" alt="vue12.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791df8a57fc4.png" alt="vue13.png"></p>
<p>子组件：用context.emit可以出发父组件的事件</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791df8adf4bf.png" alt="vue14.png"></p>
<p>UserProfileInfo</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;card&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;card-body&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;row&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;col-3&quot;&gt;</span><br><span class="line">                    &lt;img class=&quot;img-fluid&quot; src=&quot;https://cdn.acwing.com/media/user/profile/photo/487342_lg_9a864c18d9.jpg&quot; alt=&quot;&quot;&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;col-9&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;username&quot;&gt;&#123;&#123;fullName&#125;&#125;&lt;/div&gt;</span><br><span class="line">                    &lt;div class=&quot;fans&quot;&gt;&#123;&#123;user.followers&#125;&#125;&lt;/div&gt;</span><br><span class="line">                    &lt;button v-on:click=&quot;follow&quot; v-if=&quot;!user.is_followed&quot; type=&quot;button&quot; class=&quot;btn btn-secondary btn-sm&quot;&gt;follow me&lt;/button&gt;</span><br><span class="line">                    &lt;button v-on:click=&quot;unfollow&quot; v-if=&quot;user.is_followed&quot; type=&quot;button&quot; class=&quot;btn btn-secondary btn-sm&quot;&gt;unfollow me&lt;/button&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;computed&#125; from &#x27;vue&#x27;;</span><br><span class="line"></span><br><span class="line">export default&#123;</span><br><span class="line">    name: &#x27;UserProfileInfo&#x27;,</span><br><span class="line">    props: &#123;</span><br><span class="line">        user: &#123;</span><br><span class="line">            type: Object,</span><br><span class="line">            required: true,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    setup: function(props,context)&#123;</span><br><span class="line">        let fullName = computed(() =&gt; &#123;</span><br><span class="line">            return props.user.lastName + &#x27; &#x27; + props.user.firstName;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        const follow=()=&gt;&#123;</span><br><span class="line">            context.emit(&#x27;follow&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        const unfollow=()=&gt;&#123;</span><br><span class="line">            context.emit(&#x27;unfollow&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        return &#123;</span><br><span class="line">            fullName,</span><br><span class="line">            follow,</span><br><span class="line">            unfollow,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">img &#123;</span><br><span class="line">    border-radius: 50%;</span><br><span class="line">&#125;</span><br><span class="line">.username &#123;</span><br><span class="line">    font-weight: bold;</span><br><span class="line">&#125;</span><br><span class="line">.fans &#123;</span><br><span class="line">    font-size: 12px;</span><br><span class="line">    color: #666;</span><br><span class="line">&#125;</span><br><span class="line">button&#123;</span><br><span class="line">    padding: 2px,4px;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>UserProfile</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;ContentBase&gt;</span><br><span class="line">    &lt;div class=&quot;row&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;col-3&quot;&gt;</span><br><span class="line">            &lt;UserProfileInfo @follow=&quot;follow&quot; @unfollow=&quot;unfollow&quot; v-bind:user=&quot;user&quot;&gt;&lt;/UserProfileInfo&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;col-9&quot;&gt;</span><br><span class="line">            &lt;UserProfilePosts&gt;&lt;/UserProfilePosts&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;/ContentBase&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">  </span><br><span class="line">&lt;script&gt;</span><br><span class="line">import ContentBase from &#x27;@/components/ContentBase.vue&#x27;;</span><br><span class="line">import UserProfileInfo from &#x27;@/components/UserProfileInfo.vue&#x27;;</span><br><span class="line">import UserProfilePosts from &#x27;@/components/UserProfilePosts.vue&#x27;;</span><br><span class="line">import &#123; reactive &#125; from &#x27;vue&#x27;;</span><br><span class="line">  </span><br><span class="line">export default &#123;</span><br><span class="line">    name: &#x27;UserProfile&#x27;,</span><br><span class="line">    components: &#123;</span><br><span class="line">        ContentBase,</span><br><span class="line">        UserProfileInfo,</span><br><span class="line">        UserProfilePosts,</span><br><span class="line">    &#125;,</span><br><span class="line">    setup: function()&#123;</span><br><span class="line">        const user = reactive(&#123;</span><br><span class="line">            id: 1,</span><br><span class="line">            username: &#x27;LiuZihao&#x27;,</span><br><span class="line">            lastName: &#x27;Liu&#x27;,</span><br><span class="line">            firstName: &#x27;Zihao&#x27;,</span><br><span class="line">            followers: 0,</span><br><span class="line">            is_followed: false,</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        const follow=()=&gt;&#123;</span><br><span class="line">            if(user.is_followed)&#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            user.is_followed=true;</span><br><span class="line">            user.followers++;</span><br><span class="line">        &#125;   </span><br><span class="line"></span><br><span class="line">        const unfollow=()=&gt;&#123;</span><br><span class="line">            if(!user.is_followed)&#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            user.is_followed=false;</span><br><span class="line">            user.followers--;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return&#123;</span><br><span class="line">            user,</span><br><span class="line">            follow,</span><br><span class="line">            unfollow,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">  </span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>实现帖子列表</p>
<p>UserProfilePosts</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;card&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;card-body&quot;&gt;</span><br><span class="line">            &lt;div v-for=&quot;post in posts.posts&quot; :key=&quot;post.id&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;card single-post&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;card-body&quot;&gt;</span><br><span class="line">                        &lt;div&gt;&#123;&#123;post.content&#125;&#125;&lt;/div&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">    name: &#x27;UserProfilePosts&#x27;,</span><br><span class="line">    props:&#123;</span><br><span class="line">        posts:&#123;</span><br><span class="line">            type:Object,</span><br><span class="line">            required:true,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.single-post&#123;</span><br><span class="line">    margin-top: 10px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>实现发帖功能</p>
<p>UserProfileWrite</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;card edit-field&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;card-body&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;mb-3&quot;&gt;</span><br><span class="line">                &lt;label for=&quot;edit-post&quot; class=&quot;form-label&quot;&gt;编辑&lt;/label&gt;</span><br><span class="line">                &lt;textarea v-model=&quot;content&quot; class=&quot;form-control&quot; id=&quot;edit-post&quot; rows=&quot;3&quot;&gt;&lt;/textarea&gt;</span><br><span class="line">                &lt;button v-on:click=&quot;submit_post&quot; type=&quot;button&quot; class=&quot;btn btn-primary btn-sm&quot;&gt;发布&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">    name: &#x27;UserProfileWrite&#x27;,</span><br><span class="line">    setup(props,context)&#123;</span><br><span class="line">        let content=ref(&#x27;&#x27;);</span><br><span class="line"></span><br><span class="line">        const submit_post=()=&gt;&#123;</span><br><span class="line">            context.emit(&#x27;submit_post&#x27;,content.value);</span><br><span class="line">            content.value=&#x27;&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return &#123;</span><br><span class="line">            content,</span><br><span class="line">            submit_post,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.edit-field&#123;</span><br><span class="line">    margin-top: 20px;</span><br><span class="line">&#125;</span><br><span class="line">button&#123;</span><br><span class="line">    margin-top: 10px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>首先要获取textarea里的信息,利用v-model，v-model的标签与内容绑定起来</p>
<p><img src="https://www.helloimg.com/i/2025/01/23/6791df8b714d2.png" alt="vue15.png"></p>
<p>还需要一个触发函数。当click的时候，将textarea里的内容发成帖子。<br>父组件需要一个函数， 并把这个函数暴露给按钮页即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const submit_post=(content)=&gt;&#123;</span><br><span class="line">    posts.posts.unshift(&#123;</span><br><span class="line">        id:posts.count,</span><br><span class="line">        userId:1,</span><br><span class="line">        content:content,</span><br><span class="line">    &#125;);</span><br><span class="line">    posts.count++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://www.helloimg.com/i/2025/01/23/6791df8b435ed.png" alt="vue16.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/01/23/Vue%E5%AE%9E%E7%8E%B0%E4%B8%AA%E4%BA%BA%E7%A9%BA%E9%97%B4-%E4%B8%8A/" data-id="cm8sja97t003u8ktb88gj01wc" data-title="Vue实现个人空间-上" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vue/" rel="tag">Vue</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Springboot-项目创建" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/01/22/Springboot-%E9%A1%B9%E7%9B%AE%E5%88%9B%E5%BB%BA/" class="article-date">
  <time class="dt-published" datetime="2025-01-22T04:25:14.000Z" itemprop="datePublished">2025-01-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web/">Web</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/01/22/Springboot-%E9%A1%B9%E7%9B%AE%E5%88%9B%E5%BB%BA/">Springboot-项目创建</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="项目功能"><a href="#项目功能" class="headerlink" title="项目功能"></a>项目功能</h3><p><img src="https://www.helloimg.com/i/2025/01/22/6790708bb1d10.png" alt="springboot1-1.png"></p>
<h3 id="配置git环境"><a href="#配置git环境" class="headerlink" title="配置git环境"></a>配置git环境</h3><ol>
<li><p>安装Git Bash（使用Mac和Linux的可以跳过这一步）：<a target="_blank" rel="noopener" href="https://gitforwindows.org/">https://gitforwindows.org/</a></p>
<blockquote>
<p>全部默认即可</p>
</blockquote>
</li>
<li><p>输入<code>cd</code>回车进入家目录，执行命令<code>ssh-keygen</code>生成秘钥</p>
<blockquote>
<p>我们使用Gitee(Github、Acgit)的时候，通信的方式通过ssh</p>
<p>由于Gitee不支持用户名密码，因此需要借助秘钥来操作上</p>
</blockquote>
</li>
</ol>
<p><img src="https://www.helloimg.com/i/2025/01/22/6790708b49863.png" alt="springboot1-2.png"></p>
<ol start="3">
<li>然后进入<code>.ssh</code>文件夹，<code>id_rsa</code>和<code>id_rsa.pub</code>分别代表私钥和公钥文件，我们将公钥取出。</li>
</ol>
<p><img src="https://www.helloimg.com/i/2025/01/22/6790708b82115.png" alt="springboot1-3.png"></p>
<ol start="4">
<li>将id_rsa.pub的内容复制到Gitee上</li>
</ol>
<p><img src="https://www.helloimg.com/i/2025/01/22/6790708b90746.png" alt="springboot1-4.png"></p>
<blockquote>
<p>使用SSH公钥可以让你在你的电脑和 Gitee 通讯的时候使用安全连接（Git的Remote要使用SSH地址）</p>
</blockquote>
<h3 id="创建项目后端"><a href="#创建项目后端" class="headerlink" title="创建项目后端"></a>创建项目后端</h3><p><img src="https://www.helloimg.com/i/2025/01/22/6790708b62a64.png" alt="springboot1-5.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/22/6790708b65650.png" alt="springboot1-6.png"></p>
<blockquote>
<p>注意，Thymeleaf是通过前后端不分离的方式写页面，由于我们的最终的项目是前后端分离，因此只是借助这个依赖演示一下前后端不分离的场景。最终是不使用这个依赖的。</p>
</blockquote>
<p><img src="https://www.helloimg.com/i/2025/01/22/6790708e9a92b.png" alt="springboot1-7.png"></p>
<p>Spring后端主要作用是负责实现一些函数，其中每一个url对应一个函数，负责给用户返回一些页面。</p>
<p>一般而言，我们建立一个名为controller的package，用于存储所有的后端函数，在controller中新建pk包。</p>
<h4 id="前后端不分离"><a href="#前后端不分离" class="headerlink" title="前后端不分离"></a>前后端不分离</h4><p>在pk包中新建java文件，如果将其作为url对应的函数，需要添加<code>@Controller</code>注解</p>
<p>我们期待pk包中的所有文件所对应的url链接，都在pk目录下。</p>
<p><img src="https://www.helloimg.com/i/2025/01/22/6790708e9b2e4.png" alt="springboot1-8.png"></p>
<p>因此，添加注解<code>@RequestMapping(&quot;/pk/&quot;)</code>，也就是添加父目录的意思。</p>
<p>每一个url请求，都要返回一个HTML页面，我们将需要返回的页面在<code>backend/src/main/resources/templates</code>中创建。</p>
<p><img src="https://www.helloimg.com/i/2025/01/22/6790708ed3071.png" alt="springboot1-9.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/22/6790708ee06b9.png" alt="springboot1-10.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/22/679070905660c.png" alt="springboot1-11.png"></p>
<p>注意每次修改之后，都需要重启项目。</p>
<p>以上就是前后端不分离的写法，后端向前端返回一个html页面。</p>
<h4 id="前后端分离"><a href="#前后端分离" class="headerlink" title="前后端分离"></a>前后端分离</h4><p>而对于前后端分离的写法，后端函数向前端返回的只是一些数据。</p>
<p>需要用到<code>@RestController</code>而不是<code>@Controller</code></p>
<blockquote>
<p><code>@RestController</code>用于返回数据</p>
<p><code>@Controller</code>是根据返回的<code>String</code>去寻找<code>template</code>中的<code>html</code>文件</p>
</blockquote>
<p>可以返回字符串，可以返回List，也可以返回Map等等。</p>
<p><img src="https://www.helloimg.com/i/2025/01/22/6790708f452e7.png" alt="springboot1-12.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/22/679070913378c.png" alt="springboot1-13.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/22/6790709192dd4.png" alt="springboot1-14.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/22/679070918ff06.png" alt="springboot1-15.png"></p>
<p>同样，还可以将Map嵌套到List中</p>
<p><img src="https://www.helloimg.com/i/2025/01/22/67907091e5289.png" alt="springboot1-16.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/22/6790709225f59.png" alt="springboot1-17.png"></p>
<h4 id="提交git"><a href="#提交git" class="headerlink" title="提交git"></a>提交git</h4><p><img src="https://www.helloimg.com/i/2025/01/22/67907092dc629.png" alt="springboot1-18.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/22/67907093e7e2a.png" alt="springboot1-19.png"></p>
<p>此时</p>
<p><img src="https://www.helloimg.com/i/2025/01/22/6790709467c58.png" alt="springboot1-20.png"></p>
<p>同时IDEA中代码不再爆红</p>
<p><img src="https://www.helloimg.com/i/2025/01/22/67907094e2662.png" alt="springboot1-21.png"></p>
<h3 id="创建项目Web端"><a href="#创建项目Web端" class="headerlink" title="创建项目Web端"></a>创建项目Web端</h3><h4 id="Vue安装"><a href="#Vue安装" class="headerlink" title="Vue安装"></a>Vue安装</h4><p>1、安装<code>Nodejs</code></p>
<p><a target="_blank" rel="noopener" href="https://nodejs.org/en/">https://nodejs.org/en/</a></p>
<p>2、安装<code>@vue/cli</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i <span class="literal">-g</span> @vue/<span class="built_in">cli</span></span><br></pre></td></tr></table></figure>

<p>这里推荐使用早期版本</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i <span class="literal">-g</span> @vue/<span class="built_in">cli</span>@<span class="number">4.5</span></span><br></pre></td></tr></table></figure>

<p>3、启动<code>vue</code>自带的图形化项目管理界面</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue ui</span><br></pre></td></tr></table></figure>

<h4 id="Vue项目管理"><a href="#Vue项目管理" class="headerlink" title="Vue项目管理"></a>Vue项目管理</h4><p>从而打开了vue的控制台</p>
<p><img src="https://www.helloimg.com/i/2025/01/22/679070954cc14.png" alt="springboot1-22.png"></p>
<h5 id="创建Web"><a href="#创建Web" class="headerlink" title="创建Web"></a>创建Web</h5><p>使用控制台创建项目，名为web。</p>
<p>注意将初始化git仓库取消</p>
<p><img src="https://www.helloimg.com/i/2025/01/22/67907094d325f.png" alt="springboot1-23.png"></p>
<p>安装插件<code>vue-router</code>和<code>vuex</code></p>
<p><img src="https://www.helloimg.com/i/2025/01/22/679070952de58.png" alt="springboot1-24.png"></p>
<p>安装依赖<code>jquery</code>和<code>bootstrap</code></p>
<p><img src="https://www.helloimg.com/i/2025/01/22/679070971d8e9.png" alt="springboot1-25.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/22/67907097dfd65.png" alt="springboot1-26.png"></p>
<p>运行serve</p>
<p><img src="https://www.helloimg.com/i/2025/01/22/67907097a6697.png" alt="springboot1-27.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/22/67907097ad9ae.png" alt="springboot1-28.png"></p>
<p>此时，项目创建成功</p>
<p><img src="https://www.helloimg.com/i/2025/01/22/67907098383d4.png" alt="springboot1-29.png"></p>
<p>同理，再创建一个项目acapp</p>
<h5 id="创建Acapp"><a href="#创建Acapp" class="headerlink" title="创建Acapp"></a>创建Acapp</h5><p>添加vuex插件，成功后会在列表显示</p>
<p><img src="https://www.helloimg.com/i/2025/01/22/67907098325d0.png" alt="springboot1-30.png"></p>
<p>此时就可以通过serve运行。</p>
<p>之后再将项目更新到git上</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git status</span><br><span class="line">git add .</span><br><span class="line">git status</span><br><span class="line">git commit - m <span class="string">&quot;创建web端和acapp端&quot;</span></span><br><span class="line">git push</span><br><span class="line">git status</span><br></pre></td></tr></table></figure>

<h3 id="前后端交互"><a href="#前后端交互" class="headerlink" title="前后端交互"></a>前后端交互</h3><p><img src="https://www.helloimg.com/i/2025/01/22/679070995ab91.png" alt="springboot1-31.png"></p>
<p>在<code>src\router\index.js</code>文件中，去掉<code>createWebHashHistory</code>中的<code>Hash</code></p>
<p>尝试在通过前端发送get请求获取后端数据</p>
<p><img src="https://www.helloimg.com/i/2025/01/22/6790709a4e832.png" alt="springboot1-32.png"></p>
<p>在前端中，通过F12观察请求的相应情况：</p>
<p><img src="https://www.helloimg.com/i/2025/01/22/6790709a2c619.png" alt="springboot1-33.png"></p>
<p>此为跨域问题，我们的web当前域名是localhost:8081，但是我们请求的地址的域名是localhost:3000，产生跨域问题，属于浏览器安全机制。</p>
<h4 id="跨域问题"><a href="#跨域问题" class="headerlink" title="跨域问题"></a>跨域问题</h4><p>在SpringBoot中解决跨域问题<br>添加配置类：CorsConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kob.backend.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.CorsRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CorsConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WebMvcConfigurer <span class="title function_">corsConfigurer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurer</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> &#123;</span><br><span class="line">                registry.addMapping(<span class="string">&quot;/**&quot;</span>)  <span class="comment">// 允许所有路径</span></span><br><span class="line">                        .allowedOrigins(<span class="string">&quot;http://localhost:8080&quot;</span>)  <span class="comment">// 允许所有来源</span></span><br><span class="line">                        .allowedMethods(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>, <span class="string">&quot;PUT&quot;</span>, <span class="string">&quot;DELETE&quot;</span>, <span class="string">&quot;OPTIONS&quot;</span>)  <span class="comment">// 允许的HTTP方法</span></span><br><span class="line">                        .allowedHeaders(<span class="string">&quot;*&quot;</span>)  <span class="comment">// 允许所有请求头</span></span><br><span class="line">                        .allowCredentials(<span class="literal">true</span>)  <span class="comment">// 允许携带凭证（如cookies）</span></span><br><span class="line">                        .maxAge(<span class="number">3600</span>);  <span class="comment">// 预检请求的缓存时间（单位：秒）</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h4><p><code>setup:()</code>可以认为是整个组件的入口</p>
<p><img src="https://www.helloimg.com/i/2025/01/22/6790709ad1378.png" alt="springboot1-34.png"></p>
<h4 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h4><p><img src="https://www.helloimg.com/i/2025/01/22/6790709ad4664.png" alt="springboot1-35.png"></p>
<h4 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h4><p><img src="https://www.helloimg.com/i/2025/01/22/6790709aee8a5.png" alt="springboot1-36.png"></p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>在vue中实现的所有代码，都是在用户浏览器中执行，而不是在后端执行。也就是用户在打开网页的时候，会将vue代码全部先下载到浏览器，然后浏览器逐个执行每段代码。</p>
<p>可以查看网页源代码：</p>
<p><img src="https://www.helloimg.com/i/2025/01/22/6790709bda523.png" alt="springboot1-37.png"></p>
<p>上述所实现的所有代码全部都集成在了app.js中</p>
<p><img src="https://www.helloimg.com/i/2025/01/22/6790709d4b6a6.png" alt="springboot1-38.png"></p>
<p>其中，执行到这段代码的时候：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">setup</span>:<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> bot_name = <span class="title function_">ref</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> bot_rating = <span class="title function_">ref</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>:<span class="string">&quot;http://127.0.0.1:3000/pk/getbotinfo/&quot;</span>,</span><br><span class="line">    <span class="attr">type</span>:<span class="string">&quot;get&quot;</span>,</span><br><span class="line">    <span class="attr">success</span>:<span class="function"><span class="params">resp</span>=&gt;</span>&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(resp);</span><br><span class="line">      bot_name.<span class="property">value</span> = resp.<span class="property">name</span>;</span><br><span class="line">      bot_rating.<span class="property">value</span> = resp.<span class="property">rating</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span>&#123;</span><br><span class="line">      bot_name,</span><br><span class="line">      bot_rating</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>

<p>交互逻辑是这样的：</p>
<p><img src="https://www.helloimg.com/i/2025/01/22/6790709cb8bb5.png" alt="springboot1-39.png"></p>
<p>用户浏览器拿到了结果：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">success</span>:<span class="function"><span class="params">resp</span>=&gt;</span>&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(resp);</span><br><span class="line">      bot_name.<span class="property">value</span> = resp.<span class="property">name</span>;</span><br><span class="line">      bot_rating.<span class="property">value</span> = resp.<span class="property">rating</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<p>数据动态绑定到前端页面中</p>
<p><img src="https://www.helloimg.com/i/2025/01/22/6790709d6f764.png" alt="springboot1-40.png"></p>
<p>并且这种方式，更改后端所返回的JSON数据，前端页面也相应的发生改变。</p>
<p><img src="https://www.helloimg.com/i/2025/01/22/6790709d8ce22.png" alt="springboot1-41.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/22/6790709dc1ed9.png" alt="springboot1-42.png"></p>
<p>最后记得每次改动完，都要记得保存代码到Git</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git status</span><br><span class="line">git add .</span><br><span class="line">git status</span><br><span class="line">git commit - m <span class="string">&quot;创建web端和acapp端&quot;</span></span><br><span class="line">git push</span><br><span class="line">git status</span><br></pre></td></tr></table></figure>

<p>并且记得关闭Vue CLI的服务，否则8080端口将会被一直占用。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/01/22/Springboot-%E9%A1%B9%E7%9B%AE%E5%88%9B%E5%BB%BA/" data-id="cm8sja97f001t8ktb7fhy5fcl" data-title="Springboot-项目创建" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Springboot/" rel="tag">Springboot</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-UE5-蓝图基础-下" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/01/15/UE5-%E8%93%9D%E5%9B%BE%E5%9F%BA%E7%A1%80-%E4%B8%8B/" class="article-date">
  <time class="dt-published" datetime="2025-01-15T10:44:42.000Z" itemprop="datePublished">2025-01-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Unreal-Engine/">Unreal Engine</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/01/15/UE5-%E8%93%9D%E5%9B%BE%E5%9F%BA%E7%A1%80-%E4%B8%8B/">UE5-蓝图基础(下)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="UE5蓝图基础教程"><a href="#UE5蓝图基础教程" class="headerlink" title="UE5蓝图基础教程"></a>UE5蓝图基础教程</h1><h2 id="变量的算数运算"><a href="#变量的算数运算" class="headerlink" title="变量的算数运算"></a>变量的算数运算</h2><p><img src="https://www.helloimg.com/i/2025/01/15/6787abcf13e38.png" alt="ue31.png"></p>
<h2 id="变量的比较运算"><a href="#变量的比较运算" class="headerlink" title="变量的比较运算"></a>变量的比较运算</h2><p><img src="https://www.helloimg.com/i/2025/01/15/6787abce8b156.png" alt="ue32.png"></p>
<h2 id="获取输入"><a href="#获取输入" class="headerlink" title="获取输入"></a>获取输入</h2><ul>
<li>获取键盘输入</li>
</ul>
<p><img src="https://www.helloimg.com/i/2025/01/15/6787abce83a85.png" alt="ue33.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/15/6787abce642b0.png" alt="ue34.png"></p>
<ul>
<li>获取鼠标输入</li>
</ul>
<p><img src="https://www.helloimg.com/i/2025/01/15/6787abcea9eb3.png" alt="ue35.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/15/6787abd00636b.png" alt="ue36.png"></p>
<h2 id="分支节点"><a href="#分支节点" class="headerlink" title="分支节点"></a>分支节点</h2><p>类似与if语句</p>
<p><img src="https://www.helloimg.com/i/2025/01/15/6787abd2be740.png" alt="ue37.png"></p>
<h2 id="序列节点"><a href="#序列节点" class="headerlink" title="序列节点"></a>序列节点</h2><p>序列节点的作用就是可以将一个长的顺序执行代码划分成段，便于管理。序列节点是单线程。分段<strong>按照引脚的顺序</strong>执行。</p>
<p><img src="https://www.helloimg.com/i/2025/01/15/6787abd1dbaf2.png" alt="ue38.png"></p>
<h2 id="for循环节点"><a href="#for循环节点" class="headerlink" title="for循环节点"></a>for循环节点</h2><p><img src="https://www.helloimg.com/i/2025/01/15/6787abd440199.png" alt="ue39.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/15/6787abdb9d9aa.png" alt="ue40.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/15/6787abd3e6861.png" alt="ue41.png"></p>
<h2 id="while循环节点"><a href="#while循环节点" class="headerlink" title="while循环节点"></a>while循环节点</h2><p><img src="https://www.helloimg.com/i/2025/01/15/6787abd751d55.png" alt="ue42.png"></p>
<h2 id="Do-N节点"><a href="#Do-N节点" class="headerlink" title="Do N节点"></a>Do N节点</h2><p>当执行到第N次后就不执行，若想再次执行需要执行一次reset</p>
<p><img src="https://www.helloimg.com/i/2025/01/15/6787abd4a7b8d.png" alt="ue43.png"></p>
<h2 id="Do-Once节点"><a href="#Do-Once节点" class="headerlink" title="Do Once节点"></a>Do Once节点</h2><p>只执行一次，若想再次执行需要执行一次reset</p>
<p><img src="https://www.helloimg.com/i/2025/01/15/6787abd74fbd9.png" alt="ue44.png"></p>
<h2 id="Flip-Flop节点"><a href="#Flip-Flop节点" class="headerlink" title="Flip Flop节点"></a>Flip Flop节点</h2><p>翻转节点，可以输出两个功能，单数执行A，双数执行B</p>
<p><img src="https://www.helloimg.com/i/2025/01/15/6787abd6d6775.png" alt="ue45.png"></p>
<h2 id="Gate节点"><a href="#Gate节点" class="headerlink" title="Gate节点"></a>Gate节点</h2><p><img src="https://www.helloimg.com/i/2025/01/15/6787abd8c0cef.png" alt="ue46.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/15/6787abd873a84.png" alt="ue47.png"></p>
<h2 id="Multi-Gate节点"><a href="#Multi-Gate节点" class="headerlink" title="Multi Gate节点"></a>Multi Gate节点</h2><p><img src="https://www.helloimg.com/i/2025/01/15/6787abdb497a2.png" alt="ue48.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/15/6787abdaea61e.png" alt="ue49.png"></p>
<h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><p>和C++的数组一样</p>
<ul>
<li>定义数组</li>
</ul>
<p><img src="https://www.helloimg.com/i/2025/01/15/6787abda92af7.png" alt="ue50.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/15/6787abdacace5.png" alt="ue51.png"></p>
<ul>
<li>数组元素获取</li>
</ul>
<p><img src="https://www.helloimg.com/i/2025/01/15/6787abde711b1.png" alt="ue52.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/15/6787abdf7e657.png" alt="ue53.png"></p>
<ul>
<li>数组常见操作<ul>
<li>查找项目(FindItem)：查找指定元素的下标</li>
<li>获取数组长度(Length)</li>
<li>获取数组最后一个元素的下标(LastIndex)</li>
</ul>
</li>
</ul>
<p><img src="https://www.helloimg.com/i/2025/01/15/6787abddea443.png" alt="ue54.png"></p>
<ul>
<li>插入数组元素</li>
<li>移除元素</li>
<li>判断数组中是否有指定元素</li>
</ul>
<p><img src="https://www.helloimg.com/i/2025/01/15/6787abdf3ca02.png" alt="ue55.png"></p>
<ul>
<li>数组的遍历</li>
</ul>
<p><img src="https://www.helloimg.com/i/2025/01/15/6787abdebee0c.png" alt="ue56.png"></p>
<h2 id="修改关卡对象的材质"><a href="#修改关卡对象的材质" class="headerlink" title="修改关卡对象的材质"></a>修改关卡对象的材质</h2><ol>
<li>选中关卡对象，创建数组，并将数组提升为变量(Promote to variable)</li>
<li>创建材质与材质实例(双击材质，右键可以将材质的性质转换为参数)</li>
<li>创建材质数组</li>
<li>在材质数组中持有材质实例</li>
<li>当按下鼠标左键的时候遍历关卡对象数组，实现材质的随即赋值</li>
</ol>
<p><img src="https://www.helloimg.com/i/2025/01/15/6787abdf3d618.png" alt="ue57.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/15/6787abe1ea64f.png" alt="ue58.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/15/6787abe3efcc0.png" alt="ue59.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/15/6787abe5c228d.png" alt="ue60.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/15/6787abe478af1.png" alt="ue61.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/15/6787abe38311d.png" alt="ue62.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/15/6787abe449eea.png" alt="ue63.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/01/15/UE5-%E8%93%9D%E5%9B%BE%E5%9F%BA%E7%A1%80-%E4%B8%8B/" data-id="cm8sja97h00238ktbegdbfk1c" data-title="UE5-蓝图基础(下)" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unreal-Engine/" rel="tag">Unreal Engine</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-UE5-蓝图基础-上" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/01/14/UE5-%E8%93%9D%E5%9B%BE%E5%9F%BA%E7%A1%80-%E4%B8%8A/" class="article-date">
  <time class="dt-published" datetime="2025-01-14T13:13:47.000Z" itemprop="datePublished">2025-01-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Unreal-Engine/">Unreal Engine</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/01/14/UE5-%E8%93%9D%E5%9B%BE%E5%9F%BA%E7%A1%80-%E4%B8%8A/">UE5-蓝图基础(上)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="UE5蓝图基础教程"><a href="#UE5蓝图基础教程" class="headerlink" title="UE5蓝图基础教程"></a>UE5蓝图基础教程</h1><h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><p><img src="https://www.helloimg.com/i/2025/01/14/678660febda09.png" alt="ue1.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/14/67866106bfede.png" alt="ue2.png"></p>
<h2 id="界面介绍"><a href="#界面介绍" class="headerlink" title="界面介绍"></a>界面介绍</h2><p><img src="https://www.helloimg.com/i/2025/01/14/6786610814f2d.png" alt="ue3.png"></p>
<h2 id="Actor"><a href="#Actor" class="headerlink" title="Actor"></a>Actor</h2><ul>
<li>所有可以被放入关卡(Level)的对象都是Actor</li>
<li>创建Actor的方式有：<ul>
<li>从放置Actor中添加</li>
<li>从内容浏览器中添加</li>
</ul>
</li>
</ul>
<p><img src="https://www.helloimg.com/i/2025/01/14/678660f856996.png" alt="ue4.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/14/678660fad1637.png" alt="ue5.png"></p>
<h2 id="操作关卡对象"><a href="#操作关卡对象" class="headerlink" title="操作关卡对象"></a>操作关卡对象</h2><p><img src="https://www.helloimg.com/i/2025/01/14/678660fe0b55b.png" alt="ue6.png"></p>
<h2 id="蓝图"><a href="#蓝图" class="headerlink" title="蓝图"></a>蓝图</h2><p>蓝图是一种基于节点的可视化脚本系统，允许开发者在不编写传统代码的情况下创建游戏逻辑和交互。蓝图系统通过图形化界面来设计和实现功能，使得非程序员也能参与到游戏开发中。</p>
<p><img src="https://www.helloimg.com/i/2025/01/14/678660fbe49ee.png" alt="ue7.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/14/678660ffb1a80.png" alt="ue8.png"></p>
<h2 id="蓝图节点"><a href="#蓝图节点" class="headerlink" title="蓝图节点"></a>蓝图节点</h2><p>蓝图节点是蓝图可视化编成的基本组成部分。通过不同蓝图节点的链接，实现功能逻辑</p>
<p><img src="https://www.helloimg.com/i/2025/01/14/678661005a598.png" alt="ue9.png"></p>
<h2 id="事件图表的操作"><a href="#事件图表的操作" class="headerlink" title="事件图表的操作"></a>事件图表的操作</h2><p>右键拖动，滚轮缩放，右键单击新建节点，按住alt键左键点击连线就可以断开连接</p>
<p>下图两个事件节点类似于unity的start函数和update函数，start函数在开始时执行一次，update函数每一帧都会执行</p>
<p><img src="https://www.helloimg.com/i/2025/01/14/678661034a869.png" alt="ue10.png"></p>
<p>下面会在游戏开始打印Hello</p>
<p><img src="https://www.helloimg.com/i/2025/01/14/67866101c2ab4.png" alt="ue11.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/14/6786610d0c331.png" alt="ue12.png"></p>
<p>下面会每一帧都打印Hello</p>
<p><img src="https://www.helloimg.com/i/2025/01/14/67866103ab351.png" alt="ue13.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/14/6786610bae8ef.png" alt="ue14.png"></p>
<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><p><img src="https://www.helloimg.com/i/2025/01/14/6786610a21880.png" alt="ue15.png"></p>
<p>下图使用变量的值输出</p>
<p><img src="https://www.helloimg.com/i/2025/01/14/678661088726b.png" alt="ue16.png"></p>
<p>按住alt拖动变量可以设置变量</p>
<p><img src="https://www.helloimg.com/i/2025/01/14/6786610b51ace.png" alt="ue17.png"></p>
<h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><p>点击变量按c可以注释</p>
<p><img src="https://www.helloimg.com/i/2025/01/14/6786610cbb26c.png" alt="ue18.png"></p>
<p>也可以注释一个逻辑块，左键选择按c</p>
<p><img src="https://www.helloimg.com/i/2025/01/14/6786610c508db.png" alt="ue19.png"></p>
<h2 id="变量类型"><a href="#变量类型" class="headerlink" title="变量类型"></a>变量类型</h2><p><img src="https://www.helloimg.com/i/2025/01/14/6786610e417c7.png" alt="ue20.png"></p>
<p>基础变量就字面意思，需要注意的是向量类型、旋转体类型、变换类型</p>
<h3 id="向量-Vector-类型"><a href="#向量-Vector-类型" class="headerlink" title="向量(Vector)类型"></a>向量(Vector)类型</h3><p>向量是指有方向有长度的数据，值由三个数组组成(x,y,z)，用于表示位置、旋转、缩放等</p>
<p>下图是获取Vector变量</p>
<p><img src="https://www.helloimg.com/i/2025/01/14/6786610f44243.png" alt="ue21.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/14/6786610f40915.png" alt="ue22.png"></p>
<p>下图是设置Vector变量，可以用另一个Vector赋值，也可以用单个变量赋值给某一个值</p>
<p><img src="https://www.helloimg.com/i/2025/01/14/67866111e2d2b.png" alt="ue23.png"></p>
<p>单独赋值需要从Vector变量向外拖，勾选情景关联，make Vector</p>
<p><img src="https://www.helloimg.com/i/2025/01/14/678661119b66e.png" alt="ue24.png"></p>
<p>向量的运算</p>
<p><img src="https://www.helloimg.com/i/2025/01/14/6786611245b60.png" alt="ue25.png"></p>
<h3 id="旋转体-Rotator-类型"><a href="#旋转体-Rotator-类型" class="headerlink" title="旋转体(Rotator)类型"></a>旋转体(Rotator)类型</h3><p>与向量相似，用于表示3d空间中的旋转</p>
<p><img src="https://www.helloimg.com/i/2025/01/14/6786611105ab9.png" alt="ue26.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/14/678661130ff7f.png" alt="ue27.png"></p>
<h3 id="变换-Transform"><a href="#变换-Transform" class="headerlink" title="变换(Transform)"></a>变换(Transform)</h3><p>变换是结合了位移、旋转、缩放的数据集，通常用于同时获取游戏对象的位置、旋转、缩放等数据</p>
<p><img src="https://www.helloimg.com/i/2025/01/14/678661124020d.png" alt="ue28.png"></p>
<h2 id="通过变换操作关卡对象"><a href="#通过变换操作关卡对象" class="headerlink" title="通过变换操作关卡对象"></a>通过变换操作关卡对象</h2><ol>
<li>选中关卡对象</li>
<li>在关卡蓝图中右键创建选中对象实例</li>
<li>设置位置、旋转、缩放</li>
</ol>
<p><img src="https://www.helloimg.com/i/2025/01/14/67866113d5de5.png" alt="ue29.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/14/6786611757f0f.png" alt="ue30.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/01/14/UE5-%E8%93%9D%E5%9B%BE%E5%9F%BA%E7%A1%80-%E4%B8%8A/" data-id="cm8sja97j002c8ktb0by9hbre" data-title="UE5-蓝图基础(上)" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unreal-Engine/" rel="tag">Unreal Engine</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Unity3D-飞行与射击" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/01/14/Unity3D-%E9%A3%9E%E8%A1%8C%E4%B8%8E%E5%B0%84%E5%87%BB/" class="article-date">
  <time class="dt-published" datetime="2025-01-14T05:36:56.000Z" itemprop="datePublished">2025-01-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Unity3D/">Unity3D</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/01/14/Unity3D-%E9%A3%9E%E8%A1%8C%E4%B8%8E%E5%B0%84%E5%87%BB/">Unity3D-飞行与射击</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="飞行和射击"><a href="#飞行和射击" class="headerlink" title="飞行和射击"></a>飞行和射击</h1><h2 id="冻结旋转"><a href="#冻结旋转" class="headerlink" title="冻结旋转"></a>冻结旋转</h2><p>物体的Rigidbody组件可以给物体增加物理属性。<br>当我们增加Rigidbody组件后，给物体一个力，就会发现物体会进行一定的运动，而且会螺旋升天。这时我们就需要在Constraints的下拉列表中冻结掉物体的旋转，</p>
<p><img src="https://www.helloimg.com/i/2025/01/14/6785f63cb1663.png" alt="unity3-1.png"></p>
<h2 id="增加弹簧"><a href="#增加弹簧" class="headerlink" title="增加弹簧"></a>增加弹簧</h2><p>在我们的角色中添加一个Configurable Joint组件。并且修改Y方向的弹簧效果及修改Y Drive。<br>第一个属性：Position Spring：弹簧的扭矩。<br>这边可以简单理解为和弹簧的弹力成正比。</p>
<p><img src="https://www.helloimg.com/i/2025/01/14/6785f63c9a3c1.png" alt="unity3-2.png"></p>
<p>给第一个属性赋值。这时当我们向上拖动我们的角色的时候，就会发现我们的角色进行着简谐运动。而且可能会出现穿模，还有穿到地板下面卡住。这是因为，在unity中，当物体的移动速度过快，就会造成穿模现象。当我们的角色穿过地板之后，再往回穿时，可能速度变慢，结果就被迫当了土行孙。<br>那么怎么解决这个问题呢？那就要限制我们角色向下的最大作用力。<br>这时就需要Y Drive中的第三个属性：Maimum Force。用来限制最大作用力。这时就可以发现我们角色物体的下落速度变慢了。也不会造成穿模现象。同时我们的球和地板都有一个Collider组件。这个组件就是用来进行碰撞检测的。</p>
<p><img src="https://www.helloimg.com/i/2025/01/14/6785f63c88ced.png" alt="unity3-3.png"></p>
<p>继续测试，发现我们的角色会一直蹦蹦跳跳变成兔子。显然我们不需要兔子警官。所以我们可以给我们的角色设置一个摩擦力。在Rigid body中给Drag赋值。Drag为空气阻力。当我们的角色下落时受到空气阻力，下落速度就会变慢。简单的物理学。</p>
<p><img src="https://www.helloimg.com/i/2025/01/14/6785f63c9c7e2.png" alt="unity3-4.png"></p>
<h2 id="实现飞行功能"><a href="#实现飞行功能" class="headerlink" title="实现飞行功能"></a>实现飞行功能</h2><p>在PlayerInput脚本中设置一个向上的推力</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// thrusterForce变量用于控制玩家跳跃或推进的力度</span></span><br><span class="line">[<span class="meta">SerializeField</span>]</span><br><span class="line"><span class="keyword">private</span> <span class="built_in">float</span> thrusterForce = <span class="number">20f</span>;</span><br></pre></td></tr></table></figure>

<p>y轴的坐标轴为上，所以当我们按住空格时给y轴方向一个向上的力。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化一个力向量，用于存储推进力</span></span><br><span class="line">Vector3 force = Vector3.zero;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检测玩家是否按下跳跃键（空格键）</span></span><br><span class="line"><span class="keyword">if</span> (Input.GetButton(<span class="string">&quot;Jump&quot;</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 如果按下跳跃键，设置力向量为向上的力，乘以推进力度</span></span><br><span class="line">    force = Vector3.up * thrusterForce;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在PlayerController脚本中获取玩家的输入。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// thrusterForce用于存储玩家的推进力</span></span><br><span class="line">   <span class="keyword">private</span> Vector3 thrusterForce = Vector3.zero;</span><br></pre></td></tr></table></figure>

<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Thrust方法用于设置玩家的推进力</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Thrust</span>(<span class="params">Vector3 _thrusterForce</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    thrusterForce = _thrusterForce;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在PerformMovement函数里加一个判断</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果推进力不为零，则施加推进力</span></span><br><span class="line"><span class="keyword">if</span> (thrusterForce != Vector3.zero)</span><br><span class="line">&#123;</span><br><span class="line">    rb.AddForce(thrusterForce);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再把Input计算的force值传递给controller</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用PlayerController的Thrust方法，传递计算出的推进力</span></span><br><span class="line">controller.Thrust(force);</span><br></pre></td></tr></table></figure>

<p>PlayerInput.cs和PlayerController.cs的完整代码：</p>
<p>Input:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PlayerInput类用于处理玩家的输入</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerInput</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// [SerializeField]使私有变量在Unity编辑器中可见并可编辑</span></span><br><span class="line">    <span class="comment">// speed变量用于控制玩家的移动速度</span></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">float</span> speed = <span class="number">5f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// lookSensitivity变量用于控制鼠标视角旋转的灵敏度</span></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">float</span> lookSensitivity = <span class="number">8f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// controller是PlayerController组件的引用，用于调用移动和旋转逻辑</span></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> PlayerController controller;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// thrusterForce变量用于控制玩家跳跃或推进的力度</span></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">float</span> thrusterForce = <span class="number">20f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start方法在游戏对象初始化时调用一次</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 锁定鼠标光标到屏幕中心，隐藏光标</span></span><br><span class="line">        Cursor.lockState = CursorLockMode.Locked;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update方法每一帧调用一次，用于处理实时输入和逻辑</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 获取水平轴（Horizontal）的输入值</span></span><br><span class="line">        <span class="comment">// Input.GetAxisRaw(&quot;Horizontal&quot;)返回一个值：</span></span><br><span class="line">        <span class="comment">// -1 表示玩家按下左键（A或左箭头）</span></span><br><span class="line">        <span class="comment">//  1 表示玩家按下右键（D或右箭头）</span></span><br><span class="line">        <span class="comment">//  0 表示没有按下任何键</span></span><br><span class="line">        <span class="built_in">float</span> xMov = Input.GetAxisRaw(<span class="string">&quot;Horizontal&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取垂直轴（Vertical）的输入值</span></span><br><span class="line">        <span class="comment">// Input.GetAxisRaw(&quot;Vertical&quot;)返回一个值：</span></span><br><span class="line">        <span class="comment">// -1 表示玩家按下下键（S或下箭头）</span></span><br><span class="line">        <span class="comment">//  1 表示玩家按下上键（W或上箭头）</span></span><br><span class="line">        <span class="comment">//  0 表示没有按下任何键</span></span><br><span class="line">        <span class="built_in">float</span> yMov = Input.GetAxisRaw(<span class="string">&quot;Vertical&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 计算移动方向</span></span><br><span class="line">        <span class="comment">// transform.right 是游戏对象的局部右方向（X轴）</span></span><br><span class="line">        <span class="comment">// transform.forward 是游戏对象的局部前方向（Z轴）</span></span><br><span class="line">        <span class="comment">// 将水平和垂直输入值分别与右方向和前方向相乘，得到移动方向向量</span></span><br><span class="line">        <span class="comment">// .normalized 将向量归一化，确保移动速度不会因为斜向移动而变快</span></span><br><span class="line">        <span class="comment">// 乘以 speed 以控制移动速度</span></span><br><span class="line">        Vector3 velocity = (transform.right * xMov + transform.forward * yMov).normalized * speed;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用PlayerController的Move方法，传递计算出的速度</span></span><br><span class="line">        controller.Move(velocity);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取鼠标在X轴和Y轴上的移动输入</span></span><br><span class="line">        <span class="built_in">float</span> xMouse = Input.GetAxisRaw(<span class="string">&quot;Mouse X&quot;</span>); <span class="comment">// 鼠标水平移动</span></span><br><span class="line">        <span class="built_in">float</span> yMouse = Input.GetAxisRaw(<span class="string">&quot;Mouse Y&quot;</span>); <span class="comment">// 鼠标垂直移动</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 计算角色和摄像机的旋转值</span></span><br><span class="line">        <span class="comment">// yRotation 是角色绕Y轴旋转的值（左右旋转）</span></span><br><span class="line">        <span class="comment">// xRotation 是摄像机绕X轴旋转的值（上下旋转）</span></span><br><span class="line">        <span class="comment">// 乘以 lookSensitivity 以控制旋转的灵敏度</span></span><br><span class="line">        Vector3 yRotation = <span class="keyword">new</span> Vector3(<span class="number">0f</span>, xMouse, <span class="number">0f</span>) * lookSensitivity;</span><br><span class="line">        Vector3 xRotation = <span class="keyword">new</span> Vector3(-yMouse, <span class="number">0f</span>, <span class="number">0f</span>) * lookSensitivity;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用PlayerController的Rotate方法，传递旋转值</span></span><br><span class="line">        controller.Rotate(yRotation, xRotation);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 初始化一个力向量，用于存储推进力</span></span><br><span class="line">        Vector3 force = Vector3.zero;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检测玩家是否按下跳跃键（空格键）</span></span><br><span class="line">        <span class="keyword">if</span> (Input.GetButton(<span class="string">&quot;Jump&quot;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 如果按下跳跃键，设置力向量为向上的力，乘以推进力度</span></span><br><span class="line">            force = Vector3.up * thrusterForce;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用PlayerController的Thrust方法，传递计算出的推进力</span></span><br><span class="line">        controller.Thrust(force);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Controller:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PlayerController类用于控制玩家的移动和旋转逻辑</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerController</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// [SerializeField]使私有变量在Unity编辑器中可见并可编辑</span></span><br><span class="line">    <span class="comment">// rb是玩家的Rigidbody组件，用于物理移动</span></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> Rigidbody rb;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// cam是摄像机组件，用于控制视角旋转</span></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> Camera cam;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// velocity用于存储玩家的移动速度，每秒移动的速度</span></span><br><span class="line">    <span class="keyword">private</span> Vector3 velocity = Vector3.zero;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// yRotation用于存储角色的旋转值（绕Y轴旋转）</span></span><br><span class="line">    <span class="keyword">private</span> Vector3 yRotation = Vector3.zero;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// xRotation用于存储摄像机的旋转值（绕X轴旋转）</span></span><br><span class="line">    <span class="keyword">private</span> Vector3 xRotation = Vector3.zero;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// thrusterForce用于存储玩家的推进力</span></span><br><span class="line">    <span class="keyword">private</span> Vector3 thrusterForce = Vector3.zero;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Move方法用于设置玩家的移动速度</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Move</span>(<span class="params">Vector3 _velocity</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        velocity = _velocity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Rotate方法用于设置角色和摄像机的旋转值</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Rotate</span>(<span class="params">Vector3 _yRotation, Vector3 _xRotation</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        yRotation = _yRotation;</span><br><span class="line">        xRotation = _xRotation;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Thrust方法用于设置玩家的推进力</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Thrust</span>(<span class="params">Vector3 _thrusterForce</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        thrusterForce = _thrusterForce;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// PerformMovement方法用于执行玩家的移动</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">PerformMovement</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 如果速度不为零，则移动玩家</span></span><br><span class="line">        <span class="keyword">if</span> (velocity != Vector3.zero)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 使用Rigidbody的MovePosition方法移动玩家</span></span><br><span class="line">            <span class="comment">// rb.position + velocity * Time.fixedDeltaTime 计算新的位置</span></span><br><span class="line">            <span class="comment">// Time.fixedDeltaTime 是固定时间步长，确保物理更新与帧率无关</span></span><br><span class="line">            rb.MovePosition(rb.position + velocity * Time.fixedDeltaTime);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果推进力不为零，则施加推进力</span></span><br><span class="line">        <span class="keyword">if</span> (thrusterForce != Vector3.zero)</span><br><span class="line">        &#123;</span><br><span class="line">            rb.AddForce(thrusterForce);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// PerformRotation方法用于执行角色和摄像机的旋转</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">PerformRotation</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 如果yRotation不为零，则旋转角色（绕Y轴旋转）</span></span><br><span class="line">        <span class="keyword">if</span> (yRotation != Vector3.zero)</span><br><span class="line">        &#123;</span><br><span class="line">            rb.transform.Rotate(yRotation);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果xRotation不为零，则旋转摄像机（绕X轴旋转）</span></span><br><span class="line">        <span class="keyword">if</span> (xRotation != Vector3.zero)</span><br><span class="line">        &#123;</span><br><span class="line">            cam.transform.Rotate(xRotation);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// FixedUpdate方法在固定时间间隔调用，用于物理更新</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">FixedUpdate</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        PerformMovement(); <span class="comment">// 执行移动</span></span><br><span class="line">        PerformRotation(); <span class="comment">// 执行旋转</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时我们的角色就可以起飞了。但是我们的角色只能贴地飞行。这是因为我们向上的力和重力持平。我们的物体就会卡在同一高度不能再向上。此时有两种解决办法，一种是加大我们的上升力。或者减少我们的重力。但是这种情况会造成我们的物体上升过快或者下降过慢。</p>
<p>我们可以采用另一种方法，就是在我们起飞时，将我们的弹力取消掉。</p>
<p>首先在Input里引用组件ConfigurableJoint</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不写[SerializeField]的话也可以用代码来选择组件，写到Start里</span></span><br><span class="line"><span class="comment">// joint是ConfigurableJoint组件的引用，用于控制玩家的物理行为（如跳跃时的关节约束）</span></span><br><span class="line"><span class="keyword">private</span> ConfigurableJoint joint;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Start方法在游戏对象初始化时调用一次</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 锁定鼠标光标到屏幕中心，隐藏光标</span></span><br><span class="line">    Cursor.lockState = CursorLockMode.Locked;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取当前游戏对象上的ConfigurableJoint组件</span></span><br><span class="line">    joint = GetComponent&lt;ConfigurableJoint&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在跳跃时禁用弹簧组件</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 检测玩家是否按下跳跃键（空格键）</span></span><br><span class="line"><span class="keyword">if</span> (Input.GetButton(<span class="string">&quot;Jump&quot;</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 如果按下跳跃键，设置力向量为向上的力，乘以推进力度</span></span><br><span class="line">    force = Vector3.up * thrusterForce;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改ConfigurableJoint的yDrive属性，禁用弹簧和阻尼，使玩家可以自由跳跃</span></span><br><span class="line">    joint.yDrive = <span class="keyword">new</span> JointDrive</span><br><span class="line">    &#123;</span><br><span class="line">        positionSpring = <span class="number">0f</span>,    <span class="comment">// 弹簧力，设置为0表示无约束</span></span><br><span class="line">        positionDamper = <span class="number">0f</span>,   <span class="comment">// 阻尼力，设置为0表示无阻尼</span></span><br><span class="line">        maximumForce = <span class="number">0f</span>,     <span class="comment">// 最大力，设置为0表示无限制</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 如果未按下跳跃键，恢复ConfigurableJoint的yDrive属性，使玩家受到约束</span></span><br><span class="line">    joint.yDrive = <span class="keyword">new</span> JointDrive</span><br><span class="line">    &#123;</span><br><span class="line">        positionSpring = <span class="number">20f</span>,   <span class="comment">// 弹簧力，设置为20表示有一定约束</span></span><br><span class="line">        positionDamper = <span class="number">0f</span>,   <span class="comment">// 阻尼力，设置为0表示无阻尼</span></span><br><span class="line">        maximumForce = <span class="number">40f</span>,    <span class="comment">// 最大力，设置为40表示有限制</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时就可以飞行</p>
<p><img src="https://www.helloimg.com/i/2025/01/14/6785f64047299.png" alt="unity3-5.png"></p>
<h2 id="限制玩家视角"><a href="#限制玩家视角" class="headerlink" title="限制玩家视角"></a>限制玩家视角</h2><p>我们的角色可以变成大陀螺，可以上下无限的转圈。这显然是我们所不想看到的。所以在PlyaerController中添加一个判断。记录我们累计转了多少度，然后给一个上限。让我们的视角保持在正常范围内。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cameraRotationTotal用于累计摄像机的总旋转角度</span></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">float</span> cameraRotationTotal = <span class="number">0f</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// cameraRotationLimit用于限制摄像机的旋转角度范围</span></span><br><span class="line">[<span class="meta">SerializeField</span>]</span><br><span class="line"><span class="keyword">private</span> <span class="built_in">float</span> cameraRotationLimit = <span class="number">85f</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PerformRotation方法用于执行角色和摄像机的旋转</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">PerformRotation</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 如果yRotation不为零，则旋转角色（绕Y轴旋转）</span></span><br><span class="line">    <span class="keyword">if</span> (yRotation != Vector3.zero)</span><br><span class="line">    &#123;</span><br><span class="line">        rb.transform.Rotate(yRotation);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果xRotation不为零，则旋转摄像机（绕X轴旋转）</span></span><br><span class="line">    <span class="keyword">if</span> (xRotation != Vector3.zero)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 累加摄像机的旋转角度</span></span><br><span class="line">        cameraRotationTotal += xRotation.x;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用Mathf.Clamp限制摄像机的旋转角度在指定范围内</span></span><br><span class="line">        cameraRotationTotal = Mathf.Clamp(cameraRotationTotal, -cameraRotationLimit, cameraRotationLimit);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置摄像机的局部欧拉角，限制其绕X轴旋转</span></span><br><span class="line">        cam.transform.localEulerAngles = <span class="keyword">new</span> Vector3(cameraRotationTotal, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时发现往下看和网上看最多只能转85度</p>
<p><img src="https://www.helloimg.com/i/2025/01/14/6785f63c8991b.png" alt="unity3-6.png"></p>
<h2 id="实现射击功能"><a href="#实现射击功能" class="headerlink" title="实现射击功能"></a>实现射击功能</h2><p>在FPS游戏中，射击功能通常是由玩家的摄像机发出一条射线，再配合枪口的火焰来完成射击功能的实现。</p>
<p>为了让枪的各个数据为一组，新建一个脚本PlayerWeapon</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PlayerWeapon类用于定义玩家的武器属性</span></span><br><span class="line">[<span class="meta">Serializable</span>] <span class="comment">// 添加[Serializable]标记，使该类的实例可以在Unity编辑器中序列化和显示</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerWeapon</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// name变量用于存储武器的名称</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name = <span class="string">&quot;M16A1&quot;</span>; <span class="comment">// 默认武器名称为&quot;M16A1&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// damage变量用于存储武器的伤害值</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> damage = <span class="number">10</span>; <span class="comment">// 默认伤害值为10</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// range变量用于存储武器的射程</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> range = <span class="number">100f</span>; <span class="comment">// 默认射程为100单位</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在Player中添加一个PlayerShooting脚本。来完成射击功能的实现。</p>
<p>射击的具体实现：<br>从玩家的摄像机中射出一条射线，然后判断该射线与哪些物体相交。然后返回相交的物体名称。</p>
<p>先来实现单发模式(GetButtonDown就是点一下射击一下，Get Button就是按住一直射)：</p>
<p>注意在InputManager中的Fire1，左键和左CTRL用来Fire1，左CTRL未来用作蹲下，所以把左CTRL去掉</p>
<p><img src="https://www.helloimg.com/i/2025/01/14/6785f63f60755.png" alt="unity3-7.png"></p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PlayerShooting类用于处理玩家的射击逻辑</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerShooting</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// [SerializeField]使私有变量在Unity编辑器中可见并可编辑</span></span><br><span class="line">    <span class="comment">// weapon变量用于存储玩家的武器属性</span></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> PlayerWeapon weapon;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// mask变量用于指定射线检测的层级掩码</span></span><br><span class="line">    <span class="comment">// 选择&quot;Everything&quot;表示检测所有层级</span></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> LayerMask mask;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// cam变量用于存储摄像机的引用</span></span><br><span class="line">    <span class="keyword">private</span> Camera cam;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start方法在游戏对象初始化时调用一次</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 获取当前游戏对象的子物体中的Camera组件</span></span><br><span class="line">        cam = GetComponentInChildren&lt;Camera&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update方法每一帧调用一次，用于处理实时输入和逻辑</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 检测玩家是否按下开火键（默认是鼠标左键）</span></span><br><span class="line">        <span class="keyword">if</span> (Input.GetButtonDown(<span class="string">&quot;Fire1&quot;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 调用Shoot方法执行射击逻辑</span></span><br><span class="line">            Shoot();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Shoot方法用于实现射击逻辑</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Shoot</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 声明一个RaycastHit变量，用于存储射线检测的结果</span></span><br><span class="line">        RaycastHit hit;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用Physics.Raycast方法进行射线检测</span></span><br><span class="line">        <span class="comment">// 参数说明：</span></span><br><span class="line">        <span class="comment">// - cam.transform.position：射线的起点（摄像机的位置）</span></span><br><span class="line">        <span class="comment">// - cam.transform.forward：射线的方向（摄像机的前方）</span></span><br><span class="line">        <span class="comment">// - out hit：射线检测的结果（存储命中信息）</span></span><br><span class="line">        <span class="comment">// - weapon.range：射线的最大检测距离（武器的射程）</span></span><br><span class="line">        <span class="comment">// - mask：射线检测的层级掩码（只检测指定层级的物体）</span></span><br><span class="line">        <span class="keyword">if</span> (Physics.Raycast(cam.transform.position, cam.transform.forward, <span class="keyword">out</span> hit, weapon.range, mask))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 如果射线检测到物体，输出命中物体的名称到控制台</span></span><br><span class="line">            Debug.Log(hit.collider.name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://www.helloimg.com/i/2025/01/14/6785f640d5639.png" alt="unity3-8.png"></p>
<h2 id="设置玩家名"><a href="#设置玩家名" class="headerlink" title="设置玩家名"></a>设置玩家名</h2><p>在PlayerSetup脚本中,start()调用以下函数</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SetPlayerName 方法用于为玩家对象设置唯一名称</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SetPlayerName</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 将玩家对象的名称设置为 &quot;Player&quot; 加上其网络对象的唯一 ID</span></span><br><span class="line">    transform.name = <span class="string">&quot;Player&quot;</span> + GetComponent&lt;NetworkObject&gt;().NetworkObjectId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://www.helloimg.com/i/2025/01/14/6785f63f3d9c1.png" alt="unity3-9.png"></p>
<h2 id="给服务器传消息"><a href="#给服务器传消息" class="headerlink" title="给服务器传消息"></a>给服务器传消息</h2><p>在PlayerShooting类中</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> Unity.Netcode; <span class="comment">// 引入 Unity Netcode 命名空间，用于网络功能</span></span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PlayerShooting类用于处理玩家的射击逻辑</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerShooting</span> : <span class="title">NetworkBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// [SerializeField]使私有变量在Unity编辑器中可见并可编辑</span></span><br><span class="line">    <span class="comment">// weapon变量用于存储玩家的武器属性</span></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> PlayerWeapon weapon;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// mask变量用于指定射线检测的层级掩码</span></span><br><span class="line">    <span class="comment">// 选择&quot;Everything&quot;表示检测所有层级</span></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> LayerMask mask;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// cam变量用于存储摄像机的引用</span></span><br><span class="line">    <span class="keyword">private</span> Camera cam;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start方法在游戏对象初始化时调用一次</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 获取当前游戏对象的子物体中的Camera组件</span></span><br><span class="line">        cam = GetComponentInChildren&lt;Camera&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update方法每一帧调用一次，用于处理实时输入和逻辑</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 检测玩家是否按下开火键（默认是鼠标左键）</span></span><br><span class="line">        <span class="keyword">if</span> (Input.GetButtonDown(<span class="string">&quot;Fire1&quot;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 调用Shoot方法执行射击逻辑</span></span><br><span class="line">            Shoot();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Shoot方法用于实现射击逻辑</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Shoot</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 声明一个RaycastHit变量，用于存储射线检测的结果</span></span><br><span class="line">        RaycastHit hit;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用Physics.Raycast方法进行射线检测</span></span><br><span class="line">        <span class="comment">// 参数说明：</span></span><br><span class="line">        <span class="comment">// - cam.transform.position：射线的起点（摄像机的位置）</span></span><br><span class="line">        <span class="comment">// - cam.transform.forward：射线的方向（摄像机的前方）</span></span><br><span class="line">        <span class="comment">// - out hit：射线检测的结果（存储命中信息）</span></span><br><span class="line">        <span class="comment">// - weapon.range：射线的最大检测距离（武器的射程）</span></span><br><span class="line">        <span class="comment">// - mask：射线检测的层级掩码（只检测指定层级的物体）</span></span><br><span class="line">        <span class="keyword">if</span> (Physics.Raycast(cam.transform.position, cam.transform.forward, <span class="keyword">out</span> hit, weapon.range, mask))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 调用 ShootServerRpc 方法，将命中物体的名称传递给服务器</span></span><br><span class="line">            ShootServerRpc(hit.collider.name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ShootServerRpc 方法是一个服务器 RPC 方法，用于在服务器上处理射击逻辑</span></span><br><span class="line">    [<span class="meta">ServerRpc</span>] <span class="comment">// 标记为服务器 RPC 方法，只有服务器可以执行此方法</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ShootServerRpc</span>(<span class="params"><span class="built_in">string</span> hittedName</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 在服务器上输出日志，显示哪个玩家击中了哪个物体</span></span><br><span class="line">        Debug.Log(transform.name + <span class="string">&quot; hit &quot;</span> + hittedName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="自己窗口只允许自己射击"><a href="#自己窗口只允许自己射击" class="headerlink" title="自己窗口只允许自己射击"></a>自己窗口只允许自己射击</h2><p>把Player Shooting组件加入到禁用组件列表中</p>
<p><img src="https://www.helloimg.com/i/2025/01/14/6785f63f60cb1.png" alt="unity3-10.png"></p>
<h2 id="在游戏界面显示调试信息-用作调试，可以不需要"><a href="#在游戏界面显示调试信息-用作调试，可以不需要" class="headerlink" title="在游戏界面显示调试信息(用作调试，可以不需要)"></a>在游戏界面显示调试信息(用作调试，可以不需要)</h2><p>新建一个Empty命名为GameManager，新建一个脚本也命名为GameManager，将这个组件添加到Game Manager里</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GameManager类用于管理游戏中的全局信息和UI显示</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GameManager</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 静态变量info用于存储需要显示的全局信息</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">string</span> info;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// UpdateInfo方法用于更新全局信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">UpdateInfo</span>(<span class="params"><span class="built_in">string</span> _info</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        info = _info;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// OnGUI方法用于绘制UI</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnGUI</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 定义一个矩形区域，用于显示信息</span></span><br><span class="line">        <span class="comment">// 参数说明：</span></span><br><span class="line">        <span class="comment">// - 200f, 200f：区域的起始位置（左上角坐标）</span></span><br><span class="line">        <span class="comment">// - 200f, 400f：区域的宽度和高度</span></span><br><span class="line">        GUILayout.BeginArea(<span class="keyword">new</span> Rect(<span class="number">200f</span>, <span class="number">200f</span>, <span class="number">200f</span>, <span class="number">400f</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 开始一个垂直布局</span></span><br><span class="line">        GUILayout.BeginVertical();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 在UI中显示info变量的内容</span></span><br><span class="line">        GUILayout.Label(info);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 结束垂直布局</span></span><br><span class="line">        GUILayout.EndVertical();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 结束矩形区域</span></span><br><span class="line">        GUILayout.EndArea();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在PlayerShooting里调用</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ShootServerRpc 方法是一个服务器 RPC 方法，用于在服务器上处理射击逻辑</span></span><br><span class="line">[<span class="meta">ServerRpc</span>] <span class="comment">// 标记为服务器 RPC 方法，只有服务器可以执行此方法</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ShootServerRpc</span>(<span class="params"><span class="built_in">string</span> hittedName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 在游戏界面输出日志，显示哪个玩家击中了哪个物体</span></span><br><span class="line">    GameManager.UpdateInfo(transform.name + <span class="string">&quot; hit &quot;</span> + hittedName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时就可以看到调试信息</p>
<p><img src="https://www.helloimg.com/i/2025/01/14/6785f6415cc88.png" alt="unity3-11.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/01/14/Unity3D-%E9%A3%9E%E8%A1%8C%E4%B8%8E%E5%B0%84%E5%87%BB/" data-id="cm8sja97u003v8ktb1b9xgnw9" data-title="Unity3D-飞行与射击" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/" rel="tag">Unity3D</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Unity3D-同一个局域网联机" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/01/13/Unity3D-%E5%90%8C%E4%B8%80%E4%B8%AA%E5%B1%80%E5%9F%9F%E7%BD%91%E8%81%94%E6%9C%BA/" class="article-date">
  <time class="dt-published" datetime="2025-01-13T12:51:41.000Z" itemprop="datePublished">2025-01-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Unity3D/">Unity3D</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/01/13/Unity3D-%E5%90%8C%E4%B8%80%E4%B8%AA%E5%B1%80%E5%9F%9F%E7%BD%91%E8%81%94%E6%9C%BA/">Unity3D-同一个局域网联机</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="同一个局域网内联机"><a href="#同一个局域网内联机" class="headerlink" title="同一个局域网内联机"></a>同一个局域网内联机</h2><h3 id="联机如何实现？"><a href="#联机如何实现？" class="headerlink" title="联机如何实现？"></a>联机如何实现？</h3><p><strong>服务器判断：</strong></p>
<p>玩家 a 移动，在其他玩家眼里也会动。一般通过一个中心服务器 Server 实现，首先玩家 a 的客户端 clientA 向 Server<br>发送控制移动的输入，Server 判断玩家 a 能否移动，Server 判断完毕后，将结果发送给 ClientA 和 ClientB 等其他<br>客户端。客户端接收到消息后再渲染出动画。问题就是有网络延迟。</p>
<p><img src="https://www.helloimg.com/i/2025/01/13/6784f3f0bfbf2.jpg" alt="unity2-1.jpg"></p>
<p><strong>客户端判断：</strong></p>
<p>玩家 a 移动，在自己的客户端中判断是否能移动，然后将移动的消息传给 Server，但是 Server 不需要传回 ClinetA。<br>然后 Server 更新自己的信息，再同步发送到 ClientB 等其他客户端。问题就是客户端可以发送 Server 虚假的信息，<br>也就是外挂。</p>
<p><img src="https://www.helloimg.com/i/2025/01/13/6784f3eee0005.jpg" alt="unity2-2.jpg"></p>
<h3 id="同步"><a href="#同步" class="headerlink" title="同步"></a>同步</h3><p>多个客户端描述的同一个游戏场景，再 clinetA 中玩家 a,b,c 的坐标和 ClinetB 中 a,b,c 的坐标应该是一致的，<br>由于有网络延迟的存在，不可能完全一致。</p>
<p>例如由于网络延迟的原因会造成玩家不同的运动轨迹</p>
<p><img src="https://www.helloimg.com/i/2025/01/13/6784f3ef143ab.jpg" alt="unity2-3.jpg"></p>
<p>权衡利弊后根据某个玩家的状态去同步其他玩家</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>在 unity 中实现了很多网络通信的包，除了 Server 和 Clinet 外，还有一个 host。host 就是主机，即 Server 和 Client 合二为一</p>
<h3 id="安装网络资源包"><a href="#安装网络资源包" class="headerlink" title="安装网络资源包"></a>安装网络资源包</h3><p>com.unity.netcode.gameobjects（需要更新到 Unity 2021.3 及以后版本才能看到）</p>
<ul>
<li>工具栏：Windows-&gt;Package Manager</li>
<li>左上角改为： Unity Registry，找到对应的包，右下角 install(已经安装则显示 Remove)</li>
</ul>
<p><img src="https://www.helloimg.com/i/2025/01/13/678485f602d09.png" alt="unity2-4.png"></p>
<h3 id="配置网络组件"><a href="#配置网络组件" class="headerlink" title="配置网络组件"></a>配置网络组件</h3><p>创建空 Object，命名为 NetworkManager 管理所有需要联机同步的物体，添加组件(add component) NetwortkManager</p>
<p>此时可能 NetworkManager 会有两个警告：安装包 Multiplaers Tools（按照上文方法）；选择 NetworkTrnasport 后即可消除</p>
<p><img src="https://www.helloimg.com/i/2025/01/13/67850a7081795.png" alt="unity2-18.png"></p>
<h3 id="添加需要同步的元素-Player"><a href="#添加需要同步的元素-Player" class="headerlink" title="添加需要同步的元素 Player"></a>添加需要同步的元素 Player</h3><p>在 Assets 里创建一个文件夹 Prefabs，将 Player 拖到这个文件夹里，此时可以删除掉左侧的 Player</p>
<p><img src="https://www.helloimg.com/i/2025/01/13/678485f8e4531.png" alt="unity2-5.png"></p>
<p>如果在 Clinet 中摧毁了一棵树，ClientB 怎么知道摧毁的是树而不是车？所以所有需要网络同步的物体需要有一个唯一 id</p>
<p>给 Player 添加一个 NetworkObject 组件，就会有一个全局哈希值作为唯一编号</p>
<p><img src="https://www.helloimg.com/i/2025/01/13/678485f53fe1e.png" alt="unity2-6.png"></p>
<p>添加 Player 到 NetworkPrefabs，在 Default Network Prefabs</p>
<p><img src="https://www.helloimg.com/i/2025/01/13/678485f537cf1.png" alt="unity2-7.png"></p>
<p>在 Player 组件中再 add component 一个 Network Transform，用于选择需要同步的信息</p>
<p>根据提示，在 Player 组件中再 add component 一个 Network Rigidbody</p>
<p>此时 unity 可以自动帮我们同步 Player</p>
<p><img src="https://www.helloimg.com/i/2025/01/13/678485f57c402.png" alt="unity2-8.png"></p>
<p>除了同步玩家以外，还需要同步 Camera，双击Player，在Camera里同样也添加一个 Network Transform，用于选择需要同步的信息。<br>另外 Camera 的父组件 Player 已经有一个唯一编号，所以 Camera 不需要唯一编号</p>
<p><img src="https://www.helloimg.com/i/2025/01/13/678485f7ab594.png" alt="unity2-9.png"></p>
<h2 id="实现开局创建自动创建角色"><a href="#实现开局创建自动创建角色" class="headerlink" title="实现开局创建自动创建角色"></a>实现开局创建自动创建角色</h2><p>点击 NetworkManager，将 Player 拖到 Player Perfab 上</p>
<p><img src="https://www.helloimg.com/i/2025/01/13/678485f779ba8.png" alt="unity2-10.png"></p>
<p>此时点击运行游戏，会发现黑屏，原因是因为 Camera 是在 Player 上，开局并没有创建角色就没有 Camera</p>
<p><img src="https://www.helloimg.com/i/2025/01/13/678485f957b14.png" alt="unity2-11.png"></p>
<p>添加一个 Camera 用作展示初始界面，调整角度位置</p>
<p><img src="https://www.helloimg.com/i/2025/01/13/678485fba13eb.png" alt="unity2-12.png"></p>
<p>开始运行游戏，点击左侧 Don’tDestroyOnload，点击 NetworkManager，右侧会出现三个选项：<br>startHost、StartServer 和 StartClinet</p>
<p><img src="https://www.helloimg.com/i/2025/01/13/678485fbd7612.png" alt="unity2-13.png"></p>
<p>点击 starthost 发现自动创建了一个 Player，但是位置是初始位置，可以把Environment的纵坐标往下移动2个单位</p>
<p><img src="https://www.helloimg.com/i/2025/01/13/67850a6ea4a9a.png" alt="unity2-19.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/13/678485fa6bbe8.png" alt="unity2-14.png"></p>
<p>添加 ui，把 startHost、StartServer 和 StartClinet 作为按钮放入到游戏里。右键新建一个 ui&#x2F;canvas.<br>重命名为 menuUI。</p>
<p><img src="https://www.helloimg.com/i/2025/01/13/678485fcc1980.png" alt="unity2-15.png"></p>
<p>在 canvas 里添加按钮，右键 MenuUI 新建 Button，如果有提示需要 import 就按照提示 import</p>
<p><img src="https://www.helloimg.com/i/2025/01/13/6784860144e4a.png" alt="unity2-16.png"></p>
<p>此时运行游戏</p>
<p><img src="https://www.helloimg.com/i/2025/01/13/678485fca57d1.png" alt="unity2-17.png"></p>
<p>写按钮的逻辑：</p>
<p>给 NetworkManager 添加一个脚本 NetworkManagerUI</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> Unity.Netcode; <span class="comment">// 引入 Unity Netcode 命名空间，用于网络功能</span></span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">NetworkManagerUI</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 序列化字段，用于在 Unity 编辑器中绑定 UI 按钮</span></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> Button hostBtn; <span class="comment">// 用于启动主机的按钮</span></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> Button serverBtn; <span class="comment">// 用于启动服务器的按钮</span></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> Button clientBtn; <span class="comment">// 用于启动客户端的按钮</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start 方法在游戏对象初始化时调用</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 为 &quot;Host&quot; 按钮添加点击事件监听器</span></span><br><span class="line">        hostBtn.onClick.AddListener(() =&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 调用 NetworkManager 的单例方法 StartHost，启动主机</span></span><br><span class="line">            <span class="comment">// 主机既是服务器又是客户端</span></span><br><span class="line">            NetworkManager.Singleton.StartHost();</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 为 &quot;Server&quot; 按钮添加点击事件监听器</span></span><br><span class="line">        serverBtn.onClick.AddListener(() =&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 调用 NetworkManager 的单例方法 StartServer，启动纯服务器</span></span><br><span class="line">            <span class="comment">// 服务器不参与游戏逻辑，仅处理网络同步</span></span><br><span class="line">            NetworkManager.Singleton.StartServer();</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 为 &quot;Client&quot; 按钮添加点击事件监听器</span></span><br><span class="line">        clientBtn.onClick.AddListener(() =&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 调用 NetworkManager 的单例方法 StartClient，启动客户端</span></span><br><span class="line">            <span class="comment">// 客户端连接到服务器并参与游戏</span></span><br><span class="line">            NetworkManager.Singleton.StartClient();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时点击相应的 button 就有相应的操作</p>
<h2 id="禁用非本地玩家的组件"><a href="#禁用非本地玩家的组件" class="headerlink" title="禁用非本地玩家的组件"></a>禁用非本地玩家的组件</h2><p>此时直接运行 host 和 client，会发现两个角色会同时移动，并且 unity 中显示有多个 Audio 被使用的警告<br>原因是在一个 Player 中，没有禁用其他 Player 的输入控制和 Camera；并且开始菜单的 Camera 和本地 Player 的 Cameara 也会有冲突<br>在 Player 中添加一段脚本 PlayerSetup 解决此问题</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> Unity.Netcode; <span class="comment">// 引入 Unity Netcode 命名空间，用于网络功能</span></span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PlayerSetup 类用于设置玩家对象的初始状态</span></span><br><span class="line"><span class="comment">// 继承自 NetworkBehaviour，表示这是一个网络行为脚本</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerSetup</span> : <span class="title">NetworkBehaviour</span> <span class="comment">// 注意修改本行</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 序列化字段，用于在 Unity 编辑器中绑定需要禁用的组件</span></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> Behaviour[] componentsToDisable; <span class="comment">// 需要禁用的组件数组</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 场景主摄像机</span></span><br><span class="line">    <span class="keyword">private</span> Camera sceneCamera;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start 方法在游戏对象初始化时调用</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 判断当前玩家对象是否为本机玩家</span></span><br><span class="line">        <span class="keyword">if</span> (!IsLocalPlayer) <span class="comment">// 如果不是本机玩家</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 遍历需要禁用的组件数组</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; componentsToDisable.Length; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 禁用组件</span></span><br><span class="line">                componentsToDisable[i].enabled = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="comment">// 如果是本机玩家</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 获取场景主摄像机</span></span><br><span class="line">            sceneCamera = Camera.main;</span><br><span class="line">            <span class="keyword">if</span> (sceneCamera != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 关闭场景主摄像机</span></span><br><span class="line">                sceneCamera.gameObject.SetActive(<span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// OnDisable 方法在游戏对象被禁用或销毁时调用</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnDisable</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 如果场景主摄像机存在</span></span><br><span class="line">        <span class="keyword">if</span> (sceneCamera != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 重新启用场景主摄像机</span></span><br><span class="line">            sceneCamera.gameObject.SetActive(<span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将需要被禁用的组件拖到列表中：</p>
<p><img src="https://www.helloimg.com/i/2025/01/13/67850a7125e3e.png" alt="unity2-20.png"></p>
<p>注意代码<code>sceneCamera = Camera.main;</code>需要把SceneCamera的tag改为main<br><img src="https://www.helloimg.com/i/2025/01/13/67850a6e3b81e.png" alt="unity2-21.png"></p>
<p>此时开启两个窗口运行游戏，发现一个能移动，一个不行，这是因为unity默认是以服务器判断方式。Unity默认不信任客户端，没有授权，需要自己写一段脚本打开授权</p>
<p><img src="https://www.helloimg.com/i/2025/01/13/67850a72a8c8e.png" alt="unity2-22.png"></p>
<p>在Assets&#x2F;Scripts&#x2F;Network&#x2F;里新建一个脚本ClientNetworkTransform.cs</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入必要的命名空间</span></span><br><span class="line"><span class="keyword">using</span> Unity.Netcode.Components;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个命名空间，用于组织代码</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Unity.Multiplayer.Sample.Utilities.ClientAuthority</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// [DisallowMultipleComponent] 是一个特性，表示这个脚本不允许在同一个GameObject上添加多个实例</span></span><br><span class="line">    [<span class="meta">DisallowMultipleComponent</span>]</span><br><span class="line">    <span class="comment">// 继承自 NetworkTransform，这是一个用于同步物体位置、旋转和缩放的网络组件</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ClientNetworkTransform</span> : <span class="title">NetworkTransform</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 重写 NetworkTransform 中的 OnIsServerAuthoritative 方法</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="built_in">bool</span> <span class="title">OnIsServerAuthoritative</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 返回 false，表示这个 NetworkTransform 不由服务器（Server）进行权威控制</span></span><br><span class="line">            <span class="comment">// 而是由客户端（Client）进行控制，即客户端拥有对该物体的位置、旋转和缩放的最终决定权</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码含义：重载<code>NetWorkTransform</code>中的授权函数<br>所以，要将用到<code>NetWorkTransform</code>的地方改为<code>ClientNetWorkTransform</code></p>
<p><code>Player：</code><br>删除 <code>Network RigidBody</code>和<code>Network Trnasform</code><br>添加 <code>ClientNetworkTransform</code>和<code>Network RigidBody</code></p>
<p><img src="https://www.helloimg.com/i/2025/01/13/67850a704d808.png" alt="unity2-23.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/13/67850a715b8d6.png" alt="unity2-24.png"></p>
<p>此时就实现了本地联机并且多个Player都可以移动</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/01/13/Unity3D-%E5%90%8C%E4%B8%80%E4%B8%AA%E5%B1%80%E5%9F%9F%E7%BD%91%E8%81%94%E6%9C%BA/" data-id="cm8sja97i00258ktbgrxj13fs" data-title="Unity3D-同一个局域网联机" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/" rel="tag">Unity3D</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Unity3D-项目创建和角色移动" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/01/10/Unity3D-%E9%A1%B9%E7%9B%AE%E5%88%9B%E5%BB%BA%E5%92%8C%E8%A7%92%E8%89%B2%E7%A7%BB%E5%8A%A8/" class="article-date">
  <time class="dt-published" datetime="2025-01-10T09:27:06.000Z" itemprop="datePublished">2025-01-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Unity3D/">Unity3D</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/01/10/Unity3D-%E9%A1%B9%E7%9B%AE%E5%88%9B%E5%BB%BA%E5%92%8C%E8%A7%92%E8%89%B2%E7%A7%BB%E5%8A%A8/">Unity3D-项目创建和角色移动</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><p>打开 unity hub，点击新项目，选择 3d 模板</p>
<p>创建完毕后是这样</p>
<p><img src="https://www.helloimg.com/i/2025/01/10/6780e63642d22.png" alt="unity1.png"></p>
<h2 id="unity-资源商店"><a href="#unity-资源商店" class="headerlink" title="unity 资源商店"></a>unity 资源商店</h2><p>可以使用别人做好的素材，<a target="_blank" rel="noopener" href="https://assetstore.unity.com/zh-CN">AssetStore</a></p>
<p>找到想要的素材，点击在 unity 中打开，此时编辑器会弹出一个 Package Manager。点击 download 下载，下载好之后可以 import 导入，选择需要的资源导入即可。导入完毕在 Assets 会多一些文件夹</p>
<p>这里导入一个<a target="_blank" rel="noopener" href="https://assetstore.unity.com/packages/3d/prototyping-pack-free-94277">Prototyping Pack (Free)</a></p>
<p><img src="https://www.helloimg.com/i/2025/01/13/678485f9362ec.png" alt="unity1-1.png"></p>
<h2 id="添加素材"><a href="#添加素材" class="headerlink" title="添加素材"></a>添加素材</h2><p>在刚刚的资源中，选择一个扁平地形，这里选的是 PTK_Cuboid_5<br><img src="https://www.helloimg.com/i/2025/01/10/6780e634d6c2d.png" alt="unity2.png"></p>
<h2 id="添加纹理"><a href="#添加纹理" class="headerlink" title="添加纹理"></a>添加纹理</h2><p>在文件夹 materias，选择想要的纹理直接拖到物体上</p>
<h2 id="把地图多个物体作为一个整体"><a href="#把地图多个物体作为一个整体" class="headerlink" title="把地图多个物体作为一个整体"></a>把地图多个物体作为一个整体</h2><p>可以右键 create empty,重命名后可以将多个物体拖到这个下，操作整个地图只需要操作这个 empty</p>
<p><img src="https://www.helloimg.com/i/2025/01/13/678488255e6a1.png" alt="unity1-2.png"></p>
<h2 id="删除Main-camera"><a href="#删除Main-camera" class="headerlink" title="删除Main camera"></a>删除Main camera</h2><p>由于该项目是一个FPS(第一人称射击游戏)，所以不需要第三视角的相机</p>
<h2 id="创建角色"><a href="#创建角色" class="headerlink" title="创建角色"></a>创建角色</h2><p>这里以一个球体来表示玩家，右键添加一个 sphere，重命名为 Player,右键 Player 创建一个 empty，重命名为 Graphics，这个用来管理纹理。在编辑器右侧把Player带 mesh 的组件(这是用来控制纹理的，纹理我们用Graphics来管理)移除掉，右键 remove component。在 graphics 里面添加一个 Sphere，因为外侧的 Player 也是一个 Sphere，删除掉里面 sphere 的碰撞检测组件，Sphere collider。</p>
<p><img src="https://www.helloimg.com/i/2025/01/13/67848a53e6dae.png" alt="unity1-3.png"></p>
<p><img src="https://www.helloimg.com/i/2025/01/13/67848ae442009.png" alt="unity1-4.png"></p>
<h2 id="把相机放到第一视角"><a href="#把相机放到第一视角" class="headerlink" title="把相机放到第一视角"></a>把相机放到第一视角</h2><p>在 Player 上右键创建一个 Camera，由于物体的面都是有向的，所以可以把相机塞到球体里面，此时相机可以看到外面，外面看不到相机。</p>
<p><img src="https://www.helloimg.com/i/2025/01/10/6780e636bed88.png" alt="unity3.png"></p>
<h2 id="添加玩家的枪"><a href="#添加玩家的枪" class="headerlink" title="添加玩家的枪"></a>添加玩家的枪</h2><p>在资源商店选择<a target="_blank" rel="noopener" href="https://assetstore.unity.com/packages/3d/props/weapons/3d-guns-guns-pack-228975">3D GUNS | Guns Pack</a>。下载并导入<br><img src="https://www.helloimg.com/i/2025/01/10/6780e634c6d71.png" alt="unity4.png"></p>
<p>把喜欢的枪添加到相机里面，直接把枪拖到 Player 里的 camera 上。调整枪的方向、大小和位置，第一人称能看到枪</p>
<p><img src="https://www.helloimg.com/i/2025/01/13/67848f07078e0.png" alt="unity1-5.png"></p>
<h2 id="玩家移动"><a href="#玩家移动" class="headerlink" title="玩家移动"></a>玩家移动</h2><p>注意一个问题，玩家移动视角时，左右看是玩家左右旋转，而抬头低头就只旋转 Camera。</p>
<h3 id="实现键盘控制玩家移动"><a href="#实现键盘控制玩家移动" class="headerlink" title="实现键盘控制玩家移动"></a>实现键盘控制玩家移动</h3><p>给 Player 增加一个 rigidbody 组件，在 Unity 中，Rigidbody 组件用于为游戏对象添加物理属性，使其能够受到物理引擎的控制。由于 Player 是一个球体需要浮空一点，所以<strong>关闭 rigidbody 的重力</strong></p>
<p>给 Player 添加代码，选择 Player，add component 一个 new script。添加两个脚本文件: PlayerInput 和 PlayerController。</p>
<p><img src="https://www.helloimg.com/i/2025/01/13/6784902945945.png" alt="unity1-6.png"></p>
<p>打开代码后：<br>PlayerController</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerController</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Start is called before the first frame update</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PlayerInput</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerInput</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Start is called before the first frame update</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>获取键盘前后左右的输入,注意带[SerializeField]的变量要在unity editor中赋值,PlayerInput.cs:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PlayerInput类用于处理玩家的输入</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerInput</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// [SerializeField]使私有变量在Unity编辑器中可见并可编辑</span></span><br><span class="line">    <span class="comment">// speed变量用于控制玩家的移动速度</span></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">float</span> speed = <span class="number">2f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// controller是PlayerController组件的引用，用于调用移动逻辑</span></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> PlayerController controller;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start方法在游戏对象初始化时调用一次</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update方法每一帧调用一次，用于处理实时输入和逻辑</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 获取水平轴（Horizontal）的输入值</span></span><br><span class="line">        <span class="comment">// Input.GetAxisRaw(&quot;Horizontal&quot;)返回一个值：</span></span><br><span class="line">        <span class="comment">// -1 表示玩家按下左键（A或左箭头）</span></span><br><span class="line">        <span class="comment">//  1 表示玩家按下右键（D或右箭头）</span></span><br><span class="line">        <span class="comment">//  0 表示没有按下任何键</span></span><br><span class="line">        <span class="built_in">float</span> xMov = Input.GetAxisRaw(<span class="string">&quot;Horizontal&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取垂直轴（Vertical）的输入值</span></span><br><span class="line">        <span class="comment">// Input.GetAxisRaw(&quot;Vertical&quot;)返回一个值：</span></span><br><span class="line">        <span class="comment">// -1 表示玩家按下下键（S或下箭头）</span></span><br><span class="line">        <span class="comment">//  1 表示玩家按下上键（W或上箭头）</span></span><br><span class="line">        <span class="comment">//  0 表示没有按下任何键</span></span><br><span class="line">        <span class="built_in">float</span> yMov = Input.GetAxisRaw(<span class="string">&quot;Vertical&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 计算移动方向</span></span><br><span class="line">        <span class="comment">// transform.right 是游戏对象的局部右方向（X轴）</span></span><br><span class="line">        <span class="comment">// transform.forward 是游戏对象的局部前方向（Z轴）</span></span><br><span class="line">        <span class="comment">// 将水平和垂直输入值分别与右方向和前方向相乘，得到移动方向向量</span></span><br><span class="line">        <span class="comment">// .normalized 将向量归一化，确保移动速度不会因为斜向移动而变快</span></span><br><span class="line">        <span class="comment">// 乘以 speed 以控制移动速度</span></span><br><span class="line">        Vector3 velocity = (transform.right * xMov + transform.forward * yMov).normalized * speed;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用PlayerController的Move方法，传递计算出的速度</span></span><br><span class="line">        <span class="comment">// 这里 velocity 已经乘以了 speed，因此不需要再乘以 speed</span></span><br><span class="line">        controller.Move(velocity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>控制玩家移动的逻辑，PlayerController.cs:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PlayerController类用于控制玩家的移动逻辑</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerController</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// [SerializeField]使私有变量在Unity编辑器中可见并可编辑</span></span><br><span class="line">    <span class="comment">// rb是玩家的Rigidbody组件，用于物理移动</span></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> Rigidbody rb;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// velocity用于存储玩家的移动速度</span></span><br><span class="line">    <span class="keyword">private</span> Vector3 velocity = Vector3.zero;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Move方法用于设置玩家的移动速度</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Move</span>(<span class="params">Vector3 _velocity</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        velocity = _velocity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// PerformMovement方法用于执行玩家的移动</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">PerformMovement</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 如果速度不为零，则移动玩家</span></span><br><span class="line">        <span class="keyword">if</span> (velocity != Vector3.zero)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 使用Rigidbody的MovePosition方法移动玩家</span></span><br><span class="line">            <span class="comment">// rb.position + velocity * Time.fixedDeltaTime 计算新的位置</span></span><br><span class="line">            <span class="comment">// Time.fixedDeltaTime 是固定时间步长，确保物理更新与帧率无关</span></span><br><span class="line">            rb.MovePosition(rb.position + velocity * Time.fixedDeltaTime);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// FixedUpdate方法在固定时间间隔调用，用于物理更新</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">FixedUpdate</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        PerformMovement();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实现旋转视角"><a href="#实现旋转视角" class="headerlink" title="实现旋转视角"></a>实现旋转视角</h3><p>PlayerController.cs:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PlayerController类用于控制玩家的移动和旋转逻辑</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerController</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// [SerializeField]使私有变量在Unity编辑器中可见并可编辑</span></span><br><span class="line">    <span class="comment">// rb是玩家的Rigidbody组件，用于物理移动</span></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> Rigidbody rb;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// cam是摄像机组件，用于控制视角旋转</span></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> Camera cam;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// velocity用于存储玩家的移动速度，每秒移动的速度</span></span><br><span class="line">    <span class="keyword">private</span> Vector3 velocity = Vector3.zero;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// yRotation用于存储角色的旋转值（绕Y轴旋转）</span></span><br><span class="line">    <span class="keyword">private</span> Vector3 yRotation = Vector3.zero;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// xRotation用于存储摄像机的旋转值（绕X轴旋转）</span></span><br><span class="line">    <span class="keyword">private</span> Vector3 xRotation = Vector3.zero;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Move方法用于设置玩家的移动速度</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Move</span>(<span class="params">Vector3 _velocity</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        velocity = _velocity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Rotate方法用于设置角色和摄像机的旋转值</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Rotate</span>(<span class="params">Vector3 _yRotation, Vector3 _xRotation</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        yRotation = _yRotation;</span><br><span class="line">        xRotation = _xRotation;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// PerformMovement方法用于执行玩家的移动</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">PerformMovement</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 如果速度不为零，则移动玩家</span></span><br><span class="line">        <span class="keyword">if</span> (velocity != Vector3.zero)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 使用Rigidbody的MovePosition方法移动玩家</span></span><br><span class="line">            <span class="comment">// rb.position + velocity * Time.fixedDeltaTime 计算新的位置</span></span><br><span class="line">            <span class="comment">// Time.fixedDeltaTime 是固定时间步长，确保物理更新与帧率无关</span></span><br><span class="line">            rb.MovePosition(rb.position + velocity * Time.fixedDeltaTime);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// PerformRotation方法用于执行角色和摄像机的旋转</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">PerformRotation</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 如果yRotation不为零，则旋转角色（绕Y轴旋转）</span></span><br><span class="line">        <span class="keyword">if</span> (yRotation != Vector3.zero)</span><br><span class="line">        &#123;</span><br><span class="line">            rb.transform.Rotate(yRotation);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果xRotation不为零，则旋转摄像机（绕X轴旋转）</span></span><br><span class="line">        <span class="keyword">if</span> (xRotation != Vector3.zero)</span><br><span class="line">        &#123;</span><br><span class="line">            cam.transform.Rotate(xRotation);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// FixedUpdate方法在固定时间间隔调用，用于物理更新</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">FixedUpdate</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        PerformMovement(); <span class="comment">// 执行移动</span></span><br><span class="line">        PerformRotation(); <span class="comment">// 执行旋转</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PlayerInput.cs:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PlayerInput类用于处理玩家的输入</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerInput</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// [SerializeField]使私有变量在Unity编辑器中可见并可编辑</span></span><br><span class="line">    <span class="comment">// speed变量用于控制玩家的移动速度</span></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">float</span> speed = <span class="number">2f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// lookSensitivity变量用于控制鼠标视角旋转的灵敏度</span></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">float</span> lookSensitivity = <span class="number">8f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// controller是PlayerController组件的引用，用于调用移动和旋转逻辑</span></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> PlayerController controller;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start方法在游戏对象初始化时调用一次</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 锁定鼠标光标到屏幕中心，隐藏光标</span></span><br><span class="line">        Cursor.lockState = CursorLockMode.Locked;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update方法每一帧调用一次，用于处理实时输入和逻辑</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 获取水平轴（Horizontal）的输入值</span></span><br><span class="line">        <span class="comment">// Input.GetAxisRaw(&quot;Horizontal&quot;)返回一个值：</span></span><br><span class="line">        <span class="comment">// -1 表示玩家按下左键（A或左箭头）</span></span><br><span class="line">        <span class="comment">//  1 表示玩家按下右键（D或右箭头）</span></span><br><span class="line">        <span class="comment">//  0 表示没有按下任何键</span></span><br><span class="line">        <span class="built_in">float</span> xMov = Input.GetAxisRaw(<span class="string">&quot;Horizontal&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取垂直轴（Vertical）的输入值</span></span><br><span class="line">        <span class="comment">// Input.GetAxisRaw(&quot;Vertical&quot;)返回一个值：</span></span><br><span class="line">        <span class="comment">// -1 表示玩家按下下键（S或下箭头）</span></span><br><span class="line">        <span class="comment">//  1 表示玩家按下上键（W或上箭头）</span></span><br><span class="line">        <span class="comment">//  0 表示没有按下任何键</span></span><br><span class="line">        <span class="built_in">float</span> yMov = Input.GetAxisRaw(<span class="string">&quot;Vertical&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 计算移动方向</span></span><br><span class="line">        <span class="comment">// transform.right 是游戏对象的局部右方向（X轴）</span></span><br><span class="line">        <span class="comment">// transform.forward 是游戏对象的局部前方向（Z轴）</span></span><br><span class="line">        <span class="comment">// 将水平和垂直输入值分别与右方向和前方向相乘，得到移动方向向量</span></span><br><span class="line">        <span class="comment">// .normalized 将向量归一化，确保移动速度不会因为斜向移动而变快</span></span><br><span class="line">        <span class="comment">// 乘以 speed 以控制移动速度</span></span><br><span class="line">        Vector3 velocity = (transform.right * xMov + transform.forward * yMov).normalized * speed;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用PlayerController的Move方法，传递计算出的速度</span></span><br><span class="line">        controller.Move(velocity);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取鼠标在X轴和Y轴上的移动输入</span></span><br><span class="line">        <span class="built_in">float</span> xMouse = Input.GetAxisRaw(<span class="string">&quot;Mouse X&quot;</span>); <span class="comment">// 鼠标水平移动</span></span><br><span class="line">        <span class="built_in">float</span> yMouse = Input.GetAxisRaw(<span class="string">&quot;Mouse Y&quot;</span>); <span class="comment">// 鼠标垂直移动</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 计算角色和摄像机的旋转值</span></span><br><span class="line">        <span class="comment">// yRotation 是角色绕Y轴旋转的值（左右旋转）</span></span><br><span class="line">        <span class="comment">// xRotation 是摄像机绕X轴旋转的值（上下旋转）</span></span><br><span class="line">        <span class="comment">// 乘以 lookSensitivity 以控制旋转的灵敏度</span></span><br><span class="line">        Vector3 yRotation = <span class="keyword">new</span> Vector3(<span class="number">0f</span>, xMouse, <span class="number">0f</span>) * lookSensitivity;</span><br><span class="line">        Vector3 xRotation = <span class="keyword">new</span> Vector3(-yMouse, <span class="number">0f</span>, <span class="number">0f</span>) * lookSensitivity;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用PlayerController的Rotate方法，传递旋转值</span></span><br><span class="line">        controller.Rotate(yRotation, xRotation);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="导出项目"><a href="#导出项目" class="headerlink" title="导出项目"></a>导出项目</h2><p>File-&gt;Build Settings-&gt;选择平台-&gt;PlayerSettings 选择合适选项</p>
<p><img src="https://www.helloimg.com/i/2025/01/13/678499673df1c.png" alt="unity1-7.png"></p>
<p>这里以 build 一个 Windows 为例：</p>
<p><img src="https://www.helloimg.com/i/2025/01/10/6780e63370482.png" alt="unity5.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/01/10/Unity3D-%E9%A1%B9%E7%9B%AE%E5%88%9B%E5%BB%BA%E5%92%8C%E8%A7%92%E8%89%B2%E7%A7%BB%E5%8A%A8/" data-id="cm8sja97j002a8ktb527ebda5" data-title="Unity3D-项目创建和角色移动" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/" rel="tag">Unity3D</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Web项目-拳皇-下" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/01/07/Web%E9%A1%B9%E7%9B%AE-%E6%8B%B3%E7%9A%87-%E4%B8%8B/" class="article-date">
  <time class="dt-published" datetime="2025-01-07T12:48:35.000Z" itemprop="datePublished">2025-01-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web/">Web</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/01/07/Web%E9%A1%B9%E7%9B%AE-%E6%8B%B3%E7%9A%87-%E4%B8%8B/">Web项目-拳皇-下</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="项目实战–拳皇"><a href="#项目实战–拳皇" class="headerlink" title="项目实战–拳皇"></a>项目实战–拳皇</h1><h2 id="实现攻击效果"><a href="#实现攻击效果" class="headerlink" title="实现攻击效果"></a>实现攻击效果</h2><p>在Player类中把人物背景渲染出来，以及添加一个矩形来表示挥拳范围，便于碰撞检测</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// render方法，表示玩家角色在游戏画面中的呈现形式，这里不是简单地使用矩形填充绘制，而是根据玩家角色当前的状态，从对应的动画信息中获取相应帧的图像，并绘制到游戏画面上，实现更丰富的动画效果展示</span></span><br><span class="line"><span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">fillStyle</span> = <span class="string">&#x27;blue&#x27;</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">fillRect</span>(<span class="variable language_">this</span>.<span class="property">x</span>, <span class="variable language_">this</span>.<span class="property">y</span>, <span class="variable language_">this</span>.<span class="property">width</span>, <span class="variable language_">this</span>.<span class="property">height</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果是正方向</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">direction</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">//画一个矩形表示挥拳的范围，以便于做碰撞检测</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">fillStyle</span> = <span class="string">&#x27;red&#x27;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">fillRect</span>(<span class="variable language_">this</span>.<span class="property">x</span> + <span class="number">120</span>, <span class="variable language_">this</span>.<span class="property">y</span> + <span class="number">40</span>, <span class="number">100</span>, <span class="number">20</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">fillStyle</span> = <span class="string">&#x27;red&#x27;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">fillRect</span>(<span class="variable language_">this</span>.<span class="property">x</span> + <span class="variable language_">this</span>.<span class="property">width</span> - <span class="number">120</span> - <span class="number">100</span>, <span class="variable language_">this</span>.<span class="property">y</span> + <span class="number">40</span>, <span class="number">100</span>, <span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> status = <span class="variable language_">this</span>.<span class="property">status</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这里添加了一个逻辑判断，当角色当前处于向前移动状态（status === 1），并且角色的方向（direction）与水平速度（vx）的乘积小于 0，</span></span><br><span class="line">    <span class="comment">// 意味着角色实际在朝与当前设定方向相反的方向移动（比如角色面朝右，但正在向左移动），此时将状态调整为向后移动状态（status = 2），</span></span><br><span class="line">    <span class="comment">// 是为了切换到对应的向后移动动画来展示更符合实际视觉效果的动画表现</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="number">1</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">direction</span> * <span class="variable language_">this</span>.<span class="property">vx</span> &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        status = <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> obj = <span class="variable language_">this</span>.<span class="property">animations</span>.<span class="title function_">get</span>(status);</span><br><span class="line">    <span class="keyword">if</span> (obj &amp;&amp; obj.<span class="property">loaded</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">direction</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 根据当前帧数（frame_current_cnt）和当前状态动画的帧率（frame_rate）计算出当前应该显示的动画帧索引k，通过取余操作确保帧索引在有效范围内（不超过总帧数）</span></span><br><span class="line">            <span class="keyword">let</span> k = <span class="built_in">parseInt</span>(<span class="variable language_">this</span>.<span class="property">frame_current_cnt</span> / obj.<span class="property">frame_rate</span>) % obj.<span class="property">frame_cnt</span>;</span><br><span class="line">            <span class="keyword">let</span> image = obj.<span class="property">gif</span>.<span class="property">frames</span>[k].<span class="property">image</span>;</span><br><span class="line">            <span class="comment">// 使用绘图上下文对象（ctx）的drawImage方法，将计算出的当前帧图像绘制到游戏画面上，同时根据动画的缩放比例（scale）和垂直方向的偏移量（offset_y）调整图像的大小和位置，使其正确显示在玩家角色对应的坐标位置上</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">drawImage</span>(image, <span class="variable language_">this</span>.<span class="property">x</span>, <span class="variable language_">this</span>.<span class="property">y</span> + obj.<span class="property">offset_y</span>, image.<span class="property">width</span> * obj.<span class="property">scale</span>, image.<span class="property">height</span> * obj.<span class="property">scale</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 如果角色方向为负（向左），则需要翻转图像</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">save</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">scale</span>(-<span class="number">1</span>, <span class="number">1</span>); <span class="comment">// 水平翻转画布</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">translate</span>(-<span class="variable language_">this</span>.<span class="property">root</span>.<span class="property">game_map</span>.<span class="property">$canvas</span>.<span class="title function_">width</span>(), <span class="number">0</span>); <span class="comment">// 调整画布位置</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> k = <span class="built_in">parseInt</span>(<span class="variable language_">this</span>.<span class="property">frame_current_cnt</span> / obj.<span class="property">frame_rate</span>) % obj.<span class="property">frame_cnt</span>;</span><br><span class="line">            <span class="keyword">let</span> image = obj.<span class="property">gif</span>.<span class="property">frames</span>[k].<span class="property">image</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 绘制翻转后的图像</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">drawImage</span>(image, <span class="variable language_">this</span>.<span class="property">root</span>.<span class="property">game_map</span>.<span class="property">$canvas</span>.<span class="title function_">width</span>() - <span class="variable language_">this</span>.<span class="property">x</span> - <span class="variable language_">this</span>.<span class="property">width</span>, <span class="variable language_">this</span>.<span class="property">y</span> + obj.<span class="property">offset_y</span>, image.<span class="property">width</span> * obj.<span class="property">scale</span>, image.<span class="property">height</span> * obj.<span class="property">scale</span>);</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">restore</span>(); <span class="comment">// 恢复画布状态</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 当角色处于攻击状态（status === 4）时，判断当前帧数是否达到该攻击状态动画最后一帧（通过比较当前帧数与帧率乘以总帧数减 1 的值），若达到，说明攻击动画播放完毕，将角色状态设为空闲状态（0）</span></span><br><span class="line">    <span class="keyword">if</span> (status === <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">frame_current_cnt</span> == obj.<span class="property">frame_rate</span> * (obj.<span class="property">frame_cnt</span> - <span class="number">1</span>)) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">status</span> = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">frame_current_cnt</span>++;</span><br><span class="line">    <span class="comment">// 每渲染一次，当前帧数自增1，用于控制动画的逐帧播放，使得下一帧渲染时能切换到下一张动画帧（根据帧率等因素决定）</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现攻击函数、碰撞检测函数和被攻击函数,另外还有render函数需要特判一下被攻击的状态</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MyGameObject</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;/static/js/MyGameObject/base.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Player</span> <span class="keyword">extends</span> <span class="title class_ inherited__">MyGameObject</span> &#123;</span><br><span class="line">    <span class="comment">// 类的构造函数，在创建Player类的实例时会被调用，接收两个参数：root（即MyGameObject对象）和info（玩家的信息）</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">root, info</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(); <span class="comment">// 调用父类的构造函数</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">root</span> = root; <span class="comment">// 将传入的root对象赋值给当前实例的root属性</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">id</span> = info.<span class="property">id</span>; <span class="comment">// 从info对象中获取玩家角色的id信息，并赋值给当前实例的id属性</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">x</span> = info.<span class="property">x</span>; <span class="comment">// 从info对象中获取玩家角色的初始x坐标信息，并赋值给当前实例的x属性</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">y</span> = info.<span class="property">y</span>; <span class="comment">// 从info对象中获取玩家角色的初始y坐标信息，并赋值给当前实例的y属性</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">width</span> = info.<span class="property">width</span>; <span class="comment">// 获取玩家角色的宽度信息，赋值给当前实例的width属性</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">height</span> = info.<span class="property">height</span>; <span class="comment">// 获取玩家角色的高度信息，赋值给当前实例的height属性</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">color</span> = info.<span class="property">color</span>; <span class="comment">// 获取玩家角色的颜色信息，赋值给当前实例的color属性</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">vx</span> = <span class="number">0</span>; <span class="comment">// 初始化玩家角色在水平方向的速度分量为0</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">vy</span> = <span class="number">0</span>; <span class="comment">// 初始化玩家角色在垂直方向的速度分量为0</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">speedx</span> = <span class="number">400</span>; <span class="comment">// 定义玩家角色在水平方向的移动速度</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">speedy</span> = -<span class="number">1000</span>; <span class="comment">// 定义玩家角色在跳跃时的初始垂直速度</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span> = <span class="variable language_">this</span>.<span class="property">root</span>.<span class="property">game_map</span>.<span class="property">ctx</span>; <span class="comment">// 获取游戏地图的绘图上下文对象</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gravity</span> = <span class="number">50</span>; <span class="comment">// 定义玩家角色所受的重力加速度</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">direction</span> = <span class="number">1</span>; <span class="comment">// 定义玩家角色的方向，正方向为1</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">status</span> = <span class="number">3</span>; <span class="comment">// 初始值为3，表示玩家角色在游戏开始时是跳跃状态</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">pressed_Keys</span> = <span class="variable language_">this</span>.<span class="property">root</span>.<span class="property">game_map</span>.<span class="property">controller</span>.<span class="property">pressed_Keys</span>; <span class="comment">// 获取按键状态</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">animations</span> = <span class="keyword">new</span> <span class="title class_">Map</span>(); <span class="comment">// 用来存放玩家每一个状态的动画</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">frame_current_cnt</span> = <span class="number">0</span>; <span class="comment">// 表示当前帧数</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 初始化方法，可以在子类中重写以执行一些初始化操作</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义move方法，用于处理玩家角色的移动逻辑</span></span><br><span class="line">    <span class="title function_">move</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">vy</span> += <span class="variable language_">this</span>.<span class="property">gravity</span>; <span class="comment">// 在垂直方向上，根据重力加速度来更新垂直速度分量</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">x</span> += <span class="variable language_">this</span>.<span class="property">vx</span> * <span class="variable language_">this</span>.<span class="property">timedelta</span> / <span class="number">1000</span>; <span class="comment">// 更新玩家角色的水平坐标</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">y</span> += <span class="variable language_">this</span>.<span class="property">vy</span> * <span class="variable language_">this</span>.<span class="property">timedelta</span> / <span class="number">1000</span>; <span class="comment">// 更新玩家角色的垂直坐标</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">y</span> &gt; <span class="number">450</span>) &#123; <span class="comment">// 判断玩家角色是否到达地面</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">y</span> = <span class="number">450</span>; <span class="comment">// 将玩家角色的垂直坐标设置为450</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">vy</span> = <span class="number">0</span>; <span class="comment">// 将垂直速度分量重置为0</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">status</span> = <span class="number">0</span>; <span class="comment">// 将玩家角色的状态设置为空闲状态</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">x</span> &lt; <span class="number">0</span>) &#123; <span class="comment">// 限制玩家角色在水平方向上的移动范围，避免超出画布左边界</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">x</span> = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">x</span> + <span class="variable language_">this</span>.<span class="property">width</span> &gt; <span class="variable language_">this</span>.<span class="property">root</span>.<span class="property">game_map</span>.<span class="property">$canvas</span>.<span class="title function_">width</span>()) &#123; <span class="comment">// 限制玩家角色在水平方向上的移动范围，避免超出画布右边界</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">x</span> = <span class="number">1280</span> - <span class="variable language_">this</span>.<span class="property">width</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// update_control 方法，用于根据按键状态更新玩家角色的控制逻辑</span></span><br><span class="line">    <span class="title function_">update_control</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> w, a, d, space;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">id</span> === <span class="number">0</span>) &#123; <span class="comment">// 根据玩家角色的 id 确定按键映射</span></span><br><span class="line">            w = <span class="variable language_">this</span>.<span class="property">pressed_Keys</span>.<span class="title function_">has</span>(<span class="string">&#x27;w&#x27;</span>); <span class="comment">// 玩家 1 的跳跃键</span></span><br><span class="line">            a = <span class="variable language_">this</span>.<span class="property">pressed_Keys</span>.<span class="title function_">has</span>(<span class="string">&#x27;a&#x27;</span>); <span class="comment">// 玩家 1 的向左键</span></span><br><span class="line">            d = <span class="variable language_">this</span>.<span class="property">pressed_Keys</span>.<span class="title function_">has</span>(<span class="string">&#x27;d&#x27;</span>); <span class="comment">// 玩家 1 的向右键</span></span><br><span class="line">            space = <span class="variable language_">this</span>.<span class="property">pressed_Keys</span>.<span class="title function_">has</span>(<span class="string">&#x27; &#x27;</span>); <span class="comment">// 玩家 1 的攻击键</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            w = <span class="variable language_">this</span>.<span class="property">pressed_Keys</span>.<span class="title function_">has</span>(<span class="string">&#x27;ArrowUp&#x27;</span>); <span class="comment">// 玩家 2 的跳跃键</span></span><br><span class="line">            a = <span class="variable language_">this</span>.<span class="property">pressed_Keys</span>.<span class="title function_">has</span>(<span class="string">&#x27;ArrowLeft&#x27;</span>); <span class="comment">// 玩家 2 的向左键</span></span><br><span class="line">            d = <span class="variable language_">this</span>.<span class="property">pressed_Keys</span>.<span class="title function_">has</span>(<span class="string">&#x27;ArrowRight&#x27;</span>); <span class="comment">// 玩家 2 的向右键</span></span><br><span class="line">            space = <span class="variable language_">this</span>.<span class="property">pressed_Keys</span>.<span class="title function_">has</span>(<span class="string">&#x27;Enter&#x27;</span>); <span class="comment">// 玩家 2 的攻击键</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="number">0</span> || <span class="variable language_">this</span>.<span class="property">status</span> === <span class="number">1</span>) &#123; <span class="comment">// 若玩家角色处于空闲或移动状态</span></span><br><span class="line">            <span class="keyword">if</span> (space) &#123; <span class="comment">// 如果按下攻击键</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">status</span> = <span class="number">4</span>; <span class="comment">// 将角色状态设为攻击状态</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">vx</span> = <span class="number">0</span>; <span class="comment">// 将水平速度设为0</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">frame_current_cnt</span> = <span class="number">0</span>; <span class="comment">// 重置当前帧数为0</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (w) &#123; <span class="comment">// 如果按下跳跃键</span></span><br><span class="line">                <span class="keyword">if</span> (d) &#123; <span class="comment">// 同时按下向右键</span></span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">vx</span> = <span class="variable language_">this</span>.<span class="property">speedx</span>; <span class="comment">// 设置水平速度为正方向</span></span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a) &#123; <span class="comment">// 同时按下向左键</span></span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">vx</span> = -<span class="variable language_">this</span>.<span class="property">speedx</span>; <span class="comment">// 设置水平速度为负方向</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">vx</span> = <span class="number">0</span>; <span class="comment">// 否则水平速度为0</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">vy</span> = <span class="variable language_">this</span>.<span class="property">speedy</span>; <span class="comment">// 设置垂直速度为跳跃速度</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">status</span> = <span class="number">3</span>; <span class="comment">// 状态设置为跳跃状态</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (d) &#123; <span class="comment">// 如果按下向右键</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">vx</span> = <span class="variable language_">this</span>.<span class="property">speedx</span>; <span class="comment">// 设置水平速度为正方向</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">status</span> = <span class="number">1</span>; <span class="comment">// 状态设置为移动状态</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a) &#123; <span class="comment">// 如果按下向左键</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">vx</span> = -<span class="variable language_">this</span>.<span class="property">speedx</span>; <span class="comment">// 设置水平速度为负方向</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">status</span> = <span class="number">1</span>; <span class="comment">// 状态设置为移动状态</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// 如果没有按下任何移动键</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">vx</span> = <span class="number">0</span>; <span class="comment">// 水平速度为0</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">status</span> = <span class="number">0</span>; <span class="comment">// 状态设置为空闲状态</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// update_direction 方法，用于更新玩家角色的方向</span></span><br><span class="line">    <span class="title function_">update_direction</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> players = <span class="variable language_">this</span>.<span class="property">root</span>.<span class="property">players</span>;</span><br><span class="line">        <span class="keyword">if</span> (players[<span class="number">0</span>] &amp;&amp; players[<span class="number">1</span>]) &#123; <span class="comment">// 如果存在两个玩家</span></span><br><span class="line">            <span class="keyword">let</span> me = <span class="variable language_">this</span>, you = players[<span class="number">1</span> - <span class="variable language_">this</span>.<span class="property">id</span>]; <span class="comment">// 获取当前玩家和对手玩家</span></span><br><span class="line">            <span class="keyword">if</span> (me.<span class="property">x</span> &lt; you.<span class="property">x</span>) me.<span class="property">direction</span> = <span class="number">1</span>; <span class="comment">// 如果当前玩家在左侧，则方向为正（向右）</span></span><br><span class="line">            <span class="keyword">else</span> me.<span class="property">direction</span> = -<span class="number">1</span>; <span class="comment">// 否则方向为负（向左）</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// is_attack 方法，用于设置玩家角色为被攻击状态</span></span><br><span class="line">    <span class="title function_">is_attack</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">status</span> = <span class="number">5</span>; <span class="comment">// 将状态设置为被攻击状态</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">frame_current_cnt</span> = <span class="number">0</span>; <span class="comment">// 重置当前帧数为0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// is_collision 方法，用于检测两个矩形是否发生碰撞</span></span><br><span class="line">    <span class="title function_">is_collision</span>(<span class="params">r1, r2</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Math</span>.<span class="title function_">max</span>(r1.<span class="property">x1</span>, r2.<span class="property">x1</span>) &gt; <span class="title class_">Math</span>.<span class="title function_">min</span>(r1.<span class="property">x2</span>, r2.<span class="property">x2</span>)) <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// 判断x轴是否有交集</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Math</span>.<span class="title function_">max</span>(r1.<span class="property">y1</span>, r2.<span class="property">y1</span>) &gt; <span class="title class_">Math</span>.<span class="title function_">min</span>(r1.<span class="property">y2</span>, r2.<span class="property">y2</span>)) <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// 判断y轴是否有交集</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// 如果x轴和y轴都有交集，则发生碰撞</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// update_attack 方法，用于处理玩家角色的攻击逻辑</span></span><br><span class="line">    <span class="title function_">update_attack</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="number">4</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">frame_current_cnt</span> === <span class="number">18</span>) &#123; <span class="comment">// 如果玩家角色处于攻击状态且当前帧数为18</span></span><br><span class="line">            <span class="keyword">let</span> me = <span class="variable language_">this</span>, you = <span class="variable language_">this</span>.<span class="property">root</span>.<span class="property">players</span>[<span class="number">1</span> - <span class="variable language_">this</span>.<span class="property">id</span>]; <span class="comment">// 获取当前玩家和对手玩家</span></span><br><span class="line">            <span class="keyword">let</span> r1;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">direction</span> &gt; <span class="number">0</span>) &#123; <span class="comment">// 如果玩家角色方向为正（向右）</span></span><br><span class="line">                r1 = &#123;</span><br><span class="line">                    <span class="attr">x1</span>: me.<span class="property">x</span> + <span class="number">120</span>,</span><br><span class="line">                    <span class="attr">y1</span>: me.<span class="property">y</span> + <span class="number">40</span>,</span><br><span class="line">                    <span class="attr">x2</span>: me.<span class="property">x</span> + <span class="number">120</span> + <span class="number">100</span>,</span><br><span class="line">                    <span class="attr">y2</span>: me.<span class="property">y</span> + <span class="number">40</span> + <span class="number">20</span>,</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// 如果玩家角色方向为负（向左）</span></span><br><span class="line">                r1 = &#123;</span><br><span class="line">                    <span class="attr">x1</span>: me.<span class="property">x</span> + me.<span class="property">width</span> - <span class="number">120</span> - <span class="number">100</span>,</span><br><span class="line">                    <span class="attr">y1</span>: me.<span class="property">y</span> + <span class="number">40</span>,</span><br><span class="line">                    <span class="attr">x2</span>: me.<span class="property">x</span> + me.<span class="property">width</span> - <span class="number">120</span> - <span class="number">100</span> + <span class="number">100</span>,</span><br><span class="line">                    <span class="attr">y2</span>: me.<span class="property">y</span> + <span class="number">40</span> + <span class="number">20</span>,</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> r2 = &#123; <span class="comment">// 对手玩家的矩形区域</span></span><br><span class="line">                <span class="attr">x1</span>: you.<span class="property">x</span>,</span><br><span class="line">                <span class="attr">y1</span>: you.<span class="property">y</span>,</span><br><span class="line">                <span class="attr">x2</span>: you.<span class="property">x</span> + you.<span class="property">width</span>,</span><br><span class="line">                <span class="attr">y2</span>: you.<span class="property">y</span> + you.<span class="property">height</span>,</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">is_collision</span>(r1, r2)) &#123; <span class="comment">// 如果两个矩形发生碰撞</span></span><br><span class="line">                you.<span class="title function_">is_attack</span>(); <span class="comment">// 设置对手玩家为被攻击状态</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// update 方法，用于更新玩家角色的状态</span></span><br><span class="line">    <span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">update_control</span>(); <span class="comment">// 更新控制逻辑</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">move</span>(); <span class="comment">// 更新移动逻辑</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">update_direction</span>(); <span class="comment">// 更新方向</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">update_attack</span>(); <span class="comment">// 更新攻击逻辑</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">render</span>(); <span class="comment">// 渲染玩家角色</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// render 方法，用于渲染玩家角色</span></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> status = <span class="variable language_">this</span>.<span class="property">status</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="number">1</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">direction</span> * <span class="variable language_">this</span>.<span class="property">vx</span> &lt; <span class="number">0</span>) &#123; <span class="comment">// 如果玩家角色处于移动状态且方向与速度方向相反</span></span><br><span class="line">            status = <span class="number">2</span>; <span class="comment">// 将状态设置为向后移动状态</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> obj = <span class="variable language_">this</span>.<span class="property">animations</span>.<span class="title function_">get</span>(status); <span class="comment">// 获取当前状态的动画对象</span></span><br><span class="line">        <span class="keyword">if</span> (obj &amp;&amp; obj.<span class="property">loaded</span>) &#123; <span class="comment">// 如果动画对象存在且已加载</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">direction</span> &gt; <span class="number">0</span>) &#123; <span class="comment">// 如果玩家角色方向为正（向右）</span></span><br><span class="line">                <span class="keyword">let</span> k = <span class="built_in">parseInt</span>(<span class="variable language_">this</span>.<span class="property">frame_current_cnt</span> / obj.<span class="property">frame_rate</span>) % obj.<span class="property">frame_cnt</span>; <span class="comment">// 计算当前帧索引</span></span><br><span class="line">                <span class="keyword">let</span> image = obj.<span class="property">gif</span>.<span class="property">frames</span>[k].<span class="property">image</span>; <span class="comment">// 获取当前帧的图像</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">drawImage</span>(image, <span class="variable language_">this</span>.<span class="property">x</span>, <span class="variable language_">this</span>.<span class="property">y</span> + obj.<span class="property">offset_y</span>, image.<span class="property">width</span> * obj.<span class="property">scale</span>, image.<span class="property">height</span> * obj.<span class="property">scale</span>); <span class="comment">// 绘制图像</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// 如果玩家角色方向为负（向左）</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">save</span>(); <span class="comment">// 保存画布状态</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">scale</span>(-<span class="number">1</span>, <span class="number">1</span>); <span class="comment">// 水平翻转画布</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">translate</span>(-<span class="variable language_">this</span>.<span class="property">root</span>.<span class="property">game_map</span>.<span class="property">$canvas</span>.<span class="title function_">width</span>(), <span class="number">0</span>); <span class="comment">// 调整画布位置</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">let</span> k = <span class="built_in">parseInt</span>(<span class="variable language_">this</span>.<span class="property">frame_current_cnt</span> / obj.<span class="property">frame_rate</span>) % obj.<span class="property">frame_cnt</span>; <span class="comment">// 计算当前帧索引</span></span><br><span class="line">                <span class="keyword">let</span> image = obj.<span class="property">gif</span>.<span class="property">frames</span>[k].<span class="property">image</span>; <span class="comment">// 获取当前帧的图像</span></span><br><span class="line"></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">drawImage</span>(image, <span class="variable language_">this</span>.<span class="property">root</span>.<span class="property">game_map</span>.<span class="property">$canvas</span>.<span class="title function_">width</span>() - <span class="variable language_">this</span>.<span class="property">x</span> - <span class="variable language_">this</span>.<span class="property">width</span>, <span class="variable language_">this</span>.<span class="property">y</span> + obj.<span class="property">offset_y</span>, image.<span class="property">width</span> * obj.<span class="property">scale</span>, image.<span class="property">height</span> * obj.<span class="property">scale</span>); <span class="comment">// 绘制翻转后的图像</span></span><br><span class="line"></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">restore</span>(); <span class="comment">// 恢复画布状态</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (status === <span class="number">4</span> || status === <span class="number">5</span>) &#123; <span class="comment">// 如果玩家角色处于攻击或被攻击状态</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">frame_current_cnt</span> == obj.<span class="property">frame_rate</span> * (obj.<span class="property">frame_cnt</span> - <span class="number">1</span>)) &#123; <span class="comment">// 如果当前帧数为动画的最后一帧</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">status</span> = <span class="number">0</span>; <span class="comment">// 将状态设置为空闲状态</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">frame_current_cnt</span>++; <span class="comment">// 当前帧数自增1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>添加生命值,死亡时更换倒地动画，并且render函数特判倒地状态，另外倒地后人物朝向不变和倒地后无法被再次攻击</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MyGameObject</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;/static/js/MyGameObject/base.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Player</span> <span class="keyword">extends</span> <span class="title class_ inherited__">MyGameObject</span> &#123;</span><br><span class="line">    <span class="comment">// 类的构造函数，在创建Player类的实例时会被调用，接收两个参数：root（即MyGameObject对象）和info（玩家的信息）</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">root, info</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(); <span class="comment">// 调用父类的构造函数</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">root</span> = root; <span class="comment">// 将传入的root对象赋值给当前实例的root属性</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">id</span> = info.<span class="property">id</span>; <span class="comment">// 从info对象中获取玩家角色的id信息，并赋值给当前实例的id属性</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">x</span> = info.<span class="property">x</span>; <span class="comment">// 从info对象中获取玩家角色的初始x坐标信息，并赋值给当前实例的x属性</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">y</span> = info.<span class="property">y</span>; <span class="comment">// 从info对象中获取玩家角色的初始y坐标信息，并赋值给当前实例的y属性</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">width</span> = info.<span class="property">width</span>; <span class="comment">// 获取玩家角色的宽度信息，赋值给当前实例的width属性</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">height</span> = info.<span class="property">height</span>; <span class="comment">// 获取玩家角色的高度信息，赋值给当前实例的height属性</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">color</span> = info.<span class="property">color</span>; <span class="comment">// 获取玩家角色的颜色信息，赋值给当前实例的color属性</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">vx</span> = <span class="number">0</span>; <span class="comment">// 初始化玩家角色在水平方向的速度分量为0</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">vy</span> = <span class="number">0</span>; <span class="comment">// 初始化玩家角色在垂直方向的速度分量为0</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">speedx</span> = <span class="number">400</span>; <span class="comment">// 定义玩家角色在水平方向的移动速度</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">speedy</span> = -<span class="number">1000</span>; <span class="comment">// 定义玩家角色在跳跃时的初始垂直速度</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span> = <span class="variable language_">this</span>.<span class="property">root</span>.<span class="property">game_map</span>.<span class="property">ctx</span>; <span class="comment">// 获取游戏地图的绘图上下文对象</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gravity</span> = <span class="number">50</span>; <span class="comment">// 定义玩家角色所受的重力加速度</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">direction</span> = <span class="number">1</span>; <span class="comment">// 定义玩家角色的方向，正方向为1</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">status</span> = <span class="number">3</span>; <span class="comment">// 初始值为3，表示玩家角色在游戏开始时是跳跃状态</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">pressed_Keys</span> = <span class="variable language_">this</span>.<span class="property">root</span>.<span class="property">game_map</span>.<span class="property">controller</span>.<span class="property">pressed_Keys</span>; <span class="comment">// 获取按键状态</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">animations</span> = <span class="keyword">new</span> <span class="title class_">Map</span>(); <span class="comment">// 用来存放玩家每一个状态的动画</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">frame_current_cnt</span> = <span class="number">0</span>; <span class="comment">// 表示当前帧数</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hp</span> = <span class="number">100</span>; <span class="comment">// 初始化玩家角色的生命值为100</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 初始化方法，可以在子类中重写以执行一些初始化操作</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义move方法，用于处理玩家角色的移动逻辑</span></span><br><span class="line">    <span class="title function_">move</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">vy</span> += <span class="variable language_">this</span>.<span class="property">gravity</span>; <span class="comment">// 在垂直方向上，根据重力加速度来更新垂直速度分量</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">x</span> += <span class="variable language_">this</span>.<span class="property">vx</span> * <span class="variable language_">this</span>.<span class="property">timedelta</span> / <span class="number">1000</span>; <span class="comment">// 更新玩家角色的水平坐标</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">y</span> += <span class="variable language_">this</span>.<span class="property">vy</span> * <span class="variable language_">this</span>.<span class="property">timedelta</span> / <span class="number">1000</span>; <span class="comment">// 更新玩家角色的垂直坐标</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">y</span> &gt; <span class="number">450</span>) &#123; <span class="comment">// 判断玩家角色是否到达地面</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">y</span> = <span class="number">450</span>; <span class="comment">// 将玩家角色的垂直坐标设置为450</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">vy</span> = <span class="number">0</span>; <span class="comment">// 将垂直速度分量重置为0</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">status</span> = <span class="number">0</span>; <span class="comment">// 将玩家角色的状态设置为空闲状态</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">x</span> &lt; <span class="number">0</span>) &#123; <span class="comment">// 限制玩家角色在水平方向上的移动范围，避免超出画布左边界</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">x</span> = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">x</span> + <span class="variable language_">this</span>.<span class="property">width</span> &gt; <span class="variable language_">this</span>.<span class="property">root</span>.<span class="property">game_map</span>.<span class="property">$canvas</span>.<span class="title function_">width</span>()) &#123; <span class="comment">// 限制玩家角色在水平方向上的移动范围，避免超出画布右边界</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">x</span> = <span class="number">1280</span> - <span class="variable language_">this</span>.<span class="property">width</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// update_control 方法，用于根据按键状态更新玩家角色的控制逻辑</span></span><br><span class="line">    <span class="title function_">update_control</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> w, a, d, space;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">id</span> === <span class="number">0</span>) &#123; <span class="comment">// 根据玩家角色的 id 确定按键映射</span></span><br><span class="line">            w = <span class="variable language_">this</span>.<span class="property">pressed_Keys</span>.<span class="title function_">has</span>(<span class="string">&#x27;w&#x27;</span>); <span class="comment">// 玩家 1 的跳跃键</span></span><br><span class="line">            a = <span class="variable language_">this</span>.<span class="property">pressed_Keys</span>.<span class="title function_">has</span>(<span class="string">&#x27;a&#x27;</span>); <span class="comment">// 玩家 1 的向左键</span></span><br><span class="line">            d = <span class="variable language_">this</span>.<span class="property">pressed_Keys</span>.<span class="title function_">has</span>(<span class="string">&#x27;d&#x27;</span>); <span class="comment">// 玩家 1 的向右键</span></span><br><span class="line">            space = <span class="variable language_">this</span>.<span class="property">pressed_Keys</span>.<span class="title function_">has</span>(<span class="string">&#x27; &#x27;</span>); <span class="comment">// 玩家 1 的攻击键</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            w = <span class="variable language_">this</span>.<span class="property">pressed_Keys</span>.<span class="title function_">has</span>(<span class="string">&#x27;ArrowUp&#x27;</span>); <span class="comment">// 玩家 2 的跳跃键</span></span><br><span class="line">            a = <span class="variable language_">this</span>.<span class="property">pressed_Keys</span>.<span class="title function_">has</span>(<span class="string">&#x27;ArrowLeft&#x27;</span>); <span class="comment">// 玩家 2 的向左键</span></span><br><span class="line">            d = <span class="variable language_">this</span>.<span class="property">pressed_Keys</span>.<span class="title function_">has</span>(<span class="string">&#x27;ArrowRight&#x27;</span>); <span class="comment">// 玩家 2 的向右键</span></span><br><span class="line">            space = <span class="variable language_">this</span>.<span class="property">pressed_Keys</span>.<span class="title function_">has</span>(<span class="string">&#x27;Enter&#x27;</span>); <span class="comment">// 玩家 2 的攻击键</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="number">0</span> || <span class="variable language_">this</span>.<span class="property">status</span> === <span class="number">1</span>) &#123; <span class="comment">// 若玩家角色处于空闲或移动状态</span></span><br><span class="line">            <span class="keyword">if</span> (space) &#123; <span class="comment">// 如果按下攻击键</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">status</span> = <span class="number">4</span>; <span class="comment">// 将角色状态设为攻击状态</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">vx</span> = <span class="number">0</span>; <span class="comment">// 将水平速度设为0</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">frame_current_cnt</span> = <span class="number">0</span>; <span class="comment">// 重置当前帧数为0</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (w) &#123; <span class="comment">// 如果按下跳跃键</span></span><br><span class="line">                <span class="keyword">if</span> (d) &#123; <span class="comment">// 同时按下向右键</span></span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">vx</span> = <span class="variable language_">this</span>.<span class="property">speedx</span>; <span class="comment">// 设置水平速度为正方向</span></span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a) &#123; <span class="comment">// 同时按下向左键</span></span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">vx</span> = -<span class="variable language_">this</span>.<span class="property">speedx</span>; <span class="comment">// 设置水平速度为负方向</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">vx</span> = <span class="number">0</span>; <span class="comment">// 否则水平速度为0</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">vy</span> = <span class="variable language_">this</span>.<span class="property">speedy</span>; <span class="comment">// 设置垂直速度为跳跃速度</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">status</span> = <span class="number">3</span>; <span class="comment">// 状态设置为跳跃状态</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (d) &#123; <span class="comment">// 如果按下向右键</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">vx</span> = <span class="variable language_">this</span>.<span class="property">speedx</span>; <span class="comment">// 设置水平速度为正方向</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">status</span> = <span class="number">1</span>; <span class="comment">// 状态设置为移动状态</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a) &#123; <span class="comment">// 如果按下向左键</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">vx</span> = -<span class="variable language_">this</span>.<span class="property">speedx</span>; <span class="comment">// 设置水平速度为负方向</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">status</span> = <span class="number">1</span>; <span class="comment">// 状态设置为移动状态</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// 如果没有按下任何移动键</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">vx</span> = <span class="number">0</span>; <span class="comment">// 水平速度为0</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">status</span> = <span class="number">0</span>; <span class="comment">// 状态设置为空闲状态</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// update_direction 方法，用于更新玩家角色的方向</span></span><br><span class="line">    <span class="title function_">update_direction</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="number">6</span>) <span class="keyword">return</span>; <span class="comment">// 如果玩家角色处于死亡状态，则不更新方向</span></span><br><span class="line">        <span class="keyword">let</span> players = <span class="variable language_">this</span>.<span class="property">root</span>.<span class="property">players</span>;</span><br><span class="line">        <span class="keyword">if</span> (players[<span class="number">0</span>] &amp;&amp; players[<span class="number">1</span>]) &#123; <span class="comment">// 如果存在两个玩家</span></span><br><span class="line">            <span class="keyword">let</span> me = <span class="variable language_">this</span>, you = players[<span class="number">1</span> - <span class="variable language_">this</span>.<span class="property">id</span>]; <span class="comment">// 获取当前玩家和对手玩家</span></span><br><span class="line">            <span class="keyword">if</span> (me.<span class="property">x</span> &lt; you.<span class="property">x</span>) me.<span class="property">direction</span> = <span class="number">1</span>; <span class="comment">// 如果当前玩家在左侧，则方向为正（向右）</span></span><br><span class="line">            <span class="keyword">else</span> me.<span class="property">direction</span> = -<span class="number">1</span>; <span class="comment">// 否则方向为负（向左）</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// is_attack 方法，用于设置玩家角色为被攻击状态</span></span><br><span class="line">    <span class="title function_">is_attack</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="number">6</span>) <span class="keyword">return</span>; <span class="comment">// 如果玩家角色处于死亡状态，则不再处理被攻击逻辑</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">status</span> = <span class="number">5</span>; <span class="comment">// 将状态设置为被攻击状态</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">frame_current_cnt</span> = <span class="number">0</span>; <span class="comment">// 重置当前帧数为0</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hp</span> = <span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="number">0</span>, <span class="variable language_">this</span>.<span class="property">hp</span> - <span class="number">10</span>); <span class="comment">// 减少玩家角色的生命值，最低为0</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">hp</span> &lt;= <span class="number">0</span>) &#123; <span class="comment">// 如果生命值小于等于0</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">status</span> = <span class="number">6</span>; <span class="comment">// 将状态设置为死亡状态</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">frame_current_cnt</span> = <span class="number">0</span>; <span class="comment">// 重置当前帧数为0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// is_collision 方法，用于检测两个矩形是否发生碰撞</span></span><br><span class="line">    <span class="title function_">is_collision</span>(<span class="params">r1, r2</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Math</span>.<span class="title function_">max</span>(r1.<span class="property">x1</span>, r2.<span class="property">x1</span>) &gt; <span class="title class_">Math</span>.<span class="title function_">min</span>(r1.<span class="property">x2</span>, r2.<span class="property">x2</span>)) <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// 判断x轴是否有交集</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Math</span>.<span class="title function_">max</span>(r1.<span class="property">y1</span>, r2.<span class="property">y1</span>) &gt; <span class="title class_">Math</span>.<span class="title function_">min</span>(r1.<span class="property">y2</span>, r2.<span class="property">y2</span>)) <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// 判断y轴是否有交集</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// 如果x轴和y轴都有交集，则发生碰撞</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// update_attack 方法，用于处理玩家角色的攻击逻辑</span></span><br><span class="line">    <span class="title function_">update_attack</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="number">4</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">frame_current_cnt</span> === <span class="number">18</span>) &#123; <span class="comment">// 如果玩家角色处于攻击状态且当前帧数为18</span></span><br><span class="line">            <span class="keyword">let</span> me = <span class="variable language_">this</span>, you = <span class="variable language_">this</span>.<span class="property">root</span>.<span class="property">players</span>[<span class="number">1</span> - <span class="variable language_">this</span>.<span class="property">id</span>]; <span class="comment">// 获取当前玩家和对手玩家</span></span><br><span class="line">            <span class="keyword">let</span> r1;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">direction</span> &gt; <span class="number">0</span>) &#123; <span class="comment">// 如果玩家角色方向为正（向右）</span></span><br><span class="line">                r1 = &#123;</span><br><span class="line">                    <span class="attr">x1</span>: me.<span class="property">x</span> + <span class="number">120</span>,</span><br><span class="line">                    <span class="attr">y1</span>: me.<span class="property">y</span> + <span class="number">40</span>,</span><br><span class="line">                    <span class="attr">x2</span>: me.<span class="property">x</span> + <span class="number">120</span> + <span class="number">100</span>,</span><br><span class="line">                    <span class="attr">y2</span>: me.<span class="property">y</span> + <span class="number">40</span> + <span class="number">20</span>,</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// 如果玩家角色方向为负（向左）</span></span><br><span class="line">                r1 = &#123;</span><br><span class="line">                    <span class="attr">x1</span>: me.<span class="property">x</span> + me.<span class="property">width</span> - <span class="number">120</span> - <span class="number">100</span>,</span><br><span class="line">                    <span class="attr">y1</span>: me.<span class="property">y</span> + <span class="number">40</span>,</span><br><span class="line">                    <span class="attr">x2</span>: me.<span class="property">x</span> + me.<span class="property">width</span> - <span class="number">120</span> - <span class="number">100</span> + <span class="number">100</span>,</span><br><span class="line">                    <span class="attr">y2</span>: me.<span class="property">y</span> + <span class="number">40</span> + <span class="number">20</span>,</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> r2 = &#123; <span class="comment">// 对手玩家的矩形区域</span></span><br><span class="line">                <span class="attr">x1</span>: you.<span class="property">x</span>,</span><br><span class="line">                <span class="attr">y1</span>: you.<span class="property">y</span>,</span><br><span class="line">                <span class="attr">x2</span>: you.<span class="property">x</span> + you.<span class="property">width</span>,</span><br><span class="line">                <span class="attr">y2</span>: you.<span class="property">y</span> + you.<span class="property">height</span>,</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">is_collision</span>(r1, r2)) &#123; <span class="comment">// 如果两个矩形发生碰撞</span></span><br><span class="line">                you.<span class="title function_">is_attack</span>(); <span class="comment">// 设置对手玩家为被攻击状态</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// update 方法，用于更新玩家角色的状态</span></span><br><span class="line">    <span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">update_control</span>(); <span class="comment">// 更新控制逻辑</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">move</span>(); <span class="comment">// 更新移动逻辑</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">update_direction</span>(); <span class="comment">// 更新方向</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">update_attack</span>(); <span class="comment">// 更新攻击逻辑</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">render</span>(); <span class="comment">// 渲染玩家角色</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// render 方法，用于渲染玩家角色</span></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> status = <span class="variable language_">this</span>.<span class="property">status</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="number">1</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">direction</span> * <span class="variable language_">this</span>.<span class="property">vx</span> &lt; <span class="number">0</span>) &#123; <span class="comment">// 如果玩家角色处于移动状态且方向与速度方向相反</span></span><br><span class="line">            status = <span class="number">2</span>; <span class="comment">// 将状态设置为向后移动状态</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> obj = <span class="variable language_">this</span>.<span class="property">animations</span>.<span class="title function_">get</span>(status); <span class="comment">// 获取当前状态的动画对象</span></span><br><span class="line">        <span class="keyword">if</span> (obj &amp;&amp; obj.<span class="property">loaded</span>) &#123; <span class="comment">// 如果动画对象存在且已加载</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">direction</span> &gt; <span class="number">0</span>) &#123; <span class="comment">// 如果玩家角色方向为正（向右）</span></span><br><span class="line">                <span class="keyword">let</span> k = <span class="built_in">parseInt</span>(<span class="variable language_">this</span>.<span class="property">frame_current_cnt</span> / obj.<span class="property">frame_rate</span>) % obj.<span class="property">frame_cnt</span>; <span class="comment">// 计算当前帧索引</span></span><br><span class="line">                <span class="keyword">let</span> image = obj.<span class="property">gif</span>.<span class="property">frames</span>[k].<span class="property">image</span>; <span class="comment">// 获取当前帧的图像</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">drawImage</span>(image, <span class="variable language_">this</span>.<span class="property">x</span>, <span class="variable language_">this</span>.<span class="property">y</span> + obj.<span class="property">offset_y</span>, image.<span class="property">width</span> * obj.<span class="property">scale</span>, image.<span class="property">height</span> * obj.<span class="property">scale</span>); <span class="comment">// 绘制图像</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// 如果玩家角色方向为负（向左）</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">save</span>(); <span class="comment">// 保存画布状态</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">scale</span>(-<span class="number">1</span>, <span class="number">1</span>); <span class="comment">// 水平翻转画布</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">translate</span>(-<span class="variable language_">this</span>.<span class="property">root</span>.<span class="property">game_map</span>.<span class="property">$canvas</span>.<span class="title function_">width</span>(), <span class="number">0</span>); <span class="comment">// 调整画布位置</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">let</span> k = <span class="built_in">parseInt</span>(<span class="variable language_">this</span>.<span class="property">frame_current_cnt</span> / obj.<span class="property">frame_rate</span>) % obj.<span class="property">frame_cnt</span>; <span class="comment">// 计算当前帧索引</span></span><br><span class="line">                <span class="keyword">let</span> image = obj.<span class="property">gif</span>.<span class="property">frames</span>[k].<span class="property">image</span>; <span class="comment">// 获取当前帧的图像</span></span><br><span class="line"></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">drawImage</span>(image, <span class="variable language_">this</span>.<span class="property">root</span>.<span class="property">game_map</span>.<span class="property">$canvas</span>.<span class="title function_">width</span>() - <span class="variable language_">this</span>.<span class="property">x</span> - <span class="variable language_">this</span>.<span class="property">width</span>, <span class="variable language_">this</span>.<span class="property">y</span> + obj.<span class="property">offset_y</span>, image.<span class="property">width</span> * obj.<span class="property">scale</span>, image.<span class="property">height</span> * obj.<span class="property">scale</span>); <span class="comment">// 绘制翻转后的图像</span></span><br><span class="line"></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">restore</span>(); <span class="comment">// 恢复画布状态</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (status === <span class="number">4</span> || status === <span class="number">5</span> || status === <span class="number">6</span>) &#123; <span class="comment">// 如果玩家角色处于攻击、被攻击或死亡状态</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">frame_current_cnt</span> == obj.<span class="property">frame_rate</span> * (obj.<span class="property">frame_cnt</span> - <span class="number">1</span>)) &#123; <span class="comment">// 如果当前帧数为动画的最后一帧</span></span><br><span class="line">                <span class="keyword">if</span> (status === <span class="number">6</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">frame_current_cnt</span>--; <span class="comment">// 如果玩家角色处于死亡状态，则保持最后一帧</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">status</span> = <span class="number">0</span>; <span class="comment">// 将状态设置为空闲状态</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">frame_current_cnt</span>++; <span class="comment">// 当前帧数自增1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改所有状态都会受到重力，特判只有在跳跃状态落地后改为静止状态</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义move方法，用于处理玩家角色的移动逻辑</span></span><br><span class="line"><span class="title function_">move</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">vy</span> += <span class="variable language_">this</span>.<span class="property">gravity</span>; <span class="comment">// 在垂直方向上，根据重力加速度来更新垂直速度分量</span></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">x</span> += <span class="variable language_">this</span>.<span class="property">vx</span> * <span class="variable language_">this</span>.<span class="property">timedelta</span> / <span class="number">1000</span>; <span class="comment">// 更新玩家角色的水平坐标</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">y</span> += <span class="variable language_">this</span>.<span class="property">vy</span> * <span class="variable language_">this</span>.<span class="property">timedelta</span> / <span class="number">1000</span>; <span class="comment">// 更新玩家角色的垂直坐标</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">y</span> &gt; <span class="number">450</span>) &#123; <span class="comment">// 判断玩家角色是否到达地面</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">y</span> = <span class="number">450</span>; <span class="comment">// 将玩家角色的垂直坐标设置为450</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">vy</span> = <span class="number">0</span>; <span class="comment">// 将垂直速度分量重置为0</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="number">3</span>)</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">status</span> = <span class="number">0</span>; <span class="comment">// 如果玩家角色之前处于跳跃状态（status === 3），则将其状态设置为空闲状态（status === 0）</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">x</span> &lt; <span class="number">0</span>) &#123; <span class="comment">// 限制玩家角色在水平方向上的移动范围，避免超出画布左边界</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">x</span> = <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">x</span> + <span class="variable language_">this</span>.<span class="property">width</span> &gt; <span class="variable language_">this</span>.<span class="property">root</span>.<span class="property">game_map</span>.<span class="property">$canvas</span>.<span class="title function_">width</span>()) &#123; <span class="comment">// 限制玩家角色在水平方向上的移动范围，避免超出画布右边界</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">x</span> = <span class="number">1280</span> - <span class="variable language_">this</span>.<span class="property">width</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="实现血条功能和计时器"><a href="#实现血条功能和计时器" class="headerlink" title="实现血条功能和计时器"></a>实现血条功能和计时器</h2><p>固定画面在html里写，减少canvas渲染的内容,用js控制html，写在GameMap类</p>
<p>在GameMap类的构造函数的末尾添加以下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 $kof 元素中添加一个头部区域，用于显示游戏信息（如玩家血量、计时器等）</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">root</span>.<span class="property">$kof</span>.<span class="title function_">append</span>($(<span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;kof-head&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;kof-head-hp-0&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;kof-head-timer&quot;&gt;60&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;kof-head-hp-1&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">`</span>));</span><br></pre></td></tr></table></figure>
<p>设置血条定时器的样式</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#kof</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">1280px</span>;</span><br><span class="line">    <span class="comment">/* 设置容器的宽度为 1280 像素 */</span></span><br><span class="line">    <span class="attribute">height</span>: <span class="number">720px</span>;</span><br><span class="line">    <span class="comment">/* 设置容器的高度为 720 像素 */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 设置背景图片，使用 URL 指定图片路径 */</span></span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&#x27;/static/images/background/background.gif&#x27;</span>);</span><br><span class="line">    <span class="comment">/* 设置背景图片的尺寸为 200% 宽度和 100% 高度，使背景图片横向拉伸 */</span></span><br><span class="line">    <span class="attribute">background-size</span>: <span class="number">200%</span> <span class="number">100%</span>;</span><br><span class="line">    <span class="comment">/* 设置背景图片的位置为顶部对齐 */</span></span><br><span class="line">    <span class="attribute">background-position</span>: top;</span><br><span class="line">    <span class="comment">/* 设置容器的定位方式为绝对定位 */</span></span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#kof</span>&gt;<span class="selector-class">.kof-head</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="comment">/* 设置头部区域的宽度为 100%，与容器宽度一致 */</span></span><br><span class="line">    <span class="attribute">height</span>: <span class="number">80px</span>;</span><br><span class="line">    <span class="comment">/* 设置头部区域的高度为 80 像素 */</span></span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="comment">/* 设置头部区域的定位方式为绝对定位 */</span></span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="comment">/* 将头部区域定位在容器的顶部 */</span></span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="comment">/* 使用 Flex 布局，使子元素水平排列 */</span></span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="comment">/* 将子元素垂直居中 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#kof</span>&gt;<span class="selector-class">.kof-head</span>&gt;<span class="selector-class">.kof-head-hp-0</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="comment">/* 设置玩家 1 血量条的高度为 40 像素 */</span></span><br><span class="line">    <span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">50%</span> - <span class="number">60px</span>);</span><br><span class="line">    <span class="comment">/* 设置玩家 1 血量条的宽度为容器宽度的一半减去 60 像素 */</span></span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="comment">/* 设置左边距为 20 像素 */</span></span><br><span class="line">    <span class="attribute">border</span>: white <span class="number">5px</span> solid;</span><br><span class="line">    <span class="comment">/* 设置边框为白色，宽度为 5 像素 */</span></span><br><span class="line">    <span class="attribute">border-right</span>: none;</span><br><span class="line">    <span class="comment">/* 去掉右侧边框 */</span></span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="comment">/* 设置盒模型为 border-box，使边框宽度包含在元素宽度内 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#kof</span>&gt;<span class="selector-class">.kof-head</span>&gt;<span class="selector-class">.kof-head-timer</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">60px</span>;</span><br><span class="line">    <span class="comment">/* 设置计时器的高度为 60 像素 */</span></span><br><span class="line">    <span class="attribute">width</span>: <span class="number">80px</span>;</span><br><span class="line">    <span class="comment">/* 设置计时器的宽度为 80 像素 */</span></span><br><span class="line">    <span class="attribute">background-color</span>: orange;</span><br><span class="line">    <span class="comment">/* 设置背景颜色为橙色 */</span></span><br><span class="line">    <span class="attribute">border</span>: white <span class="number">5px</span> solid;</span><br><span class="line">    <span class="comment">/* 设置边框为白色，宽度为 5 像素 */</span></span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="comment">/* 设置盒模型为 border-box，使边框宽度包含在元素宽度内 */</span></span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">    <span class="comment">/* 设置文字颜色为白色 */</span></span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="comment">/* 设置字体大小为 30 像素 */</span></span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">800</span>;</span><br><span class="line">    <span class="comment">/* 设置字体粗细为 800（加粗） */</span></span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="comment">/* 设置文字水平居中 */</span></span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="comment">/* 设置行高为 50 像素，使文字垂直居中 */</span></span><br><span class="line">    <span class="attribute">user-select</span>: none;</span><br><span class="line">    <span class="comment">/* 禁止用户选择文字 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#kof</span>&gt;<span class="selector-class">.kof-head</span>&gt;<span class="selector-class">.kof-head-hp-1</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="comment">/* 设置玩家 2 血量条的高度为 40 像素 */</span></span><br><span class="line">    <span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">50%</span> - <span class="number">60px</span>);</span><br><span class="line">    <span class="comment">/* 设置玩家 2 血量条的宽度为容器宽度的一半减去 60 像素 */</span></span><br><span class="line">    <span class="attribute">border</span>: white <span class="number">5px</span> solid;</span><br><span class="line">    <span class="comment">/* 设置边框为白色，宽度为 5 像素 */</span></span><br><span class="line">    <span class="attribute">border-left</span>: none;</span><br><span class="line">    <span class="comment">/* 去掉左侧边框 */</span></span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="comment">/* 设置盒模型为 border-box，使边框宽度包含在元素宽度内 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="实现血条按照百分比缩减"><a href="#实现血条按照百分比缩减" class="headerlink" title="实现血条按照百分比缩减"></a>实现血条按照百分比缩减</h2><p>先把布局和样式写好<br>GameMap类</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 $kof 元素中添加一个头部区域，用于显示游戏信息（如玩家血量、计时器等）</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">root</span>.<span class="property">$kof</span>.<span class="title function_">append</span>($(<span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;kof-head&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;kof-head-hp-0&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;kof-head-timer&quot;&gt;60&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;kof-head-hp-1&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">`</span>));</span><br></pre></td></tr></table></figure>
<p>css文件</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#kof</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">1280px</span>; <span class="comment">/* 设置容器的宽度为 1280 像素 */</span></span><br><span class="line">    <span class="attribute">height</span>: <span class="number">720px</span>; <span class="comment">/* 设置容器的高度为 720 像素 */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 设置背景图片，使用 URL 指定图片路径 */</span></span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&#x27;/static/images/background/background.gif&#x27;</span>);</span><br><span class="line">    <span class="comment">/* 设置背景图片的尺寸为 200% 宽度和 100% 高度，使背景图片横向拉伸 */</span></span><br><span class="line">    <span class="attribute">background-size</span>: <span class="number">200%</span> <span class="number">100%</span>;</span><br><span class="line">    <span class="comment">/* 设置背景图片的位置为顶部对齐 */</span></span><br><span class="line">    <span class="attribute">background-position</span>: top;</span><br><span class="line">    <span class="comment">/* 设置容器的定位方式为绝对定位 */</span></span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#kof</span>&gt;<span class="selector-class">.kof-head</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>; <span class="comment">/* 设置头部区域的宽度为 100%，与容器宽度一致 */</span></span><br><span class="line">    <span class="attribute">height</span>: <span class="number">80px</span>; <span class="comment">/* 设置头部区域的高度为 80 像素 */</span></span><br><span class="line">    <span class="attribute">position</span>: absolute; <span class="comment">/* 设置头部区域的定位方式为绝对定位 */</span></span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>; <span class="comment">/* 将头部区域定位在容器的顶部 */</span></span><br><span class="line">    <span class="attribute">display</span>: flex; <span class="comment">/* 使用 Flex 布局，使子元素水平排列 */</span></span><br><span class="line">    <span class="attribute">align-items</span>: center; <span class="comment">/* 将子元素垂直居中 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#kof</span>&gt;<span class="selector-class">.kof-head</span>&gt;<span class="selector-class">.kof-head-hp-0</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">40px</span>; <span class="comment">/* 设置玩家 1 血量条的高度为 40 像素 */</span></span><br><span class="line">    <span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">50%</span> - <span class="number">60px</span>); <span class="comment">/* 设置玩家 1 血量条的宽度为容器宽度的一半减去 60 像素 */</span></span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">20px</span>; <span class="comment">/* 设置左边距为 20 像素 */</span></span><br><span class="line">    <span class="attribute">border</span>: white <span class="number">5px</span> solid; <span class="comment">/* 设置边框为白色，宽度为 5 像素 */</span></span><br><span class="line">    <span class="attribute">border-right</span>: none; <span class="comment">/* 去掉右侧边框 */</span></span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box; <span class="comment">/* 设置盒模型为 border-box，使边框宽度包含在元素宽度内 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#kof</span>&gt;<span class="selector-class">.kof-head</span>&gt;<span class="selector-class">.kof-head-timer</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">60px</span>; <span class="comment">/* 设置计时器的高度为 60 像素 */</span></span><br><span class="line">    <span class="attribute">width</span>: <span class="number">80px</span>; <span class="comment">/* 设置计时器的宽度为 80 像素 */</span></span><br><span class="line">    <span class="attribute">background-color</span>: orange; <span class="comment">/* 设置背景颜色为橙色 */</span></span><br><span class="line">    <span class="attribute">border</span>: white <span class="number">5px</span> solid; <span class="comment">/* 设置边框为白色，宽度为 5 像素 */</span></span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box; <span class="comment">/* 设置盒模型为 border-box，使边框宽度包含在元素宽度内 */</span></span><br><span class="line">    <span class="attribute">color</span>: white; <span class="comment">/* 设置文字颜色为白色 */</span></span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">30px</span>; <span class="comment">/* 设置字体大小为 30 像素 */</span></span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">800</span>; <span class="comment">/* 设置字体粗细为 800（加粗） */</span></span><br><span class="line">    <span class="attribute">text-align</span>: center; <span class="comment">/* 设置文字水平居中 */</span></span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">50px</span>; <span class="comment">/* 设置行高为 50 像素，使文字垂直居中 */</span></span><br><span class="line">    <span class="attribute">user-select</span>: none; <span class="comment">/* 禁止用户选择文字 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#kof</span>&gt;<span class="selector-class">.kof-head</span>&gt;<span class="selector-class">.kof-head-hp-1</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">40px</span>; <span class="comment">/* 设置玩家 2 血量条的高度为 40 像素 */</span></span><br><span class="line">    <span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">50%</span> - <span class="number">60px</span>); <span class="comment">/* 设置玩家 2 血量条的宽度为容器宽度的一半减去 60 像素 */</span></span><br><span class="line">    <span class="attribute">border</span>: white <span class="number">5px</span> solid; <span class="comment">/* 设置边框为白色，宽度为 5 像素 */</span></span><br><span class="line">    <span class="attribute">border-left</span>: none; <span class="comment">/* 去掉左侧边框 */</span></span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box; <span class="comment">/* 设置盒模型为 border-box，使边框宽度包含在元素宽度内 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#kof</span>&gt;<span class="selector-class">.kof-head</span>&gt;<span class="selector-class">.kof-head-hp-0</span>&gt;<span class="selector-tag">div</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: red; <span class="comment">/* 设置玩家 1 血量条的背景颜色为红色 */</span></span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>; <span class="comment">/* 设置高度为 100%，填充父容器 */</span></span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>; <span class="comment">/* 设置宽度为 100%，填充父容器 */</span></span><br><span class="line">    <span class="attribute">float</span>: right; <span class="comment">/* 使用浮动将内容靠右对齐 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#kof</span>&gt;<span class="selector-class">.kof-head</span>&gt;<span class="selector-class">.kof-head-hp-1</span>&gt;<span class="selector-tag">div</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: red; <span class="comment">/* 设置玩家 2 血量条的背景颜色为红色 */</span></span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>; <span class="comment">/* 设置高度为 100%，填充父容器 */</span></span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>; <span class="comment">/* 设置宽度为 100%，填充父容器 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#kof</span>&gt;<span class="selector-class">.kof-head</span>&gt;<span class="selector-class">.kof-head-hp-0</span>&gt;<span class="selector-tag">div</span>&gt;<span class="selector-tag">div</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: lightgreen; <span class="comment">/* 设置玩家 1 血量条的当前血量背景颜色为浅绿色 */</span></span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>; <span class="comment">/* 设置高度为 100%，填充父容器 */</span></span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>; <span class="comment">/* 设置宽度为 100%，填充父容器 */</span></span><br><span class="line">    <span class="attribute">float</span>: right; <span class="comment">/* 使用浮动将内容靠右对齐 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#kof</span>&gt;<span class="selector-class">.kof-head</span>&gt;<span class="selector-class">.kof-head-hp-1</span>&gt;<span class="selector-tag">div</span>&gt;<span class="selector-tag">div</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: lightgreen; <span class="comment">/* 设置玩家 2 血量条的当前血量背景颜色为浅绿色 */</span></span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>; <span class="comment">/* 设置高度为 100%，填充父容器 */</span></span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>; <span class="comment">/* 设置宽度为 100%，填充父容器 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再实现js逻辑，Player类中</p>
<p>在构造函数最后</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">$hp</span> = <span class="variable language_">this</span>.<span class="property">root</span>.<span class="property">$kof</span>.<span class="title function_">find</span>(<span class="string">`.kof-head-hp-<span class="subst">$&#123;<span class="variable language_">this</span>.id&#125;</span>&gt;div`</span>); <span class="comment">// 获取玩家血量条的jQuery对象</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$hp_div</span> = <span class="variable language_">this</span>.<span class="property">$hp</span>.<span class="title function_">find</span>(<span class="string">&#x27;div&#x27;</span>); <span class="comment">// 获取玩家血量条中表示当前血量的jQuery对象</span></span><br></pre></td></tr></table></figure>
<p>在is_attack函数实现逻辑</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// is_attack 方法，用于设置玩家角色为被攻击状态</span></span><br><span class="line"><span class="title function_">is_attack</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="number">6</span>) <span class="keyword">return</span>; <span class="comment">// 如果玩家角色处于死亡状态，则不再处理被攻击逻辑</span></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">status</span> = <span class="number">5</span>; <span class="comment">// 将状态设置为被攻击状态</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">frame_current_cnt</span> = <span class="number">0</span>; <span class="comment">// 重置当前帧数为0</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hp</span> = <span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="number">0</span>, <span class="variable language_">this</span>.<span class="property">hp</span> - <span class="number">10</span>); <span class="comment">// 减少玩家角色的生命值，最低为0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新血量条的动画效果</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$hp_div</span>.<span class="title function_">animate</span>(&#123;</span><br><span class="line">        <span class="attr">width</span>: <span class="variable language_">this</span>.<span class="property">$hp</span>.<span class="title function_">parent</span>().<span class="title function_">width</span>() * <span class="variable language_">this</span>.<span class="property">hp</span> / <span class="number">100</span> <span class="comment">// 设置当前血量的宽度</span></span><br><span class="line">    &#125;, <span class="number">300</span>); <span class="comment">// 动画持续时间为300毫秒</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$hp</span>.<span class="title function_">animate</span>(&#123;</span><br><span class="line">        <span class="attr">width</span>: <span class="variable language_">this</span>.<span class="property">$hp</span>.<span class="title function_">parent</span>().<span class="title function_">width</span>() * <span class="variable language_">this</span>.<span class="property">hp</span> / <span class="number">100</span> <span class="comment">// 设置总血量的宽度</span></span><br><span class="line">    &#125;, <span class="number">600</span>); <span class="comment">// 动画持续时间为600毫秒</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">hp</span> &lt;= <span class="number">0</span>) &#123; <span class="comment">// 如果生命值小于等于0</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">status</span> = <span class="number">6</span>; <span class="comment">// 将状态设置为死亡状态</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">frame_current_cnt</span> = <span class="number">0</span>; <span class="comment">// 重置当前帧数为0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="实现定时器功能"><a href="#实现定时器功能" class="headerlink" title="实现定时器功能"></a>实现定时器功能</h2><p>在GameMap类构造函数定义时间</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化剩余时间，单位为毫秒</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">time_left</span> = <span class="number">60000</span>;</span><br><span class="line"><span class="comment">// 获取计时器元素的引用，方便后续更新显示</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$timer</span> = <span class="variable language_">this</span>.<span class="property">root</span>.<span class="property">$kof</span>.<span class="title function_">find</span>(<span class="string">&quot;.kof-head-timer&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>在update函数里更新时间</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// update方法，每一帧都会被调用，用于更新游戏状态</span></span><br><span class="line"><span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 减少剩余时间</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">time_left</span> -= <span class="variable language_">this</span>.<span class="property">timedelta</span>;</span><br><span class="line">    <span class="comment">// 如果时间小于0，重置为0</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">time_left</span> &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">time_left</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 获取两个玩家对象</span></span><br><span class="line">        <span class="keyword">let</span> [a, b] = <span class="variable language_">this</span>.<span class="property">root</span>.<span class="property">players</span>;</span><br><span class="line">        <span class="comment">// 如果两个玩家都不处于状态6（假设状态6为游戏结束状态），则设置他们的状态为6，并重置一些属性</span></span><br><span class="line">        <span class="keyword">if</span> (a.<span class="property">status</span> !== <span class="number">6</span> &amp;&amp; b.<span class="property">status</span> !== <span class="number">6</span>) &#123;</span><br><span class="line">            a.<span class="property">status</span> = b.<span class="property">status</span> = <span class="number">6</span>;</span><br><span class="line">            a.<span class="property">frame_current_cnt</span> = b.<span class="property">frame_current_cnt</span> = <span class="number">0</span>;</span><br><span class="line">            a.<span class="property">vx</span> = b.<span class="property">vx</span> = <span class="number">0</span>;<span class="comment">//死亡后速度归零</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 更新计时器显示</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$timer</span>.<span class="title function_">text</span>(<span class="built_in">parseInt</span>(<span class="variable language_">this</span>.<span class="property">time_left</span> / <span class="number">1000</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用render方法进行渲染</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">render</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在Player类的is_attack函数里将死亡后的速度归零</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">hp</span> &lt;= <span class="number">0</span>) &#123; <span class="comment">// 如果生命值小于等于0</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">status</span> = <span class="number">6</span>; <span class="comment">// 将状态设置为死亡状态</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">frame_current_cnt</span> = <span class="number">0</span>; <span class="comment">// 重置当前帧数为0</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">vx</span> = <span class="number">0</span>;<span class="comment">//死亡后速度为0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/01/07/Web%E9%A1%B9%E7%9B%AE-%E6%8B%B3%E7%9A%87-%E4%B8%8B/" data-id="cm8sja97w00458ktbda8shh3a" data-title="Web项目-拳皇-下" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web/" rel="tag">Web</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Shell%E8%84%9A%E6%9C%AC/">Shell脚本</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Unity3D/">Unity3D</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Unreal-Engine/">Unreal Engine</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/" rel="tag">Shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Springboot/" rel="tag">Springboot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unity3D/" rel="tag">Unity3D</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unreal-Engine/" rel="tag">Unreal Engine</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue/" rel="tag">Vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web/" rel="tag">Web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Docker/" style="font-size: 16px;">Docker</a> <a href="/tags/JavaScript/" style="font-size: 18px;">JavaScript</a> <a href="/tags/Linux/" style="font-size: 16px;">Linux</a> <a href="/tags/Shell/" style="font-size: 10px;">Shell</a> <a href="/tags/Springboot/" style="font-size: 18px;">Springboot</a> <a href="/tags/Unity3D/" style="font-size: 14px;">Unity3D</a> <a href="/tags/Unreal-Engine/" style="font-size: 12px;">Unreal Engine</a> <a href="/tags/Vue/" style="font-size: 12px;">Vue</a> <a href="/tags/Web/" style="font-size: 14px;">Web</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 18px;">算法</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 20px;">设计模式</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/03/">三月 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/01/">一月 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/12/">十二月 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/03/28/WebSocket/">WebSocket</a>
          </li>
        
          <li>
            <a href="/2025/03/15/Docker%E5%AE%89%E8%A3%85/">Docker安装</a>
          </li>
        
          <li>
            <a href="/2025/03/15/Docker%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2/">Docker项目部署</a>
          </li>
        
          <li>
            <a href="/2025/03/15/Docker%E5%9F%BA%E7%A1%80/">Docker基础</a>
          </li>
        
          <li>
            <a href="/2025/03/15/Docker%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/">Docker快速入门</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 Lzh<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>